<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora MEI Premium - Precifica√ß√£o Inteligente + Proje√ß√µes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #10b981;
            --accent-color: #8b5cf6;
            --dark-bg: #0f172a;
            --dark-card: #1e293b;
            --dark-text: #f1f5f9;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        .dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }
        
        .dark-mode .bg-white {
            background-color: var(--dark-card) !important;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
        }
        
        .dark-mode .glass-card {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(100, 116, 139, 0.3);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }
        
        .gradient-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .gradient-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .gradient-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .floating-label {
            position: absolute;
            top: -10px;
            left: 12px;
            background: white;
            padding: 0 8px;
            font-size: 0.85rem;
            color: #4b5563;
        }
        
        .dark-mode .floating-label {
            background: var(--dark-card);
            color: #cbd5e1;
        }
        
        .input-group {
            position: relative;
            padding-top: 12px;
        }
        
        .chart-container-sm {
            height: 200px;
            position: relative;
        }
        
        .chart-container-md {
            height: 300px;
            position: relative;
        }
        
        .chart-container-lg {
            height: 400px;
            position: relative;
        }
        
        .info-bubble {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
            font-size: 12px;
            cursor: help;
            margin-left: 5px;
        }
        
        .dark-mode .info-bubble {
            background: #60a5fa;
        }
        
        .tooltip-content {
            display: none;
            position: absolute;
            background: #1f2937;
            color: white;
            padding: 12px;
            border-radius: 8px;
            width: 300px;
            z-index: 1000;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            font-size: 0.9rem;
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring__circle {
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 0.5s ease;
        }
        
        .step-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: #e5e7eb;
            color: #6b7280;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 12px;
        }
        
        .step-indicator.active {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
        }
        
        .step-indicator.completed {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .custom-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(to right, #ef4444, #f59e0b, #10b981);
            outline: none;
        }
        
        .custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #3b82f6;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }
        
        .price-breakdown-item {
            transition: all 0.3s ease;
        }
        
        .price-breakdown-item:hover {
            transform: translateX(5px);
            background: #f3f4f6;
        }
        
        .dark-mode .price-breakdown-item:hover {
            background: #334155;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #3b82f6;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }
        
        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .dark-mode .modal-content {
            background: var(--dark-card);
        }
        
        .print-only {
            display: none;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            .print-only {
                display: block !important;
            }
            body {
                background: white !important;
                color: black !important;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50 transition-colors duration-300">
    <!-- Header Superior -->
    <div class="gradient-primary text-white py-4 px-6 shadow-lg">
        <div class="max-w-7xl mx-auto">
            <div class="flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="bg-white/20 p-2 rounded-xl backdrop-blur-sm">
                        <i class="fas fa-calculator text-2xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Calculadora MEI Premium</h1>
                        <p class="text-blue-100 text-sm">Precifica√ß√£o Inteligente + Gr√°ficos + Proje√ß√µes</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="toggleDarkMode()" class="bg-white/20 hover:bg-white/30 p-2 rounded-lg transition">
                        <i id="darkModeIcon" class="fas fa-moon"></i>
                    </button>
                    <button onclick="saveProgress()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg text-sm font-medium transition">
                        <i class="fas fa-save mr-2"></i>Salvar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Progresso do Wizard -->
    <div class="bg-white dark:bg-gray-800 shadow-sm">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="step-indicator completed">
                        <i class="fas fa-check"></i>
                    </div>
                    <div class="hidden md:block">
                        <div class="text-sm font-medium">Dados B√°sicos</div>
                        <div class="text-xs text-gray-500">Informa√ß√µes iniciais</div>
                    </div>
                </div>
                
                <div class="h-1 flex-1 mx-4 bg-gray-200 dark:bg-gray-700 relative">
                    <div id="progressBar" class="h-full gradient-primary rounded-full" style="width: 0%"></div>
                </div>
                
                <div class="flex items-center">
                    <div class="step-indicator active">
                        2
                    </div>
                    <div class="hidden md:block">
                        <div class="text-sm font-medium">Custos</div>
                        <div class="text-xs text-gray-500">An√°lise de gastos</div>
                    </div>
                </div>
                
                <div class="h-1 flex-1 mx-4 bg-gray-200 dark:bg-gray-700"></div>
                
                <div class="flex items-center">
                    <div class="step-indicator">
                        3
                    </div>
                    <div class="hidden md:block">
                        <div class="text-sm font-medium">Precifica√ß√£o</div>
                        <div class="text-xs text-gray-500">Estrat√©gias de pre√ßo</div>
                    </div>
                </div>
                
                <div class="h-1 flex-1 mx-4 bg-gray-200 dark:bg-gray-700"></div>
                
                <div class="flex items-center">
                    <div class="step-indicator">
                        4
                    </div>
                    <div class="hidden md:block">
                        <div class="text-sm font-medium">Resultados</div>
                        <div class="text-xs text-gray-500">An√°lise financeira</div>
                    </div>
                </div>
                
                <div class="h-1 flex-1 mx-4 bg-gray-200 dark:bg-gray-700"></div>
                
                <div class="flex items-center">
                    <div class="step-indicator">
                        5
                    </div>
                    <div class="hidden md:block">
                        <div class="text-sm font-medium">Proje√ß√µes</div>
                        <div class="text-xs text-gray-500">Cen√°rios futuros</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Conte√∫do Principal -->
    <div class="max-w-7xl mx-auto p-4 md:p-6">
        <!-- Navega√ß√£o por Tabs -->
        <div class="flex flex-wrap gap-2 mb-6 no-print">
            <button onclick="openTab('dashboard')" id="tabDashboard" class="tab-btn px-4 py-3 rounded-xl font-medium gradient-primary text-white shadow-md hover-lift">
                <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
            </button>
            <button onclick="openTab('dados')" id="tabDados" class="tab-btn px-4 py-3 rounded-xl font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover-lift">
                <i class="fas fa-edit mr-2"></i>Dados B√°sicos
            </button>
            <button onclick="openTab('custos')" id="tabCustos" class="tab-btn px-4 py-3 rounded-xl font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover-lift">
                <i class="fas fa-money-bill-wave mr-2"></i>An√°lise de Custos
            </button>
            <button onclick="openTab('precificacao')" id="tabPrecificacao" class="tab-btn px-4 py-3 rounded-xl font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover-lift">
                <i class="fas fa-tags mr-2"></i>Estrat√©gias de Precifica√ß√£o
            </button>
            <button onclick="openTab('mercado')" id="tabMercado" class="tab-btn px-4 py-3 rounded-xl font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover-lift">
                <i class="fas fa-chart-bar mr-2"></i>An√°lise de Mercado
            </button>
            <button onclick="openTab('resultados')" id="tabResultados" class="tab-btn px-4 py-3 rounded-xl font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover-lift">
                <i class="fas fa-calculator mr-2"></i>Resultados Financeiros
            </button>
            <button onclick="openTab('graficos')" id="tabGraficos" class="tab-btn px-4 py-3 rounded-xl font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover-lift">
                <i class="fas fa-chart-pie mr-2"></i>Gr√°ficos Avan√ßados
            </button>
            <button onclick="openTab('projecoes')" id="tabProjecoes" class="tab-btn px-4 py-3 rounded-xl font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover-lift">
                <i class="fas fa-project-diagram mr-2"></i>Proje√ß√µes & Cen√°rios
            </button>
            <button onclick="openTab('recomendacoes')" id="tabRecomendacoes" class="tab-btn px-4 py-3 rounded-xl font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover-lift">
                <i class="fas fa-bullseye mr-2"></i>Plano de A√ß√£o
            </button>
        </div>

        <!-- Container das Tabs -->
        <div id="conteudo">
            
            <!-- Dashboard Inicial -->
            <div id="dashboard" class="tab-content active">
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Resumo R√°pido -->
                    <div class="lg:col-span-2">
                        <div class="glass-card p-6">
                            <h2 class="text-2xl font-bold text-gray-800 dark:text-white mb-4">üìä Vis√£o Geral do Seu Neg√≥cio</h2>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/30 p-4 rounded-xl">
                                    <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="dashFaturamento">R$ 0</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Faturamento Mensal</div>
                                </div>
                                <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/30 p-4 rounded-xl">
                                    <div class="text-2xl font-bold text-green-600 dark:text-green-400" id="dashLucro">R$ 0</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Lucro Mensal</div>
                                </div>
                                <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/30 dark:to-purple-800/30 p-4 rounded-xl">
                                    <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="dashMargem">0%</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Margem de Lucro</div>
                                </div>
                                <div class="bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/30 dark:to-orange-800/30 p-4 rounded-xl">
                                    <div class="text-2xl font-bold text-orange-600 dark:text-orange-400" id="dashPontoEquilibrio">0</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400">Ponto de Equil√≠brio</div>
                                </div>
                            </div>
                            
                            <div class="chart-container-md">
                                <canvas id="dashGraficoResumo"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- A√ß√µes R√°pidas -->
                    <div>
                        <div class="glass-card p-6 h-full">
                            <h3 class="text-xl font-bold text-gray-800 dark:text-white mb-4">üöÄ A√ß√µes R√°pidas</h3>
                            <div class="space-y-3">
                                <button onclick="openTab('dados')" class="w-full text-left p-4 bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl hover-lift border border-blue-200 dark:border-blue-800">
                                    <div class="font-medium text-blue-700 dark:text-blue-300">1. Preencher Dados B√°sicos</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Informa√ß√µes do seu neg√≥cio e produto</div>
                                </button>
                                
                                <button onclick="openTab('custos')" class="w-full text-left p-4 bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl hover-lift border border-green-200 dark:border-green-800">
                                    <div class="font-medium text-green-700 dark:text-green-300">2. Analisar Custos</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Mapear todos os gastos do neg√≥cio</div>
                                </button>
                                
                                <button onclick="openTab('precificacao')" class="w-full text-left p-4 bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl hover-lift border border-purple-200 dark:border-purple-800">
                                    <div class="font-medium text-purple-700 dark:text-purple-300">3. Definir Pre√ßo</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Escolher estrat√©gia de precifica√ß√£o</div>
                                </button>
                                
                                <button onclick="calcularTudo()" class="w-full p-4 gradient-primary text-white rounded-xl font-medium hover-lift mt-4">
                                    <i class="fas fa-bolt mr-2"></i> Calcular Tudo Agora
                                </button>
                            </div>
                            
                            <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                                <h4 class="font-medium text-gray-800 dark:text-white mb-3">üìà Progresso da An√°lise</h4>
                                <div class="space-y-2">
                                    <div class="flex justify-between text-sm">
                                        <span>Completude dos Dados</span>
                                        <span id="progressoDados">0%</span>
                                    </div>
                                    <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                        <div id="progressoBar" class="h-full gradient-primary rounded-full transition-all duration-500" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Cards Informativos -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                    <div class="glass-card p-6">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="bg-gradient-primary p-3 rounded-lg">
                                <i class="fas fa-lightbulb text-white text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 dark:text-white">üí° Por que Precificar Corretamente?</h4>
                            </div>
                        </div>
                        <p class="text-gray-600 dark:text-gray-400 text-sm">
                            A precifica√ß√£o correta √© essencial para garantir a sustentabilidade do seu neg√≥cio. Um pre√ßo muito baixo gera preju√≠zo, muito alto afasta clientes.
                        </p>
                    </div>
                    
                    <div class="glass-card p-6">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="bg-gradient-success p-3 rounded-lg">
                                <i class="fas fa-chart-line text-white text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 dark:text-white">üìä Metodologia Completa</h4>
                            </div>
                        </div>
                        <p class="text-gray-600 dark:text-gray-400 text-sm">
                            Usamos 5 m√©todos de precifica√ß√£o diferentes para voc√™ escolher a melhor estrat√©gia para seu neg√≥cio e mercado.
                        </p>
                    </div>
                    
                    <div class="glass-card p-6">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="bg-gradient-warning p-3 rounded-lg">
                                <i class="fas fa-cogs text-white text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 dark:text-white">‚öôÔ∏è Personaliza√ß√£o Total</h4>
                            </div>
                        </div>
                        <p class="text-gray-600 dark:text-gray-400 text-sm">
                            Adaptamos todas as an√°lises ao seu setor espec√≠fico, considerando caracter√≠sticas √∫nicas do seu produto ou servi√ßo.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Tab 1: Dados B√°sicos -->
            <div id="dados" class="tab-content">
                <div class="glass-card p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800 dark:text-white">üìù Dados B√°sicos do Neg√≥cio</h2>
                            <p class="text-gray-600 dark:text-gray-400">Informa√ß√µes fundamentais sobre sua empresa e produto/servi√ßo</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-gray-500">Preenchimento:</span>
                            <div class="w-32 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                <div class="h-full gradient-primary rounded-full transition-all duration-500" id="progressoDadosBar"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Formul√°rio em Passos -->
                    <div class="mb-8">
                        <div class="flex gap-4 mb-6 overflow-x-auto pb-4">
                            <button onclick="mostrarPassoDados(1)" id="passoDados1" class="px-4 py-2 rounded-lg bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 font-medium whitespace-nowrap">
                                <i class="fas fa-building mr-2"></i>Empresa
                            </button>
                            <button onclick="mostrarPassoDados(2)" id="passoDados2" class="px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium whitespace-nowrap">
                                <i class="fas fa-box mr-2"></i>Produto/Servi√ßo
                            </button>
                            <button onclick="mostrarPassoDados(3)" id="passoDados3" class="px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium whitespace-nowrap">
                                <i class="fas fa-users mr-2"></i>P√∫blico-Alvo
                            </button>
                            <button onclick="mostrarPassoDados(4)" id="passoDados4" class="px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium whitespace-nowrap">
                                <i class="fas fa-chart-bar mr-2"></i>Expectativas
                            </button>
                        </div>
                        
                        <!-- Passo 1: Empresa -->
                        <div id="conteudoPassoDados1" class="passo-conteudo">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="input-group">
                                    <label class="floating-label">Nome da Empresa *</label>
                                    <input type="text" id="empresaNome" class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition"
                                           placeholder="Ex: Minha Empresa MEI" oninput="atualizarProgresso()">
                                    <div class="text-xs text-gray-500 mt-2">Nome comercial do seu neg√≥cio</div>
                                </div>
                                
                                <div class="input-group">
                                    <label class="floating-label">CNPJ/CPF</label>
                                    <input type="text" id="empresaCnpj" class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition"
                                           placeholder="00.000.000/0000-00">
                                    <div class="text-xs text-gray-500 mt-2">CNPJ do MEI ou CPF se ainda n√£o tiver</div>
                                </div>
                                
                                <div class="input-group">
                                    <label class="floating-label">Setor de Atua√ß√£o *</label>
                                    <select id="setorEmpresa" class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" onchange="atualizarProgresso()">
                                        <option value="">Selecione o setor</option>
                                        <option value="alimentacao">üçï Alimenta√ß√£o</option>
                                        <option value="moda">üëó Moda/Confec√ß√£o</option>
                                        <option value="artesanato">üé® Artesanato</option>
                                        <option value="servicos">üîß Servi√ßos T√©cnicos</option>
                                        <option value="tecnologia">üíª Tecnologia</option>
                                        <option value="beleza">üíÑ Beleza & Est√©tica</option>
                                        <option value="consultoria">üìä Consultoria</option>
                                        <option value="educacao">üìö Educa√ß√£o</option>
                                        <option value="saude">üè• Sa√∫de & Bem-estar</option>
                                        <option value="construcao">üèóÔ∏è Constru√ß√£o Civil</option>
                                    </select>
                                    <div class="text-xs text-gray-500 mt-2">√Årea principal do seu neg√≥cio</div>
                                </div>
                                
                                <div class="input-group">
                                    <label class="floating-label">Tempo de Mercado</label>
                                    <select id="tempoMercado" class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition">
                                        <option value="">Selecione</option>
                                        <option value="iniciante">üöÄ Iniciante (menos de 6 meses)</option>
                                        <option value="estabilizando">üìà Estabilizando (6 meses - 2 anos)</option>
                                        <option value="consolidado">üèÜ Consolidado (2-5 anos)</option>
                                        <option value="experiente">üíé Experiente (mais de 5 anos)</option>
                                    </select>
                                    <div class="text-xs text-gray-500 mt-2">Tempo de atua√ß√£o no mercado</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Passo 2: Produto/Servi√ßo -->
                        <div id="conteudoPassoDados2" class="passo-conteudo hidden">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="input-group">
                                    <label class="floating-label">Nome do Produto/Servi√ßo *</label>
                                    <input type="text" id="nomeProduto" class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition"
                                           placeholder="Ex: Camiseta Personalizada Premium" oninput="atualizarProgresso()">
                                    <div class="text-xs text-gray-500 mt-2">Nome comercial do que voc√™ vende</div>
                                </div>
                                
                                <div class="input-group">
                                    <label class="floating-label">Categoria</label>
                                    <select id="categoriaProduto" class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition">
                                        <option value="">Selecione a categoria</option>
                                        <option value="produto_fisico">üì¶ Produto F√≠sico</option>
                                        <option value="servico">üîß Servi√ßo</option>
                                        <option value="digital">üíæ Produto Digital</option>
                                        <option value="assessoria">üìä Assessoria/Consultoria</option>
                                    </select>
                                    <div class="text-xs text-gray-500 mt-2">Tipo do seu produto/servi√ßo</div>
                                </div>
                                
                                <div class="md:col-span-2 input-group">
                                    <label class="floating-label">Descri√ß√£o Detalhada</label>
                                    <textarea id="descricaoProduto" rows="3" class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition"
                                              placeholder="Descreva seu produto/servi√ßo, benef√≠cios, diferenciais..."></textarea>
                                    <div class="text-xs text-gray-500 mt-2">Destaque o que torna seu produto √∫nico</div>
                                </div>
                                
                                <div class="input-group">
                                    <label class="floating-label">Unidade de Medida</label>
                                    <select id="unidadeMedida" class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition">
                                        <option value="unidade">üì¶ Unidade</option>
                                        <option value="hora">‚è∞ Hora</option>
                                        <option value="pacote">üéÅ Pacote/Kit</option>
                                        <option value="metro">üìè Metro</option>
                                        <option value="kg">‚öñÔ∏è Quilograma</option>
                                        <option value="litro">üß¥ Litro</option>
                                        <option value="mes">üìÖ M√™s (assinatura)</option>
                                    </select>
                                    <div class="text-xs text-gray-500 mt-2">Como voc√™ vende seu produto/servi√ßo</div>
                                </div>
                                
                                <div class="input-group">
                                    <label class="floating-label">C√≥digo/SKU (opcional)</label>
                                    <input type="text" id="codigoProduto" class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition"
                                           placeholder="EX: PROD001">
                                    <div class="text-xs text-gray-500 mt-2">C√≥digo interno para controle</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Passo 3: P√∫blico-Alvo -->
                        <div id="conteudoPassoDados3" class="passo-conteudo hidden">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="input-group">
                                    <label class="floating-label">P√∫blico-Alvo Principal *</label>
                                    <select id="publicoAlvo" class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" oninput="atualizarProgresso()">
                                        <option value="">Selecione seu p√∫blico</option>
                                        <option value="jovens_adultos">üë®‚Äçüéì Jovens e Adultos (18-35)</option>
                                        <option value="adultos">üë®‚Äçüíº Adultos (26-45)</option>
                                        <option value="maduros">üë®‚Äçüî¨ Maduros (46-65)</option>
                                        <option value="familias">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Fam√≠lias</option>
                                        <option value="empresas">üè¢ Empresas (B2B)</option>
                                        <option value="mulheres">üë© Mulheres</option>
                                        <option value="homens">üë® Homens</option>
                                        <option value="criancas">üßí Crian√ßas</option>
                                        <option value="idosos">üëµ Idosos</option>
                                    </select>
                                    <div class="text-xs text-gray-500 mt-2">Quem s√£o seus principais clientes</div>
                                </div>
                                
                                <div class="input-group">
                                    <label class="floating-label">Poder de Compra do Cliente</label>
                                    <select id="poderCompra" class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition">
                                        <option value="">Selecione o poder de compra</option>
                                        <option value="baixo">üí∞ Baixo (at√© R$ 100)</option>
                                        <option value="medio_baixo">üí∞üí∞ M√©dio-baixo (R$ 100-300)</option>
                                        <option value="medio">üí∞üí∞üí∞ M√©dio (R$ 300-800)</option>
                                        <option value="medio_alto">üí∞üí∞üí∞üí∞ M√©dio-alto (R$ 800-2.000)</option>
                                        <option value="alto">üí∞üí∞üí∞üí∞üí∞ Alto (acima de R$ 2.000)</option>
                                    </select>
                                    <div class="text-xs text-gray-500 mt-2">Quanto seu cliente pode pagar</div>
                                </div>
                                
                                <div class="md:col-span-2 input-group">
                                    <label class="floating-label">Caracter√≠sticas do P√∫blico-Alvo</label>
                                    <textarea id="caracteristicasPublico" rows="2" class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition"
                                              placeholder="Ex: Valorizam qualidade, sustentabilidade, pre√ßo justo..."></textarea>
                                    <div class="text-xs text-gray-500 mt-2">O que √© importante para seus clientes</div>
                                </div>
                                
                                <div class="input-group">
                                    <label class="floating-label">Localiza√ß√£o Principal</label>
                                    <select id="localizacaoPublico" class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition">
                                        <option value="">Selecione a localiza√ß√£o</option>
                                        <option value="local">üìç Local/Cidade</option>
                                        <option value="regional">üó∫Ô∏è Regional</option>
                                        <option value="nacional">üáßüá∑ Nacional</option>
                                        <option value="internacional">üåç Internacional</option>
                                    </select>
                                    <div class="text-xs text-gray-500 mt-2">Onde seus clientes est√£o</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Passo 4: Expectativas -->
                        <div id="conteudoPassoDados4" class="passo-conteudo hidden">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="input-group">
                                    <label class="floating-label">Quantidade Mensal Esperada *</label>
                                    <input type="number" id="qtdVendaMensal" value="100" min="1" 
                                           class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" oninput="atualizarProgresso()">
                                    <div class="text-xs text-gray-500 mt-2">Unidades que espera vender por m√™s</div>
                                </div>
                                
                                <div class="input-group">
                                    <label class="floating-label">Sazonalidade</label>
                                    <select id="sazonalidade" class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition">
                                        <option value="constante">üìÖ Constante o ano todo</option>
                                        <option value="alta_natal">üéÑ Alta no Natal/Fim de Ano</option>
                                        <option value="alta_ferias">üèñÔ∏è Alta nas F√©rias</option>
                                        <option value="especifica">üéØ Alta em datas espec√≠ficas</option>
                                        <option value="variavel">üìä Muito vari√°vel</option>
                                    </select>
                                    <div class="text-xs text-gray-500 mt-2">Como as vendas variam no ano</div>
                                </div>
                                
                                <div class="input-group">
                                    <label class="floating-label">Taxa de Crescimento Esperada (%)</label>
                                    <input type="number" id="taxaCrescimento" value="10" min="0" max="100" step="1"
                                           class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition">
                                    <div class="text-xs text-gray-500 mt-2">Crescimento mensal esperado</div>
                                </div>
                                
                                <div class="input-group">
                                    <label class="floating-label">Meta de Faturamento (R$)</label>
                                    <input type="number" id="metaFaturamento" value="10000" min="0"
                                           class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition">
                                    <div class="text-xs text-gray-500 mt-2">Faturamento mensal desejado</div>
                                </div>
                            </div>
                            
                            <div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl">
                                <div class="flex items-center gap-3 mb-2">
                                    <i class="fas fa-lightbulb text-blue-600 dark:text-blue-400"></i>
                                    <h4 class="font-medium text-blue-800 dark:text-blue-300">üí° Dica sobre Estimativas</h4>
                                </div>
                                <p class="text-sm text-blue-700 dark:text-blue-400">
                                    Baseie suas estimativas em dados reais quando poss√≠vel. Se for iniciante, comece com n√∫meros conservadores e ajuste conforme o mercado responde.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navega√ß√£o entre Passos -->
                    <div class="flex justify-between pt-6 border-t border-gray-200 dark:border-gray-700">
                        <button onclick="voltarPassoDados()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                            <i class="fas fa-arrow-left mr-2"></i> Voltar
                        </button>
                        
                        <div class="flex gap-3">
                            <button onclick="salvarRascunho()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover:bg-gray-300 dark:hover:bg-gray-600 transition">
                                <i class="fas fa-save mr-2"></i> Salvar Rascunho
                            </button>
                            
                            <button onclick="avancarPassoDados()" id="btnAvancarDados" class="px-6 py-3 gradient-primary text-white rounded-xl font-medium hover-lift">
                                Continuar <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 2: An√°lise de Custos -->
            <div id="custos" class="tab-content">
                <div class="glass-card p-6">
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800 dark:text-white">üí∞ An√°lise Detalhada de Custos</h2>
                            <p class="text-gray-600 dark:text-gray-400">Mapeie todos os custos do seu neg√≥cio para calcular o pre√ßo correto</p>
                        </div>
                        <button onclick="sugerirCustosPorSetor()" class="px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg font-medium hover-lift">
                            <i class="fas fa-magic mr-2"></i> Sugerir Custos
                        </button>
                    </div>
                    
                    <!-- Templates por Setor -->
                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">‚ö° Templates R√°pidos por Setor</h3>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-3">
                            <button onclick="aplicarTemplateSetor('alimentacao')" class="p-4 bg-gradient-to-br from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 rounded-xl border border-orange-200 dark:border-orange-800 hover-lift">
                                <div class="text-2xl mb-2">üçï</div>
                                <div class="font-medium">Alimenta√ß√£o</div>
                            </button>
                            <button onclick="aplicarTemplateSetor('moda')" class="p-4 bg-gradient-to-br from-pink-50 to-rose-50 dark:from-pink-900/20 dark:to-rose-900/20 rounded-xl border border-pink-200 dark:border-pink-800 hover-lift">
                                <div class="text-2xl mb-2">üëó</div>
                                <div class="font-medium">Moda</div>
                            </button>
                            <button onclick="aplicarTemplateSetor('servicos')" class="p-4 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl border border-blue-200 dark:border-blue-800 hover-lift">
                                <div class="text-2xl mb-2">üîß</div>
                                <div class="font-medium">Servi√ßos</div>
                            </button>
                            <button onclick="aplicarTemplateSetor('tecnologia')" class="p-4 bg-gradient-to-br from-purple-50 to-violet-50 dark:from-purple-900/20 dark:to-violet-900/20 rounded-xl border border-purple-200 dark:border-purple-800 hover-lift">
                                <div class="text-2xl mb-2">üíª</div>
                                <div class="font-medium">Tecnologia</div>
                            </button>
                            <button onclick="aplicarTemplateSetor('artesanato')" class="p-4 bg-gradient-to-br from-yellow-50 to-amber-50 dark:from-yellow-900/20 dark:to-amber-900/20 rounded-xl border border-yellow-200 dark:border-yellow-800 hover-lift">
                                <div class="text-2xl mb-2">üé®</div>
                                <div class="font-medium">Artesanato</div>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Resumo dos Custos -->
                    <div class="mb-8 p-6 bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-xl">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">üìä Resumo dos Custos</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="resumoCustoUnitario">R$ 0,00</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Custo por Unidade</div>
                            </div>
                            <div class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                <div class="text-2xl font-bold text-red-600 dark:text-red-400" id="resumoCustoFixo">R$ 0,00</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Custos Fixos Mensais</div>
                            </div>
                            <div class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="resumoCustoTotal">R$ 0,00</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Custo Total Mensal</div>
                            </div>
                            <div class="text-center p-4 bg-white dark:bg-gray-800 rounded-lg">
                                <div class="text-2xl font-bold text-green-600 dark:text-green-400" id="resumoMarkupSugerido">0%</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Markup Sugerido</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Formul√°rio de Custos -->
                    <div class="grid lg:grid-cols-2 gap-8">
                        <!-- Custos Vari√°veis -->
                        <div>
                            <div class="bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-900/10 dark:to-orange-900/10 p-6 rounded-xl border border-red-100 dark:border-red-800">
                                <h3 class="text-xl font-bold text-red-800 dark:text-red-300 mb-6 flex items-center gap-2">
                                    <i class="fas fa-chart-line"></i>
                                    Custos Vari√°veis (por unidade)
                                    <span class="info-bubble" data-tooltip="Custos que mudam conforme voc√™ vende mais ou menos">?</span>
                                </h3>
                                
                                <div class="space-y-4">
                                    <div class="input-group">
                                        <label class="floating-label">Mat√©ria-Prima/Insumos *</label>
                                        <input type="number" step="0.01" id="materiaPrima" value="15.00" 
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-red-500 focus:ring-2 focus:ring-red-200 outline-none transition" oninput="calcularCustos()">
                                        <div class="text-xs text-gray-500 mt-2">Custo dos materiais para produzir UMA unidade</div>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="floating-label">Embalagem/Acabamento</label>
                                        <input type="number" step="0.01" id="embalagem" value="2.50" 
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-red-500 focus:ring-2 focus:ring-red-200 outline-none transition" oninput="calcularCustos()">
                                        <div class="text-xs text-gray-500 mt-2">Custo de embalagem por unidade vendida</div>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="floating-label">Frete/Entrega</label>
                                        <input type="number" step="0.01" id="frete" value="8.00" 
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-red-500 focus:ring-2 focus:ring-red-200 outline-none transition" oninput="calcularCustos()">
                                        <div class="text-xs text-gray-500 mt-2">Custo de envio para o cliente</div>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="floating-label">Comiss√µes de Venda (%)</label>
                                        <input type="number" step="0.1" id="comissoesPercent" value="10" min="0" max="100"
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-red-500 focus:ring-2 focus:ring-red-200 outline-none transition" oninput="calcularCustos()">
                                        <div class="text-xs text-gray-500 mt-2">Porcentagem paga por venda (se aplic√°vel)</div>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="floating-label">Impostos sobre Venda (%)</label>
                                        <input type="number" step="0.1" id="impostosVenda" value="7" min="0" max="100"
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-red-500 focus:ring-2 focus:ring-red-200 outline-none transition" oninput="calcularCustos()">
                                        <div class="text-xs text-gray-500 mt-2">ICMS, ISS ou outros impostos sobre venda</div>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="floating-label">Taxas de Plataforma (%)</label>
                                        <input type="number" step="0.1" id="taxasPlataforma" value="12" min="0" max="100"
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-red-500 focus:ring-2 focus:ring-red-200 outline-none transition" oninput="calcularCustos()">
                                        <div class="text-xs text-gray-500 mt-2">Mercado Livre, iFood, etc.</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Custos de Software/Ferramentas -->
                            <div class="mt-6 bg-gradient-to-br from-purple-50 to-indigo-50 dark:from-purple-900/10 dark:to-indigo-900/10 p-6 rounded-xl border border-purple-100 dark:border-purple-800">
                                <h3 class="text-xl font-bold text-purple-800 dark:text-purple-300 mb-6 flex items-center gap-2">
                                    <i class="fas fa-laptop-code"></i>
                                    Custos de Software & Ferramentas
                                </h3>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="input-group">
                                        <label class="floating-label">Gest√£o/Contabilidade</label>
                                        <input type="number" step="0.01" id="softwareGestao" value="49.90" 
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition" oninput="calcularCustos()">
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="floating-label">Design/Criativo</label>
                                        <input type="number" step="0.01" id="softwareDesign" value="29.90" 
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition" oninput="calcularCustos()">
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="floating-label">Marketing</label>
                                        <input type="number" step="0.01" id="softwareMarketing" value="19.90" 
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition" oninput="calcularCustos()">
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="floating-label">Outros Softwares</label>
                                        <input type="number" step="0.01" id="softwareOutros" value="0" 
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-purple-500 focus:ring-2 focus:ring-purple-200 outline-none transition" oninput="calcularCustos()">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Custos Fixos -->
                        <div>
                            <div class="bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/10 dark:to-cyan-900/10 p-6 rounded-xl border border-blue-100 dark:border-blue-800">
                                <h3 class="text-xl font-bold text-blue-800 dark:text-blue-300 mb-6 flex items-center gap-2">
                                    <i class="fas fa-home"></i>
                                    Custos Fixos Mensais
                                    <span class="info-bubble" data-tooltip="Custos que n√£o mudam com o volume de vendas">?</span>
                                </h3>
                                
                                <div class="space-y-4">
                                    <div class="input-group">
                                        <label class="floating-label">Aluguel/Financiamento</label>
                                        <input type="number" step="0.01" id="aluguel" value="800.00" 
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" oninput="calcularCustos()">
                                        <div class="text-xs text-gray-500 mt-2">Custo do espa√ßo f√≠sico</div>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="floating-label">Sal√°rio/Pr√≥-labore *</label>
                                        <input type="number" step="0.01" id="salarios" value="1500.00" 
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" oninput="calcularCustos()">
                                        <div class="text-xs text-gray-500 mt-2">Seu sal√°rio ou pr√≥-labore</div>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="floating-label">Contas (Luz/√Ågua/Internet)</label>
                                        <input type="number" step="0.01" id="contas" value="300.00" 
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" oninput="calcularCustos()">
                                        <div class="text-xs text-gray-500 mt-2">Despesas b√°sicas mensais</div>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="floating-label">Marketing/Publicidade</label>
                                        <input type="number" step="0.01" id="marketing" value="200.00" 
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" oninput="calcularCustos()">
                                        <div class="text-xs text-gray-500 mt-2">Investimento em divulga√ß√£o</div>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="floating-label">DAS (Imposto MEI)</label>
                                        <input type="number" step="0.01" id="das" value="70.90" 
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" oninput="calcularCustos()">
                                        <div class="text-xs text-gray-500 mt-2">Imposto fixo mensal do MEI</div>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="floating-label">Manuten√ß√£o/Reparos</label>
                                        <input type="number" step="0.01" id="manutencao" value="100.00" 
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" oninput="calcularCustos()">
                                        <div class="text-xs text-gray-500 mt-2">Manuten√ß√£o de equipamentos</div>
                                    </div>
                                    
                                    <div class="input-group">
                                        <label class="floating-label">Outros Custos Fixos</label>
                                        <input type="number" step="0.01" id="outrosFixos" value="0" 
                                               class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition" oninput="calcularCustos()">
                                        <div class="text-xs text-gray-500 mt-2">Outras despesas fixas mensais</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- An√°lise de Custo-Benef√≠cio -->
                            <div class="mt-6 p-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/10 dark:to-emerald-900/10 rounded-xl border border-green-100 dark:border-green-800">
                                <h3 class="text-lg font-bold text-green-800 dark:text-green-300 mb-4">üìà An√°lise de Custo-Benef√≠cio</h3>
                                
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-700 dark:text-gray-300">Custo-Benef√≠cio:</span>
                                        <div class="flex items-center gap-2">
                                            <div class="w-32 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                                <div id="custoBeneficioBar" class="h-full rounded-full" style="width: 75%; background: linear-gradient(to right, #ef4444, #f59e0b, #10b981);"></div>
                                            </div>
                                            <span id="custoBeneficioTexto" class="font-bold text-green-600 dark:text-green-400">Bom</span>
                                        </div>
                                    </div>
                                    
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-700 dark:text-gray-300">Oportunidade de Redu√ß√£o:</span>
                                        <span id="oportunidadeReducao" class="font-bold text-red-600 dark:text-red-400">15%</span>
                                    </div>
                                    
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-700 dark:text-gray-300">Custos Desnecess√°rios:</span>
                                        <span id="custosDesnecessarios" class="font-bold text-yellow-600 dark:text-yellow-400">R$ 150/m√™s</span>
                                    </div>
                                </div>
                                
                                <div class="mt-4 p-3 bg-green-100 dark:bg-green-900/30 rounded-lg">
                                    <p class="text-sm text-green-800 dark:text-green-300">
                                        <i class="fas fa-lightbulb mr-2"></i>
                                        <strong>Dica:</strong> Reduzir custos fixos em 10% aumentaria seu lucro em <span id="impactoReducaoCustos" class="font-bold">R$ 287/m√™s</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navega√ß√£o -->
                    <div class="flex justify-between pt-6 mt-8 border-t border-gray-200 dark:border-gray-700">
                        <button onclick="openTab('dados')" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover-lift">
                            <i class="fas fa-arrow-left mr-2"></i> Voltar para Dados
                        </button>
                        
                        <button onclick="calcularCustos(); openTab('precificacao')" class="px-6 py-3 gradient-primary text-white rounded-xl font-medium hover-lift">
                            Continuar para Precifica√ß√£o <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab 3: Estrat√©gias de Precifica√ß√£o -->
            <div id="precificacao" class="tab-content">
                <div class="glass-card p-6">
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">üéØ Estrat√©gias de Precifica√ß√£o Inteligente</h2>
                        <p class="text-gray-600 dark:text-gray-400">Escolha a melhor estrat√©gia para seu produto/servi√ßo e mercado</p>
                    </div>
                    
                    <!-- M√©todos de Precifica√ß√£o -->
                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">üìä M√©todos de Precifica√ß√£o Dispon√≠veis</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="p-4 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl border-2 border-blue-200 dark:border-blue-800">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="bg-blue-100 dark:bg-blue-900 p-2 rounded-lg">
                                        <i class="fas fa-calculator text-blue-600 dark:text-blue-400"></i>
                                    </div>
                                    <h4 class="font-bold text-blue-800 dark:text-blue-300">Markup</h4>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Adiciona uma porcentagem fixa sobre o custo</p>
                                <button onclick="selecionarMetodo('markup')" class="w-full px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm font-medium">Usar este m√©todo</button>
                            </div>
                            
                            <div class="p-4 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl border-2 border-green-200 dark:border-green-800">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="bg-green-100 dark:bg-green-900 p-2 rounded-lg">
                                        <i class="fas fa-percentage text-green-600 dark:text-green-400"></i>
                                    </div>
                                    <h4 class="font-bold text-green-800 dark:text-green-300">Margem de Lucro</h4>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Define o lucro como % do pre√ßo de venda</p>
                                <button onclick="selecionarMetodo('margem')" class="w-full px-3 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium">Usar este m√©todo</button>
                            </div>
                            
                            <div class="p-4 bg-gradient-to-br from-purple-50 to-violet-50 dark:from-purple-900/20 dark:to-violet-900/20 rounded-xl border-2 border-purple-200 dark:border-purple-800">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="bg-purple-100 dark:bg-purple-900 p-2 rounded-lg">
                                        <i class="fas fa-balance-scale text-purple-600 dark:text-purple-400"></i>
                                    </div>
                                    <h4 class="font-bold text-purple-800 dark:text-purple-300">Pre√ßo de Mercado</h4>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Baseado nos pre√ßos da concorr√™ncia</p>
                                <button onclick="selecionarMetodo('mercado')" class="w-full px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm font-medium">Usar este m√©todo</button>
                            </div>
                            
                            <div class="p-4 bg-gradient-to-br from-orange-50 to-amber-50 dark:from-orange-900/20 dark:to-amber-900/20 rounded-xl border-2 border-orange-200 dark:border-orange-800">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="bg-orange-100 dark:bg-orange-900 p-2 rounded-lg">
                                        <i class="fas fa-lightbulb text-orange-600 dark:text-orange-400"></i>
                                    </div>
                                    <h4 class="font-bold text-orange-800 dark:text-orange-300">Valor Percebido</h4>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Baseado no valor que o cliente percebe</p>
                                <button onclick="selecionarMetodo('valor')" class="w-full px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-lg text-sm font-medium">Usar este m√©todo</button>
                            </div>
                            
                            <div class="p-4 bg-gradient-to-br from-red-50 to-pink-50 dark:from-red-900/20 dark:to-pink-900/20 rounded-xl border-2 border-red-200 dark:border-red-800">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="bg-red-100 dark:bg-red-900 p-2 rounded-lg">
                                        <i class="fas fa-bullseye text-red-600 dark:text-red-400"></i>
                                    </div>
                                    <h4 class="font-bold text-red-800 dark:text-red-300">Pre√ßo Psicol√≥gico</h4>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">Usa pre√ßos que parecem mais atrativos</p>
                                <button onclick="selecionarMetodo('psicologico')" class="w-full px-3 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium">Usar este m√©todo</button>
                            </div>
                            
                            <div class="p-4 bg-gradient-to-br from-gray-50 to-slate-50 dark:from-gray-800 dark:to-slate-800 rounded-xl border-2 border-gray-200 dark:border-gray-700">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="bg-gray-100 dark:bg-gray-700 p-2 rounded-lg">
                                        <i class="fas fa-robot text-gray-600 dark:text-gray-400"></i>
                                    </div>
                                    <h4 class="font-bold text-gray-800 dark:text-gray-300">Recomenda√ß√£o IA</h4>
                                </div>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">An√°lise autom√°tica do melhor m√©todo</p>
                                <button onclick="selecionarMetodo('recomendacao')" class="w-full px-3 py-2 bg-gray-700 hover:bg-gray-800 text-white rounded-lg text-sm font-medium">Usar este m√©todo</button>
                            </div>
                        </div>
                        
                        <div class="p-4 bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 rounded-xl">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-info-circle text-blue-600 dark:text-blue-400 text-xl"></i>
                                <div>
                                    <p class="text-sm text-blue-800 dark:text-blue-300">
                                        <strong>M√©todo Selecionado:</strong> <span id="metodoSelecionado" class="font-bold">Markup (Recomendado para iniciantes)</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Configura√ß√£o do M√©todo Selecionado -->
                    <div id="configMetodoMarkup" class="metodo-config">
                        <div class="grid lg:grid-cols-2 gap-8">
                            <div>
                                <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">‚öôÔ∏è Configura√ß√£o do Markup</h3>
                                
                                <div class="space-y-6">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Markup Desejado (%)
                                            <span class="info-bubble" data-tooltip="Percentual que voc√™ adiciona sobre o custo para formar o pre√ßo">?</span>
                                        </label>
                                        <div class="flex items-center gap-4">
                                            <input type="range" min="10" max="300" value="100" step="1" id="markupSlider" 
                                                   class="custom-slider" oninput="atualizarMarkup(this.value)">
                                            <input type="number" min="10" max="300" value="100" step="1" id="markupInput" 
                                                   class="w-24 px-3 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-center font-bold"
                                                   oninput="atualizarMarkup(this.value)">
                                        </div>
                                        <div class="text-xs text-gray-500 mt-2">Recomenda√ß√£o: 60-150% para maioria dos produtos</div>
                                    </div>
                                    
                                    <div class="p-4 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl">
                                        <h4 class="font-bold text-blue-800 dark:text-blue-300 mb-2">üìä Pre√ßos Sugeridos por Markup</h4>
                                        <div class="grid grid-cols-2 gap-3">
                                            <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
                                                <div class="text-lg font-bold text-green-600 dark:text-green-400" id="precoMarkupMin">R$ 0</div>
                                                <div class="text-xs text-gray-600 dark:text-gray-400">Markup 60%</div>
                                            </div>
                                            <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
                                                <div class="text-lg font-bold text-blue-600 dark:text-blue-400" id="precoMarkupMedio">R$ 0</div>
                                                <div class="text-xs text-gray-600 dark:text-gray-400">Markup 100%</div>
                                            </div>
                                            <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
                                                <div class="text-lg font-bold text-purple-600 dark:text-purple-400" id="precoMarkupMax">R$ 0</div>
                                                <div class="text-xs text-gray-600 dark:text-gray-400">Markup 150%</div>
                                            </div>
                                            <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
                                                <div class="text-lg font-bold text-orange-600 dark:text-orange-400" id="precoMarkupAtual">R$ 0</div>
                                                <div class="text-xs text-gray-600 dark:text-gray-400">Seu Markup</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            Pre√ßo Final Sugerido
                                        </label>
                                        <div class="text-3xl font-bold text-green-600 dark:text-green-400" id="precoFinalSugerido">R$ 0,00</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Baseado no markup selecionado</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">üßÆ Composi√ß√£o do Pre√ßo</h3>
                                
                                <div class="space-y-3 mb-6">
                                    <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg price-breakdown-item">
                                        <span class="text-gray-700 dark:text-gray-300">Custo Vari√°vel Unit√°rio:</span>
                                        <span class="font-bold" id="compCustoVarUnit">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg price-breakdown-item">
                                        <span class="text-gray-700 dark:text-gray-300">Custo Fixo por Unidade:</span>
                                        <span class="font-bold" id="compCustoFixoUnit">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg price-breakdown-item">
                                        <span class="text-gray-700 dark:text-gray-300">Custo Total Unit√°rio:</span>
                                        <span class="font-bold text-red-600 dark:text-red-400" id="compCustoTotalUnit">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg price-breakdown-item">
                                        <span class="text-blue-700 dark:text-blue-300">Markup Aplicado:</span>
                                        <span class="font-bold text-blue-600 dark:text-blue-400" id="compMarkupAplicado">0%</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-green-50 dark:bg-green-900/30 rounded-lg price-breakdown-item">
                                        <span class="text-green-700 dark:text-green-300 font-bold">Pre√ßo Final:</span>
                                        <span class="text-2xl font-bold text-green-600 dark:text-green-400" id="compPrecoFinal">R$ 0,00</span>
                                    </div>
                                </div>
                                
                                <!-- Gr√°fico de Composi√ß√£o -->
                                <div class="chart-container-sm">
                                    <canvas id="graficoComposicaoPreco"></canvas>
                                </div>
                                
                                <div class="mt-4 p-3 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl">
                                    <p class="text-sm text-green-800 dark:text-green-300">
                                        <i class="fas fa-chart-line mr-2"></i>
                                        <strong>Lucro por unidade:</strong> <span id="lucroPorUnidade" class="font-bold">R$ 0,00</span>
                                        (<span id="margemLucroUnidade" class="font-bold">0%</span> do pre√ßo)
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Pre√ßo Psicol√≥gico -->
                    <div class="mt-8 p-6 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl">
                        <h3 class="text-lg font-bold text-purple-800 dark:text-purple-300 mb-4">üé≠ Pre√ßo Psicol√≥gico</h3>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <button onclick="aplicarPrecoPsicologico('99')" class="p-4 bg-white dark:bg-gray-800 rounded-xl text-center hover-lift border border-purple-200 dark:border-purple-800">
                                <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="precoPsico99">R$ 0,99</div>
                                <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Final .99</div>
                            </button>
                            <button onclick="aplicarPrecoPsicologico('95')" class="p-4 bg-white dark:bg-gray-800 rounded-xl text-center hover-lift border border-purple-200 dark:border-purple-800">
                                <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="precoPsico95">R$ 0,95</div>
                                <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Final .95</div>
                            </button>
                            <button onclick="aplicarPrecoPsicologico('90')" class="p-4 bg-white dark:bg-gray-800 rounded-xl text-center hover-lift border border-purple-200 dark:border-purple-800">
                                <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="precoPsico90">R$ 0,90</div>
                                <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Final .90</div>
                            </button>
                            <button onclick="aplicarPrecoPsicologico('arredondado')" class="p-4 bg-white dark:bg-gray-800 rounded-xl text-center hover-lift border border-purple-200 dark:border-purple-800">
                                <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="precoPsicoArred">R$ 0</div>
                                <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Arredondado</div>
                            </button>
                        </div>
                        
                        <div class="mt-4 text-sm text-purple-700 dark:text-purple-400">
                            <i class="fas fa-lightbulb mr-2"></i>
                            Pre√ßos que terminam em .99, .95 ou .90 s√£o percebidos como mais baratos, mesmo com diferen√ßa m√≠nima.
                        </div>
                    </div>
                    
                    <!-- Defini√ß√£o do Pre√ßo Final -->
                    <div class="mt-8 p-6 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl">
                        <h3 class="text-lg font-bold text-blue-800 dark:text-blue-300 mb-4">üéØ Defini√ß√£o do Seu Pre√ßo Final</h3>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Seu Pre√ßo de Venda (R$)
                                </label>
                                <input type="number" step="0.01" id="precoVendaFinal" value="0"
                                       class="w-full px-4 py-4 text-2xl font-bold border-2 border-blue-500 rounded-xl bg-white dark:bg-gray-800 text-center"
                                       oninput="atualizarPrecoFinal(this.value)">
                                <div class="text-xs text-gray-500 mt-2">Pre√ßo que voc√™ realmente vai cobrar</div>
                                
                                <div class="mt-4">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                        Desconto Promocional (%)
                                    </label>
                                    <input type="number" step="1" id="descontoPromocional" value="10" min="0" max="100"
                                           class="w-full px-4 py-2 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800"
                                           oninput="atualizarPrecoFinal()">
                                </div>
                            </div>
                            
                            <div>
                                <div class="p-4 bg-white dark:bg-gray-800 rounded-xl">
                                    <h4 class="font-bold text-gray-800 dark:text-white mb-3">üìä Impacto do Pre√ßo Escolhido</h4>
                                    
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Margem de Lucro:</span>
                                            <span id="impactoMargem" class="font-bold text-green-600 dark:text-green-400">0%</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Lucro por Unidade:</span>
                                            <span id="impactoLucroUnit" class="font-bold">R$ 0,00</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Lucro Mensal:</span>
                                            <span id="impactoLucroMensal" class="font-bold text-green-600 dark:text-green-400">R$ 0,00</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600 dark:text-gray-400">Ponto de Equil√≠brio:</span>
                                            <span id="impactoPontoEquilibrio" class="font-bold">0 unidades</span>
                                        </div>
                                    </div>
                                    
                                    <div class="mt-4 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg">
                                        <p class="text-sm text-blue-800 dark:text-blue-300">
                                            <i class="fas fa-balance-scale mr-2"></i>
                                            <strong>Recomenda√ß√£o:</strong> <span id="recomendacaoPreco" class="font-bold">Pre√ßo muito baixo</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navega√ß√£o -->
                    <div class="flex justify-between pt-6 mt-8 border-t border-gray-200 dark:border-gray-700">
                        <button onclick="openTab('custos')" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover-lift">
                            <i class="fas fa-arrow-left mr-2"></i> Voltar para Custos
                        </button>
                        
                        <button onclick="calcularTudo(); openTab('mercado')" class="px-6 py-3 gradient-primary text-white rounded-xl font-medium hover-lift">
                            Continuar para An√°lise de Mercado <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab 4: An√°lise de Mercado -->
            <div id="mercado" class="tab-content">
                <div class="glass-card p-6">
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">üèÜ An√°lise Completa de Mercado</h2>
                        <p class="text-gray-600 dark:text-gray-400">Compare seu pre√ßo com a concorr√™ncia e entenda seu posicionamento</p>
                    </div>
                    
                    <!-- Pesquisa de Concorr√™ncia -->
                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">üîç Pesquisa de Concorr√™ncia</h3>
                        
                        <div class="grid md:grid-cols-3 gap-6">
                            <div class="input-group">
                                <label class="floating-label">Pre√ßo M√≠nimo da Concorr√™ncia</label>
                                <input type="number" step="0.01" id="precoMinConcorrencia" value="45.00"
                                       class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800">
                                <div class="text-xs text-gray-500 mt-2">Menor pre√ßo encontrado</div>
                            </div>
                            
                            <div class="input-group">
                                <label class="floating-label">Pre√ßo M√©dio da Concorr√™ncia</label>
                                <input type="number" step="0.01" id="precoMedioConcorrencia" value="62.00"
                                       class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800">
                                <div class="text-xs text-gray-500 mt-2">Pre√ßo m√©dio do mercado</div>
                            </div>
                            
                            <div class="input-group">
                                <label class="floating-label">Pre√ßo M√°ximo da Concorr√™ncia</label>
                                <input type="number" step="0.01" id="precoMaxConcorrencia" value="85.00"
                                       class="w-full px-4 py-3 border-2 border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-800">
                                <div class="text-xs text-gray-500 mt-2">Maior pre√ßo encontrado</div>
                            </div>
                        </div>
                        
                        <button onclick="analisarConcorrencia()" class="mt-4 px-6 py-3 gradient-primary text-white rounded-xl font-medium hover-lift">
                            <i class="fas fa-search mr-2"></i> Analisar Posicionamento
                        </button>
                    </div>
                    
                    <!-- Resultado da An√°lise -->
                    <div class="mb-8 p-6 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl">
                        <h3 class="text-lg font-bold text-blue-800 dark:text-blue-300 mb-4">üìä Posicionamento no Mercado</h3>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <div class="mb-4">
                                    <div class="flex justify-between mb-2">
                                        <span class="text-gray-700 dark:text-gray-300">Sua Posi√ß√£o:</span>
                                        <span id="posicaoMercado" class="font-bold text-green-600 dark:text-green-400">No pre√ßo m√©dio</span>
                                    </div>
                                    <div class="h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                        <div class="h-full bg-gradient-to-r from-red-500 via-yellow-500 to-green-500" style="width: 100%"></div>
                                        <div id="marcadorPosicao" class="h-6 w-1 bg-blue-600 relative -top-1" style="left: 50%"></div>
                                    </div>
                                    <div class="flex justify-between text-xs mt-1">
                                        <span>Mais Barato</span>
                                        <span>M√©dio</span>
                                        <span>Mais Caro</span>
                                    </div>
                                </div>
                                
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Diferen√ßa para M√©dia:</span>
                                        <span id="diferencaMedia" class="font-bold text-blue-600 dark:text-blue-400">+4,8%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Vantagem Competitiva:</span>
                                        <span id="vantagemCompetitiva" class="font-bold text-green-600 dark:text-green-400">Boa</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Espa√ßo para Aumento:</span>
                                        <span id="espacoAumento" class="font-bold text-orange-600 dark:text-orange-400">27%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="chart-container-sm">
                                    <canvas id="graficoConcorrencia"></canvas>
                                </div>
                                
                                <div class="mt-4 p-3 bg-green-100 dark:bg-green-900/30 rounded-lg">
                                    <p class="text-sm text-green-800 dark:text-green-300">
                                        <i class="fas fa-check-circle mr-2"></i>
                                        <strong>An√°lise:</strong> Seu pre√ßo est√° <span id="analisePosicao" class="font-bold">bem posicionado</span> no mercado.
                                        Voc√™ n√£o √© o mais barato, mas oferece valor justo pelo pre√ßo.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- An√°lise de Valor Percebido -->
                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">üíé An√°lise de Valor Percebido</h3>
                        
                        <div class="p-6 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-bold text-purple-800 dark:text-purple-300 mb-3">O que seu cliente valoriza?</h4>
                                    
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                Qualidade do Produto/Servi√ßo
                                            </label>
                                            <input type="range" min="1" max="10" value="8" class="custom-slider" id="valorQualidade">
                                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                                <span>Pouco Importante</span>
                                                <span>Muito Importante</span>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                Atendimento/Suporte
                                            </label>
                                            <input type="range" min="1" max="10" value="7" class="custom-slider" id="valorAtendimento">
                                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                                <span>Pouco Importante</span>
                                                <span>Muito Importante</span>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                                Marca/Reputa√ß√£o
                                            </label>
                                            <input type="range" min="1" max="10" value="6" class="custom-slider" id="valorMarca">
                                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                                <span>Pouco Importante</span>
                                                <span>Muito Importante</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 class="font-bold text-purple-800 dark:text-purple-300 mb-3">Valor Percebido Total</h4>
                                    
                                    <div class="flex items-center justify-center mb-4">
                                        <div class="relative w-48 h-48">
                                            <svg class="progress-ring" width="192" height="192">
                                                <circle class="progress-ring__circle" stroke="#8b5cf6" stroke-width="12" fill="transparent" r="90" cx="96" cy="96"/>
                                            </svg>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <div class="text-center">
                                                    <div id="valorPercebidoScore" class="text-4xl font-bold text-purple-600 dark:text-purple-400">7.5</div>
                                                    <div class="text-sm text-gray-600 dark:text-gray-400">/10 pontos</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="text-center">
                                        <div class="text-lg font-bold text-purple-700 dark:text-purple-300" id="nivelValorPercebido">Valor Alto</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">Seu produto/servi√ßo √© bem valorizado</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-6 p-3 bg-purple-100 dark:bg-purple-900/30 rounded-lg">
                                <p class="text-sm text-purple-800 dark:text-purple-300">
                                    <i class="fas fa-lightbulb mr-2"></i>
                                    <strong>Insight:</strong> Seu valor percebido √© <span id="comparacaoValorPercebido" class="font-bold">alto</span>. 
                                    Isso permite que voc√™ cobre um pre√ßo <span id="premiumPermitido" class="font-bold">15-20% acima da m√©dia</span> do mercado.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Canais de Venda -->
                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">üõí An√°lise de Canais de Venda</h3>
                        
                        <div class="grid md:grid-cols-3 gap-6">
                            <div class="p-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl">
                                <h4 class="font-bold text-green-800 dark:text-green-300 mb-3">Vendas Diretas</h4>
                                <div class="text-3xl font-bold text-green-600 dark:text-green-400 mb-2">40%</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Loja f√≠sica, WhatsApp, telefone</div>
                                <div class="mt-3">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Taxa M√©dia (%)</label>
                                    <input type="number" step="0.1" value="5" class="w-full px-3 py-2 border rounded-lg" id="taxaDiretas">
                                </div>
                            </div>
                            
                            <div class="p-6 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl">
                                <h4 class="font-bold text-blue-800 dark:text-blue-300 mb-3">Marketplaces</h4>
                                <div class="text-3xl font-bold text-blue-600 dark:text-blue-400 mb-2">35%</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Mercado Livre, Amazon, Shopee</div>
                                <div class="mt-3">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Taxa M√©dia (%)</label>
                                    <input type="number" step="0.1" value="15" class="w-full px-3 py-2 border rounded-lg" id="taxaMarketplaces">
                                </div>
                            </div>
                            
                            <div class="p-6 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl">
                                <h4 class="font-bold text-purple-800 dark:text-purple-300 mb-3">Redes Sociais</h4>
                                <div class="text-3xl font-bold text-purple-600 dark:text-purple-400 mb-2">25%</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400">Instagram, Facebook, TikTok</div>
                                <div class="mt-3">
                                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Taxa M√©dia (%)</label>
                                    <input type="number" step="0.1" value="10" class="w-full px-3 py-2 border rounded-lg" id="taxaRedesSociais">
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 p-3 bg-blue-100 dark:bg-blue-900/30 rounded-lg">
                            <p class="text-sm text-blue-800 dark:text-blue-300">
                                <i class="fas fa-chart-pie mr-2"></i>
                                <strong>Recomenda√ß√£o:</strong> Foque em aumentar as <span class="font-bold">vendas diretas</span> que t√™m taxa menor,
                                reduzindo depend√™ncia de marketplaces com taxas altas.
                            </p>
                        </div>
                    </div>
                    
                    <!-- Navega√ß√£o -->
                    <div class="flex justify-between pt-6 mt-8 border-t border-gray-200 dark:border-gray-700">
                        <button onclick="openTab('precificacao')" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover-lift">
                            <i class="fas fa-arrow-left mr-2"></i> Voltar para Precifica√ß√£o
                        </button>
                        
                        <button onclick="calcularTudo(); openTab('resultados')" class="px-6 py-3 gradient-primary text-white rounded-xl font-medium hover-lift">
                            Ver Resultados Financeiros <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab 5: Resultados Financeiros -->
            <div id="resultados" class="tab-content">
                <div class="glass-card p-6">
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">üíº Resultados Financeiros Completos</h2>
                        <p class="text-gray-600 dark:text-gray-400">An√°lise detalhada da sa√∫de financeira do seu neg√≥cio</p>
                    </div>
                    
                    <!-- KPIs Principais -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                        <div class="p-6 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl text-center">
                            <div class="text-3xl font-bold text-blue-600 dark:text-blue-400" id="kpiFaturamento">R$ 0</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Faturamento Mensal</div>
                            <div class="mt-2 text-xs text-green-600 dark:text-green-400" id="kpiFaturamentoVar">+0%</div>
                        </div>
                        
                        <div class="p-6 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl text-center">
                            <div class="text-3xl font-bold text-green-600 dark:text-green-400" id="kpiLucro">R$ 0</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Lucro Mensal</div>
                            <div class="mt-2 text-xs text-green-600 dark:text-green-400" id="kpiLucroVar">+0%</div>
                        </div>
                        
                        <div class="p-6 bg-gradient-to-br from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl text-center">
                            <div class="text-3xl font-bold text-purple-600 dark:text-purple-400" id="kpiMargem">0%</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Margem de Lucro</div>
                            <div class="mt-2 text-xs text-green-600 dark:text-green-400" id="kpiMargemVar">+0%</div>
                        </div>
                        
                        <div class="p-6 bg-gradient-to-br from-orange-50 to-amber-50 dark:from-orange-900/20 dark:to-amber-900/20 rounded-xl text-center">
                            <div class="text-3xl font-bold text-orange-600 dark:text-orange-400" id="kpiPontoEquilibrio">0</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400">Ponto de Equil√≠brio</div>
                            <div class="mt-2 text-xs text-green-600 dark:text-green-400" id="kpiPontoEquilibrioVar">-0%</div>
                        </div>
                    </div>
                    
                    <!-- An√°lise Detalhada -->
                    <div class="grid lg:grid-cols-2 gap-8 mb-8">
                        <div>
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">üìã Demonstra√ß√£o de Resultados</h3>
                            
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-4 bg-gray-50 dark:bg-gray-800 rounded-xl">
                                    <span class="text-gray-700 dark:text-gray-300">Receita Bruta Mensal:</span>
                                    <span class="font-bold text-green-600 dark:text-green-400" id="dresReceitaBruta">R$ 0,00</span>
                                </div>
                                
                                <div class="pl-6 space-y-2">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600 dark:text-gray-400">(-) Custo das Mercadorias Vendidas:</span>
                                        <span id="dresCustoMercadorias">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600 dark:text-gray-400">(-) Custos Vari√°veis:</span>
                                        <span id="dresCustosVariaveis">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600 dark:text-gray-400">(-) Custos Fixos:</span>
                                        <span id="dresCustosFixos">R$ 0,00</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600 dark:text-gray-400">(-) Impostos e Taxas:</span>
                                        <span id="dresImpostos">R$ 0,00</span>
                                    </div>
                                </div>
                                
                                <div class="flex justify-between items-center p-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl border border-green-200 dark:border-green-800">
                                    <span class="font-bold text-green-800 dark:text-green-300">= Lucro L√≠quido Mensal:</span>
                                    <span class="text-2xl font-bold text-green-600 dark:text-green-400" id="dresLucroLiquido">R$ 0,00</span>
                                </div>
                                
                                <div class="p-4 bg-blue-50 dark:bg-blue-900/30 rounded-xl">
                                    <div class="flex justify-between mb-2">
                                        <span class="text-blue-700 dark:text-blue-300">Margem de Lucro:</span>
                                        <span class="font-bold text-blue-600 dark:text-blue-400" id="dresMargemLucro">0%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-blue-700 dark:text-blue-300">Lucro por Unidade:</span>
                                        <span class="font-bold text-blue-600 dark:text-blue-400" id="dresLucroUnitario">R$ 0,00</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- An√°lise de Rentabilidade -->
                            <div class="mt-6">
                                <h4 class="font-bold text-gray-800 dark:text-white mb-3">üìà An√°lise de Rentabilidade</h4>
                                
                                <div class="grid grid-cols-2 gap-3">
                                    <div class="p-3 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-lg font-bold text-green-600 dark:text-green-400" id="rentabilidadeROI">0%</div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">ROI (Retorno Invest.)</div>
                                    </div>
                                    <div class="p-3 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-lg font-bold text-blue-600 dark:text-blue-400" id="rentabilidadePayback">0</div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">Payback (meses)</div>
                                    </div>
                                    <div class="p-3 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-lg font-bold text-purple-600 dark:text-purple-400" id="rentabilidadeLucroAnual">R$ 0</div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">Lucro Anual</div>
                                    </div>
                                    <div class="p-3 bg-white dark:bg-gray-800 rounded-lg">
                                        <div class="text-lg font-bold text-orange-600 dark:text-orange-400" id="rentabilidadeTicketMedio">R$ 0</div>
                                        <div class="text-xs text-gray-600 dark:text-gray-400">Ticket M√©dio</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">üìä Gr√°ficos de Resultados</h3>
                            
                            <div class="space-y-6">
                                <div class="chart-container-md">
                                    <canvas id="graficoDistribuicaoResultados"></canvas>
                                </div>
                                
                                <div class="chart-container-sm">
                                    <canvas id="graficoEvolucaoLucro"></canvas>
                                </div>
                                
                                <div class="p-4 bg-gradient-to-r from-orange-50 to-amber-50 dark:from-orange-900/20 dark:to-amber-900/20 rounded-xl">
                                    <h4 class="font-bold text-orange-800 dark:text-orange-300 mb-2">‚öñÔ∏è An√°lise de Ponto de Equil√≠brio</h4>
                                    <p class="text-sm text-orange-700 dark:text-orange-400">
                                        Voc√™ precisa vender <span id="analisePontoEquilibrioUn" class="font-bold">0 unidades</span> por m√™s 
                                        para cobrir todos os custos. Isso representa 
                                        <span id="analisePontoEquilibrioPercent" class="font-bold">0%</span> da sua capacidade atual.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- An√°lise de Sensibilidade -->
                    <div class="mb-8 p-6 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl">
                        <h3 class="text-lg font-bold text-blue-800 dark:text-blue-300 mb-4">üéöÔ∏è An√°lise de Sensibilidade</h3>
                        
                        <div class="grid md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Varia√ß√£o no Pre√ßo (¬±%)
                                </label>
                                <input type="range" min="-30" max="30" value="0" class="custom-slider" id="sensibilidadePreco" oninput="atualizarSensibilidade()">
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>-30%</span>
                                    <span>0%</span>
                                    <span>+30%</span>
                                </div>
                                <div class="mt-2 text-center">
                                    <span class="font-bold" id="sensibilidadePrecoValor">0%</span>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Varia√ß√£o nos Custos (¬±%)
                                </label>
                                <input type="range" min="-30" max="30" value="0" class="custom-slider" id="sensibilidadeCusto" oninput="atualizarSensibilidade()">
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>-30%</span>
                                    <span>0%</span>
                                    <span>+30%</span>
                                </div>
                                <div class="mt-2 text-center">
                                    <span class="font-bold" id="sensibilidadeCustoValor">0%</span>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Varia√ß√£o na Quantidade (¬±%)
                                </label>
                                <input type="range" min="-30" max="30" value="0" class="custom-slider" id="sensibilidadeQuantidade" oninput="atualizarSensibilidade()">
                                <div class="flex justify-between text-xs text-gray-500 mt-1">
                                    <span>-30%</span>
                                    <span>0%</span>
                                    <span>+30%</span>
                                </div>
                                <div class="mt-2 text-center">
                                    <span class="font-bold" id="sensibilidadeQuantidadeValor">0%</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 p-4 bg-white dark:bg-gray-800 rounded-xl">
                            <h4 class="font-bold text-gray-800 dark:text-white mb-3">Impacto no Lucro:</h4>
                            <div class="text-2xl font-bold text-center" id="impactoSensibilidadeLucro">R$ 0,00</div>
                            <div class="text-sm text-gray-600 dark:text-gray-400 text-center" id="impactoSensibilidadePercent">0% de varia√ß√£o</div>
                        </div>
                    </div>
                    
                    <!-- Navega√ß√£o -->
                    <div class="flex justify-between pt-6 mt-8 border-t border-gray-200 dark:border-gray-700">
                        <button onclick="openTab('mercado')" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover-lift">
                            <i class="fas fa-arrow-left mr-2"></i> Voltar para Mercado
                        </button>
                        
                        <div class="flex gap-3">
                            <button onclick="exportToExcel()" class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-medium hover-lift">
                                <i class="fas fa-file-excel mr-2"></i> Exportar Excel
                            </button>
                            <button onclick="openTab('graficos')" class="px-6 py-3 gradient-primary text-white rounded-xl font-medium hover-lift">
                                Ver Gr√°ficos Avan√ßados <i class="fas fa-arrow-right ml-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 6: Gr√°ficos Avan√ßados -->
            <div id="graficos" class="tab-content">
                <div class="glass-card p-6">
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">üìä Gr√°ficos Avan√ßados & Visualiza√ß√µes</h2>
                        <p class="text-gray-600 dark:text-gray-400">Visualize todos os dados do seu neg√≥cio de forma interativa</p>
                    </div>
                    
                    <!-- Controles dos Gr√°ficos -->
                    <div class="mb-8 p-6 bg-gradient-to-r from-gray-50 to-slate-50 dark:from-gray-800 dark:to-slate-800 rounded-xl">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">‚öôÔ∏è Controles dos Gr√°ficos</h3>
                        
                        <div class="grid md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Tipo de Visualiza√ß√£o
                                </label>
                                <select id="tipoVisualizacao" class="w-full px-4 py-2 border rounded-lg bg-white dark:bg-gray-800" onchange="atualizarGraficos()">
                                    <option value="padrao">Padr√£o</option>
                                    <option value="simples">Simplificado</option>
                                    <option value="detalhado">Detalhado</option>
                                    <option value="comparativo">Comparativo</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Mostrar Valores em
                                </label>
                                <div class="flex gap-4">
                                    <label class="flex items-center">
                                        <input type="radio" name="tipoValor" value="real" checked class="mr-2" onchange="atualizarGraficos()">
                                        <span class="text-sm">R$ (Reais)</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="radio" name="tipoValor" value="percentual" class="mr-2" onchange="atualizarGraficos()">
                                        <span class="text-sm">% (Porcentagem)</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    A√ß√µes
                                </label>
                                <div class="flex gap-2">
                                    <button onclick="atualizarGraficos()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
                                        <i class="fas fa-sync mr-2"></i> Atualizar
                                    </button>
                                    <button onclick="exportarGraficos()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg">
                                        <i class="fas fa-download mr-2"></i> Exportar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Grid de Gr√°ficos -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <!-- Gr√°fico 1: Composi√ß√£o do Pre√ßo -->
                        <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-gray-800 dark:text-white">üßÆ Composi√ß√£o do Pre√ßo de Venda</h3>
                                <button onclick="abrirModalGrafico('composicao')" class="text-blue-600 dark:text-blue-400 hover:text-blue-800">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                            <div class="chart-container-md">
                                <canvas id="graficoComposicaoDetalhada"></canvas>
                            </div>
                            <div class="mt-4 grid grid-cols-2 gap-2">
                                <div class="p-2 bg-blue-50 dark:bg-blue-900/30 rounded-lg">
                                    <div class="text-sm font-medium text-blue-700 dark:text-blue-300">Margem de Lucro</div>
                                    <div class="text-lg font-bold" id="legendaMargem">0%</div>
                                </div>
                                <div class="p-2 bg-red-50 dark:bg-red-900/30 rounded-lg">
                                    <div class="text-sm font-medium text-red-700 dark:text-red-300">Custos Totais</div>
                                    <div class="text-lg font-bold" id="legendaCustos">0%</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Gr√°fico 2: Distribui√ß√£o de Custos -->
                        <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-gray-800 dark:text-white">üí∞ Distribui√ß√£o de Custos Mensais</h3>
                                <button onclick="abrirModalGrafico('custos')" class="text-blue-600 dark:text-blue-400 hover:text-blue-800">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                            <div class="chart-container-md">
                                <canvas id="graficoDistribuicaoCustos"></canvas>
                            </div>
                            <div class="mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/30 rounded-lg">
                                <p class="text-sm text-yellow-800 dark:text-yellow-300">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>
                                    Maior custo: <span id="maiorCusto" class="font-bold">N/A</span>
                                </p>
                            </div>
                        </div>
                        
                        <!-- Gr√°fico 3: An√°lise de Rentabilidade -->
                        <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-gray-800 dark:text-white">üìà An√°lise de Rentabilidade</h3>
                                <button onclick="abrirModalGrafico('rentabilidade')" class="text-blue-600 dark:text-blue-400 hover:text-blue-800">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                            <div class="chart-container-md">
                                <canvas id="graficoRentabilidade"></canvas>
                            </div>
                            <div class="mt-4 grid grid-cols-3 gap-2 text-center">
                                <div>
                                    <div class="text-lg font-bold text-green-600" id="rentabilidadeReceita">R$0</div>
                                    <div class="text-xs text-gray-600">Receita</div>
                                </div>
                                <div>
                                    <div class="text-lg font-bold text-red-600" id="rentabilidadeCusto">R$0</div>
                                    <div class="text-xs text-gray-600">Custo</div>
                                </div>
                                <div>
                                    <div class="text-lg font-bold text-blue-600" id="rentabilidadeLucro">R$0</div>
                                    <div class="text-xs text-gray-600">Lucro</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Gr√°fico 4: Ponto de Equil√≠brio -->
                        <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-gray-800 dark:text-white">‚öñÔ∏è An√°lise de Ponto de Equil√≠brio</h3>
                                <button onclick="abrirModalGrafico('ponto-equilibrio')" class="text-blue-600 dark:text-blue-400 hover:text-blue-800">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                            <div class="chart-container-md">
                                <canvas id="graficoPontoEquilibrioDetalhado"></canvas>
                            </div>
                            <div class="mt-4 p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg">
                                <p class="text-sm text-blue-800 dark:text-blue-300">
                                    <i class="fas fa-bullseye mr-2"></i>
                                    Ponto de equil√≠brio: <span id="pontoEquilibrioInfo" class="font-bold">0 unidades</span>
                                </p>
                            </div>
                        </div>
                        
                        <!-- Gr√°fico 5: Comparativo com Concorr√™ncia -->
                        <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-gray-800 dark:text-white">üèÜ Comparativo com Concorr√™ncia</h3>
                                <button onclick="abrirModalGrafico('concorrencia')" class="text-blue-600 dark:text-blue-400 hover:text-blue-800">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                            <div class="chart-container-md">
                                <canvas id="graficoComparativoConcorrencia"></canvas>
                            </div>
                            <div class="mt-4 p-3 bg-green-50 dark:bg-green-900/30 rounded-lg">
                                <p class="text-sm text-green-800 dark:text-green-300">
                                    <i class="fas fa-trophy mr-2"></i>
                                    Sua posi√ß√£o: <span id="posicaoConcorrenciaInfo" class="font-bold">N/A</span>
                                </p>
                            </div>
                        </div>
                        
                        <!-- Gr√°fico 6: Evolu√ß√£o de Resultados -->
                        <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-gray-800 dark:text-white">üìÖ Evolu√ß√£o de Resultados</h3>
                                <button onclick="abrirModalGrafico('evolucao')" class="text-blue-600 dark:text-blue-400 hover:text-blue-800">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                            <div class="chart-container-md">
                                <canvas id="graficoEvolucaoResultados"></canvas>
                            </div>
                            <div class="mt-4 grid grid-cols-2 gap-2 text-center">
                                <div>
                                    <div class="text-sm font-medium text-gray-700">Crescimento Mensal</div>
                                    <div class="text-lg font-bold text-green-600" id="crescimentoMensal">0%</div>
                                </div>
                                <div>
                                    <div class="text-sm font-medium text-gray-700">Previs√£o 6 meses</div>
                                    <div class="text-lg font-bold text-blue-600" id="previsao6Meses">R$0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- An√°lise dos Gr√°ficos -->
                    <div class="p-6 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl">
                        <h3 class="text-lg font-bold text-purple-800 dark:text-purple-300 mb-4">üß† An√°lise dos Gr√°ficos</h3>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-medium mb-3">‚úÖ Pontos Fortes Identificados</h4>
                                <ul class="space-y-2">
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-check-circle text-green-500 mt-1"></i>
                                        <span class="text-sm text-gray-700 dark:text-gray-300" id="pontoForte1">Margem de lucro saud√°vel</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-check-circle text-green-500 mt-1"></i>
                                        <span class="text-sm text-gray-700 dark:text-gray-300" id="pontoForte2">Custos bem distribu√≠dos</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-check-circle text-green-500 mt-1"></i>
                                        <span class="text-sm text-gray-700 dark:text-gray-300" id="pontoForte3">Posicionamento competitivo</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-medium mb-3">‚ö†Ô∏è Oportunidades de Melhoria</h4>
                                <ul class="space-y-2">
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-exclamation-triangle text-yellow-500 mt-1"></i>
                                        <span class="text-sm text-gray-700 dark:text-gray-300" id="oportunidade1">Reduzir custos fixos</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-exclamation-triangle text-yellow-500 mt-1"></i>
                                        <span class="text-sm text-gray-700 dark:text-gray-300" id="oportunidade2">Aumentar margem</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-exclamation-triangle text-yellow-500 mt-1"></i>
                                        <span class="text-sm text-gray-700 dark:text-gray-300" id="oportunidade3">Melhorar efici√™ncia</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navega√ß√£o -->
                    <div class="flex justify-between pt-6 mt-8 border-t border-gray-200 dark:border-gray-700">
                        <button onclick="openTab('resultados')" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover-lift">
                            <i class="fas fa-arrow-left mr-2"></i> Voltar para Resultados
                        </button>
                        
                        <button onclick="openTab('projecoes')" class="px-6 py-3 gradient-primary text-white rounded-xl font-medium hover-lift">
                            Ver Proje√ß√µes Futuras <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab 7: Proje√ß√µes & Cen√°rios -->
            <div id="projecoes" class="tab-content">
                <div class="glass-card p-6">
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">üöÄ Proje√ß√µes Futuras & Cen√°rios</h2>
                        <p class="text-gray-600 dark:text-gray-400">Simule diferentes cen√°rios para planejar o crescimento do seu neg√≥cio</p>
                    </div>
                    
                    <!-- Controles de Proje√ß√£o -->
                    <div class="mb-8 p-6 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl">
                        <h3 class="text-lg font-bold text-blue-800 dark:text-blue-300 mb-4">‚öôÔ∏è Configura√ß√£o das Proje√ß√µes</h3>
                        
                        <div class="grid md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Horizonte de Proje√ß√£o
                                </label>
                                <select id="horizonteProjecao" class="w-full px-4 py-2 border rounded-lg bg-white dark:bg-gray-800" onchange="atualizarProjecoes()">
                                    <option value="6">6 meses</option>
                                    <option value="12" selected>12 meses</option>
                                    <option value="18">18 meses</option>
                                    <option value="24">24 meses</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Cen√°rio Base
                                </label>
                                <select id="cenarioBase" class="w-full px-4 py-2 border rounded-lg bg-white dark:bg-gray-800" onchange="atualizarProjecoes()">
                                    <option value="otimista">Otimista</option>
                                    <option value="realista" selected>Realista</option>
                                    <option value="pessimista">Pessimista</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    Taxa de Crescimento Mensal (%)
                                </label>
                                <input type="number" id="taxaCrescimentoProjecao" value="5" min="0" max="50" step="0.1" 
                                       class="w-full px-4 py-2 border rounded-lg bg-white dark:bg-gray-800" onchange="atualizarProjecoes()">
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                Fatores Adicionais
                            </label>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <label class="flex items-center">
                                    <input type="checkbox" id="fatorInvestimento" class="mr-2" onchange="atualizarProjecoes()">
                                    <span class="text-sm">Novos Investimentos</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="fatorContratacao" class="mr-2" onchange="atualizarProjecoes()">
                                    <span class="text-sm">Contrata√ß√µes</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="fatorExpansao" class="mr-2" onchange="atualizarProjecoes()">
                                    <span class="text-sm">Expans√£o</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="fatorCrises" class="mr-2" onchange="atualizarProjecoes()">
                                    <span class="text-sm">Cen√°rio de Crises</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Gr√°ficos de Proje√ß√£o -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <!-- Proje√ß√£o de Faturamento -->
                        <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-gray-800 dark:text-white">üìà Proje√ß√£o de Faturamento</h3>
                                <button onclick="abrirModalGrafico('projecao-faturamento')" class="text-blue-600 dark:text-blue-400 hover:text-blue-800">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                            <div class="chart-container-md">
                                <canvas id="graficoProjecaoFaturamento"></canvas>
                            </div>
                            <div class="mt-4 grid grid-cols-3 gap-2 text-center">
                                <div>
                                    <div class="text-lg font-bold" id="projecaoInicio">R$0</div>
                                    <div class="text-xs text-gray-600">M√™s 1</div>
                                </div>
                                <div>
                                    <div class="text-lg font-bold" id="projecaoMeio">R$0</div>
                                    <div class="text-xs text-gray-600">M√™s 6</div>
                                </div>
                                <div>
                                    <div class="text-lg font-bold" id="projecaoFim">R$0</div>
                                    <div class="text-xs text-gray-600">M√™s 12</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Proje√ß√£o de Lucro -->
                        <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-gray-800 dark:text-white">üí∞ Proje√ß√£o de Lucro</h3>
                                <button onclick="abrirModalGrafico('projecao-lucro')" class="text-blue-600 dark:text-blue-400 hover:text-blue-800">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                            <div class="chart-container-md">
                                <canvas id="graficoProjecaoLucro"></canvas>
                            </div>
                            <div class="mt-4 grid grid-cols-3 gap-2 text-center">
                                <div>
                                    <div class="text-lg font-bold" id="lucroProjecaoInicio">R$0</div>
                                    <div class="text-xs text-gray-600">M√™s 1</div>
                                </div>
                                <div>
                                    <div class="text-lg font-bold" id="lucroProjecaoMeio">R$0</div>
                                    <div class="text-xs text-gray-600">M√™s 6</div>
                                </div>
                                <div>
                                    <div class="text-lg font-bold" id="lucroProjecaoFim">R$0</div>
                                    <div class="text-xs text-gray-600">M√™s 12</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Comparativo de Cen√°rios -->
                        <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm lg:col-span-2">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="font-bold text-gray-800 dark:text-white">üìä Comparativo de Cen√°rios</h3>
                                <button onclick="abrirModalGrafico('comparativo-cenarios')" class="text-blue-600 dark:text-blue-400 hover:text-blue-800">
                                    <i class="fas fa-expand"></i>
                                </button>
                            </div>
                            <div class="chart-container-md">
                                <canvas id="graficoComparativoCenarios"></canvas>
                            </div>
                            <div class="mt-4 grid grid-cols-3 gap-4">
                                <div class="p-3 bg-red-50 dark:bg-red-900/30 rounded-lg">
                                    <div class="font-bold text-red-700 dark:text-red-300">Cen√°rio Pessimista</div>
                                    <div class="text-lg font-bold" id="cenarioPessimistaValor">R$0</div>
                                    <div class="text-xs text-gray-600">Faturamento no final</div>
                                </div>
                                <div class="p-3 bg-blue-50 dark:bg-blue-900/30 rounded-lg">
                                    <div class="font-bold text-blue-700 dark:text-blue-300">Cen√°rio Realista</div>
                                    <div class="text-lg font-bold" id="cenarioRealistaValor">R$0</div>
                                    <div class="text-xs text-gray-600">Faturamento no final</div>
                                </div>
                                <div class="p-3 bg-green-50 dark:bg-green-900/30 rounded-lg">
                                    <div class="font-bold text-green-700 dark:text-green-300">Cen√°rio Otimista</div>
                                    <div class="text-lg font-bold" id="cenarioOtimistaValor">R$0</div>
                                    <div class="text-xs text-gray-600">Faturamento no final</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- An√°lise de Viabilidade -->
                    <div class="mb-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl">
                        <h3 class="text-lg font-bold text-green-800 dark:text-green-300 mb-4">‚úÖ An√°lise de Viabilidade do Neg√≥cio</h3>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-medium mb-3">üìã Indicadores de Viabilidade</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-700 dark:text-gray-300">ROI (Retorno sobre Investimento):</span>
                                        <span id="viabilidadeROI" class="font-bold text-green-600 dark:text-green-400">0%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-700 dark:text-gray-300">Payback (Retorno do Investimento):</span>
                                        <span id="viabilidadePayback" class="font-bold">0 meses</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-700 dark:text-gray-300">VPL (Valor Presente L√≠quido):</span>
                                        <span id="viabilidadeVPL" class="font-bold text-green-600 dark:text-green-400">R$ 0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-700 dark:text-gray-300">TIR (Taxa Interna de Retorno):</span>
                                        <span id="viabilidadeTIR" class="font-bold text-blue-600 dark:text-blue-400">0%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-medium mb-3">üéØ Classifica√ß√£o do Neg√≥cio</h4>
                                <div class="flex items-center justify-center mb-4">
                                    <div class="relative w-48 h-48">
                                        <svg class="progress-ring" width="192" height="192">
                                            <circle class="progress-ring__circle" stroke="#10b981" stroke-width="12" fill="transparent" r="90" cx="96" cy="96"/>
                                        </svg>
                                        <div class="absolute inset-0 flex items-center justify-center">
                                            <div class="text-center">
                                                <div id="pontuacaoViabilidade" class="text-4xl font-bold text-green-600 dark:text-green-400">0</div>
                                                <div class="text-sm text-gray-600 dark:text-gray-400">/10 pontos</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <div class="text-lg font-bold text-green-700 dark:text-green-300" id="classificacaoViabilidade">Baixa Viabilidade</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400" id="detalheViabilidade">Recomenda-se revisar o modelo</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Plano de Crescimento -->
                    <div class="mb-8 p-6 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl">
                        <h3 class="text-lg font-bold text-blue-800 dark:text-blue-300 mb-4">üìÖ Plano de Crescimento em Etapas</h3>
                        
                        <div class="space-y-6">
                            <!-- Etapa 1 -->
                            <div class="flex gap-4 p-4 bg-white dark:bg-gray-800 rounded-xl">
                                <div class="bg-blue-100 dark:bg-blue-900 p-3 rounded-lg">
                                    <span class="font-bold text-blue-600 dark:text-blue-400">1-3</span>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-800 dark:text-white mb-2">Primeiro Trimestre: Estabiliza√ß√£o</h4>
                                    <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                        <li>‚Ä¢ Alcan√ßar ponto de equil√≠brio consistentemente</li>
                                        <li>‚Ä¢ Otimizar processos e fornecedores</li>
                                        <li>‚Ä¢ Construir base de clientes fi√©is</li>
                                    </ul>
                                    <div class="mt-2 text-sm text-blue-600 dark:text-blue-400">
                                        <strong>Meta:</strong> Faturamento de <span id="metaTrimestre1" class="font-bold">R$ 0/m√™s</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Etapa 2 -->
                            <div class="flex gap-4 p-4 bg-white dark:bg-gray-800 rounded-xl">
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-lg">
                                    <span class="font-bold text-green-600 dark:text-green-400">4-6</span>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-800 dark:text-white mb-2">Segundo Trimestre: Crescimento</h4>
                                    <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                        <li>‚Ä¢ Investir em marketing digital eficiente</li>
                                        <li>‚Ä¢ Expandir para novos canais de venda</li>
                                        <li>‚Ä¢ Testar aumento de pre√ßo gradual</li>
                                    </ul>
                                    <div class="mt-2 text-sm text-green-600 dark:text-green-400">
                                        <strong>Meta:</strong> Faturamento de <span id="metaTrimestre2" class="font-bold">R$ 0/m√™s</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Etapa 3 -->
                            <div class="flex gap-4 p-4 bg-white dark:bg-gray-800 rounded-xl">
                                <div class="bg-purple-100 dark:bg-purple-900 p-3 rounded-lg">
                                    <span class="font-bold text-purple-600 dark:text-purple-400">7-9</span>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-800 dark:text-white mb-2">Terceiro Trimestre: Consolida√ß√£o</h4>
                                    <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                        <li>‚Ä¢ Diversificar produtos/servi√ßos</li>
                                        <li>‚Ä¢ Automatizar processos manuais</li>
                                        <li>‚Ä¢ Negociar melhores condi√ß√µes</li>
                                    </ul>
                                    <div class="mt-2 text-sm text-purple-600 dark:text-purple-400">
                                        <strong>Meta:</strong> Faturamento de <span id="metaTrimestre3" class="font-bold">R$ 0/m√™s</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Etapa 4 -->
                            <div class="flex gap-4 p-4 bg-white dark:bg-gray-800 rounded-xl">
                                <div class="bg-orange-100 dark:bg-orange-900 p-3 rounded-lg">
                                    <span class="font-bold text-orange-600 dark:text-orange-400">10-12</span>
                                </div>
                                <div>
                                    <h4 class="font-bold text-gray-800 dark:text-white mb-2">Quarto Trimestre: Expans√£o</h4>
                                    <ul class="text-sm text-gray-600 dark:text-gray-400 space-y-1">
                                        <li>‚Ä¢ Avaliar contrata√ß√£o de primeiro funcion√°rio</li>
                                        <li>‚Ä¢ Explorar novos mercados/segmentos</li>
                                        <li>‚Ä¢ Considerar formaliza√ß√£o como ME</li>
                                    </ul>
                                    <div class="mt-2 text-sm text-orange-600 dark:text-orange-400">
                                        <strong>Meta:</strong> Faturamento de <span id="metaTrimestre4" class="font-bold">R$ 0/m√™s</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Navega√ß√£o -->
                    <div class="flex justify-between pt-6 mt-8 border-t border-gray-200 dark:border-gray-700">
                        <button onclick="openTab('graficos')" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-xl font-medium hover-lift">
                            <i class="fas fa-arrow-left mr-2"></i> Voltar para Gr√°ficos
                        </button>
                        
                        <button onclick="openTab('recomendacoes')" class="px-6 py-3 gradient-primary text-white rounded-xl font-medium hover-lift">
                            Ver Plano de A√ß√£o <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab 8: Plano de A√ß√£o -->
            <div id="recomendacoes" class="tab-content">
                <div class="glass-card p-6">
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">üéØ Plano de A√ß√£o Personalizado</h2>
                        <p class="text-gray-600 dark:text-gray-400">Recomenda√ß√µes espec√≠ficas baseadas na an√°lise do seu neg√≥cio</p>
                    </div>
                    
                    <!-- Resumo Executivo -->
                    <div class="mb-8 p-6 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl">
                        <h3 class="text-lg font-bold text-blue-800 dark:text-blue-300 mb-4">üìã Resumo Executivo</h3>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <div class="mb-4">
                                    <div class="flex justify-between mb-2">
                                        <span class="text-gray-700 dark:text-gray-300">Classifica√ß√£o do Neg√≥cio:</span>
                                        <span id="classificacaoNegocio" class="font-bold text-green-600 dark:text-green-400">Em Crescimento</span>
                                    </div>
                                    <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                                        <div class="h-full bg-gradient-to-r from-red-500 via-yellow-500 to-green-500" style="width: 100%"></div>
                                        <div class="h-4 w-1 bg-blue-600 relative -top-1" style="left: 75%"></div>
                                    </div>
                                    <div class="flex justify-between text-xs mt-1">
                                        <span>Iniciante</span>
                                        <span>Est√°vel</span>
                                        <span>Consolidado</span>
                                    </div>
                                </div>
                                
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Potencial de Crescimento:</span>
                                        <span id="potencialCrescimento" class="font-bold text-green-600 dark:text-green-400">Alto</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Risco do Neg√≥cio:</span>
                                        <span id="riscoNegocio" class="font-bold text-yellow-600 dark:text-yellow-400">M√©dio</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600 dark:text-gray-400">Investimento Necess√°rio:</span>
                                        <span id="investimentoNecessario" class="font-bold">R$ 0</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="p-4 bg-white dark:bg-gray-800 rounded-xl">
                                    <h4 class="font-bold text-gray-800 dark:text-white mb-3">üìä Pontua√ß√£o Geral</h4>
                                    
                                    <div class="flex items-center justify-center mb-4">
                                        <div class="relative w-40 h-40">
                                            <svg class="progress-ring" width="160" height="160">
                                                <circle class="progress-ring__circle" stroke="#3b82f6" stroke-width="10" fill="transparent" r="75" cx="80" cy="80"/>
                                            </svg>
                                            <div class="absolute inset-0 flex items-center justify-center">
                                                <div class="text-center">
                                                    <div id="pontuacaoGeral" class="text-4xl font-bold text-blue-600 dark:text-blue-400">0</div>
                                                    <div class="text-sm text-gray-600 dark:text-gray-400">/100 pontos</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="text-center">
                                        <div class="text-lg font-bold text-blue-700 dark:text-blue-300" id="statusNegocio">An√°lise Inicial</div>
                                        <div class="text-sm text-gray-600 dark:text-gray-400">Baseado em todos os dados fornecidos</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recomenda√ß√µes Priorit√°rias -->
                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">üö® A√ß√µes Priorit√°rias (Pr√≥ximos 30 Dias)</h3>
                        
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="p-4 bg-gradient-to-br from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 rounded-xl border-2 border-red-200 dark:border-red-800">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="bg-red-100 dark:bg-red-900 p-2 rounded-lg">
                                        <i class="fas fa-exclamation-triangle text-red-600 dark:text-red-400"></i>
                                    </div>
                                    <h4 class="font-bold text-red-800 dark:text-red-300">Urgente</h4>
                                </div>
                                <ul class="text-sm text-gray-700 dark:text-gray-300 space-y-2">
                                    <li id="acaoUrgente1">‚Ä¢ Definir pre√ßo de venda final</li>
                                    <li id="acaoUrgente2">‚Ä¢ Calcular ponto de equil√≠brio exato</li>
                                    <li id="acaoUrgente3">‚Ä¢ Revisar maiores custos</li>
                                </ul>
                            </div>
                            
                            <div class="p-4 bg-gradient-to-br from-yellow-50 to-amber-50 dark:from-yellow-900/20 dark:to-amber-900/20 rounded-xl border-2 border-yellow-200 dark:border-yellow-800">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="bg-yellow-100 dark:bg-yellow-900 p-2 rounded-lg">
                                        <i class="fas fa-clock text-yellow-600 dark:text-yellow-400"></i>
                                    </div>
                                    <h4 class="font-bold text-yellow-800 dark:text-yellow-300">Importante</h4>
                                </div>
                                <ul class="text-sm text-gray-700 dark:text-gray-300 space-y-2">
                                    <li id="acaoImportante1">‚Ä¢ Analisar concorr√™ncia detalhadamente</li>
                                    <li id="acaoImportante2">‚Ä¢ Diversificar canais de venda</li>
                                    <li id="acaoImportante3">‚Ä¢ Criar plano de marketing</li>
                                </ul>
                            </div>
                            
                            <div class="p-4 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl border-2 border-green-200 dark:border-green-800">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="bg-green-100 dark:bg-green-900 p-2 rounded-lg">
                                        <i class="fas fa-calendar-alt text-green-600 dark:text-green-400"></i>
                                    </div>
                                    <h4 class="font-bold text-green-800 dark:text-green-300">Planejamento</h4>
                                </div>
                                <ul class="text-sm text-gray-700 dark:text-gray-300 space-y-2">
                                    <li id="acaoPlanejamento1">‚Ä¢ Definir metas trimestrais</li>
                                    <li id="acaoPlanejamento2">‚Ä¢ Estruturar fluxo de caixa</li>
                                    <li id="acaoPlanejamento3">‚Ä¢ Planejar investimentos futuros</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Check-list de Implementa√ß√£o -->
                    <div class="mb-8 p-6 bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 rounded-xl">
                        <h3 class="text-lg font-bold text-purple-800 dark:text-purple-300 mb-4">‚úÖ Check-list de Implementa√ß√£o</h3>
                        
                        <div class="space-y-3">
                            <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-xl">
                                <input type="checkbox" id="check1" class="h-5 w-5 text-purple-600 rounded">
                                <div class="flex-1">
                                    <label for="check1" class="font-medium text-gray-800 dark:text-white">Definir pre√ßo final baseado na an√°lise</label>
                                    <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Meta: R$ <span id="checkPrecoFinal">0,00</span> por unidade</div>
                                </div>
                            </div>
                            
                            <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-xl">
                                <input type="checkbox" id="check2" class="h-5 w-5 text-purple-600 rounded">
                                <div class="flex-1">
                                    <label for="check2" class="font-medium text-gray-800 dark:text-white">Negociar com 3 fornecedores principais</label>
                                    <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Meta: Reduzir custos em <span id="checkReducaoCustos">0%</span></div>
                                </div>
                            </div>
                            
                            <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-xl">
                                <input type="checkbox" id="check3" class="h-5 w-5 text-purple-600 rounded">
                                <div class="flex-1">
                                    <label for="check3" class="font-medium text-gray-800 dark:text-white">Implementar sistema de controle financeiro</label>
                                    <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Sugest√£o: Planilha ou aplicativo gratuito</div>
                                </div>
                            </div>
                            
                            <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-xl">
                                <input type="checkbox" id="check4" class="h-5 w-5 text-purple-600 rounded">
                                <div class="flex-1">
                                    <label for="check4" class="font-medium text-gray-800 dark:text-white">Criar conte√∫do sobre diferenciais do produto</label>
                                    <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Para aumentar valor percebido</div>
                                </div>
                            </div>
                            
                            <div class="flex items-center gap-3 p-3 bg-white dark:bg-gray-800 rounded-xl">
                                <input type="checkbox" id="check5" class="h-5 w-5 text-purple-600 rounded">
                                <div class="flex-1">
                                    <label for="check5" class="font-medium text-gray-800 dark:text-white">Agendar revis√£o mensal dos resultados</label>
                                    <div class="text-xs text-gray-600 dark:text-gray-400 mt-1">Reutilizar esta calculadora todo m√™s</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 flex justify-between items-center">
                            <div class="text-sm text-gray-600 dark:text-gray-400">
                                Progresso: <span id="progressoChecklist">0</span>/5 tarefas
                            </div>
                            <button onclick="marcarTodosCheckboxes()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg text-sm">
                                <i class="fas fa-check-double mr-2"></i> Marcar Todas
                            </button>
                        </div>
                    </div>
                    
                    <!-- Metas SMART -->
                    <div class="mb-8 p-6 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl">
                        <h3 class="text-lg font-bold text-green-800 dark:text-green-300 mb-4">üéØ Metas SMART para os Pr√≥ximos 90 Dias</h3>
                        
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <div class="p-4 bg-white dark:bg-gray-800 rounded-xl mb-4">
                                    <h4 class="font-bold text-gray-800 dark:text-white mb-2">üìà Meta de Faturamento</h4>
                                    <div class="text-2xl font-bold text-green-600 dark:text-green-400" id="metaSmartFaturamento">R$ 0/m√™s</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Aumento de <span id="metaSmartFaturamentoPercent">0%</span> em 3 meses</div>
                                </div>
                                
                                <div class="p-4 bg-white dark:bg-gray-800 rounded-xl">
                                    <h4 class="font-bold text-gray-800 dark:text-white mb-2">üí∞ Meta de Margem</h4>
                                    <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" id="metaSmartMargem">0%</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Aumentar em <span id="metaSmartMargemPontos">0</span> pontos percentuais</div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="p-4 bg-white dark:bg-gray-800 rounded-xl mb-4">
                                    <h4 class="font-bold text-gray-800 dark:text-white mb-2">üìä Meta de Clientes</h4>
                                    <div class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="metaSmartClientes">0</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Novos clientes por m√™s</div>
                                </div>
                                
                                <div class="p-4 bg-white dark:bg-gray-800 rounded-xl">
                                    <h4 class="font-bold text-gray-800 dark:text-white mb-2">‚ö° Meta de Efici√™ncia</h4>
                                    <div class="text-2xl font-bold text-orange-600 dark:text-orange-400" id="metaSmartEficiencia">0%</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Redu√ß√£o de tempo/custos operacionais</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 p-3 bg-green-100 dark:bg-green-900/30 rounded-lg">
                            <p class="text-sm text-green-800 dark:text-green-300">
                                <i class="fas fa-lightbulb mr-2"></i>
                                <strong>Lembrete:</strong> Metas SMART s√£o Espec√≠ficas, Mensur√°veis, Ating√≠veis, Relevantes e Temporais.
                                Revise-as mensalmente e ajuste conforme necess√°rio.
                            </p>
                        </div>
                    </div>
                    
                    <!-- Recursos e Pr√≥ximos Passos -->
                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-white mb-4">üìö Recursos e Pr√≥ximos Passos</h3>
                        
                        <div class="grid md:grid-cols-3 gap-4">
                            <a href="#" onclick="generatePDF()" class="p-4 bg-gradient-to-br from-red-50 to-pink-50 dark:from-red-900/20 dark:to-pink-900/20 rounded-xl text-center hover-lift">
                                <div class="text-2xl mb-2">
                                    <i class="fas fa-file-pdf text-red-600 dark:text-red-400"></i>
                                </div>
                                <div class="font-bold text-red-800 dark:text-red-300">Exportar Relat√≥rio PDF</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Salve este relat√≥rio completo</div>
                            </a>
                            
                            <a href="#" onclick="exportToExcel()" class="p-4 bg-gradient-to-br from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-xl text-center hover-lift">
                                <div class="text-2xl mb-2">
                                    <i class="fas fa-file-excel text-green-600 dark:text-green-400"></i>
                                </div>
                                <div class="font-bold text-green-800 dark:text-green-300">Exportar Dados Excel</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Para an√°lise adicional</div>
                            </a>
                            
                            <a href="#" onclick="reiniciarCalculadora()" class="p-4 bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl text-center hover-lift">
                                <div class="text-2xl mb-2">
                                    <i class="fas fa-redo text-blue-600 dark:text-blue-400"></i>
                                </div>
                                <div class="font-bold text-blue-800 dark:text-blue-300">Nova An√°lise</div>
                                <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">Come√ßar do zero</div>
                            </a>
                        </div>
                    </div>
                    
                    <!-- Agendamento de Revis√£o -->
                    <div class="p-6 bg-gradient-to-r from-blue-50 to-cyan-50 dark:from-blue-900/20 dark:to-cyan-900/20 rounded-xl">
                        <h3 class="text-lg font-bold text-blue-800 dark:text-blue-300 mb-4">üìÖ Agende sua Pr√≥xima Revis√£o</h3>
                        
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-700 dark:text-gray-300">
                                    Recomendamos revisar esta an√°lise em <span class="font-bold">30 dias</span> para comparar resultados
                                    e ajustar estrat√©gias conforme necess√°rio.
                                </p>
                                <div class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                                    Data sugerida: <span id="dataProximaRevisao" class="font-bold">DD/MM/AAAA</span>
                                </div>
                            </div>
                            
                            <button onclick="agendarRevisao()" class="px-6 py-3 gradient-primary text-white rounded-xl font-medium hover-lift">
                                <i class="fas fa-calendar-plus mr-2"></i> Agendar
                            </button>
                        </div>
                    </div>
                    
                    <!-- Navega√ß√£o Final -->
                    <div class="flex justify-center pt-6 mt-8 border-t border-gray-200 dark:border-gray-700">
                        <button onclick="openTab('dashboard')" class="px-8 py-3 gradient-primary text-white rounded-xl font-medium hover-lift">
                            <i class="fas fa-home mr-2"></i> Voltar ao Dashboard
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Gr√°ficos -->
    <div id="modalGrafico" class="modal-overlay">
        <div class="modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 id="modalGraficoTitulo" class="text-xl font-bold text-gray-800 dark:text-white">Gr√°fico Detalhado</h3>
                    <button onclick="fecharModalGrafico()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <div class="chart-container-lg mb-6">
                    <canvas id="modalGraficoCanvas"></canvas>
                </div>
                
                <div class="flex justify-end">
                    <button onclick="fecharModalGrafico()" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Rodap√© -->
    <footer class="mt-8 py-6 border-t border-gray-200 dark:border-gray-800">
        <div class="max-w-7xl mx-auto px-6">
            <div class="grid md:grid-cols-3 gap-8">
                <div>
                    <h4 class="font-bold text-gray-800 dark:text-white mb-4">Calculadora MEI Premium</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                        Ferramenta completa para an√°lise financeira, precifica√ß√£o e proje√ß√µes para microempreendedores individuais.
                    </p>
                </div>
                
                <div>
                    <h4 class="font-bold text-gray-800 dark:text-white mb-4">Recursos √öteis</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" onclick="abrirModalAjuda()" class="text-blue-600 dark:text-blue-400 hover:underline">Central de Ajuda</a></li>
                        <li><a href="#" onclick="abrirModalSobre()" class="text-blue-600 dark:text-blue-400 hover:underline">Sobre a Ferramenta</a></li>
                        <li><a href="#" onclick="abrirModalDicas()" class="text-blue-600 dark:text-blue-400 hover:underline">Dicas para MEI</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-bold text-gray-800 dark:text-white mb-4">Aviso Legal</h4>
                    <p class="text-xs text-gray-600 dark:text-gray-400">
                        Esta ferramenta tem fins educacionais e informativos. Para decis√µes financeiras importantes, consulte um contador profissional.
                        Vers√£o 3.0 ‚Ä¢ √öltima atualiza√ß√£o: <span id="dataAtualizacao">DD/MM/AAAA</span>
                    </p>
                </div>
            </div>
            
            <div class="mt-8 pt-6 border-t border-gray-200 dark:border-gray-800 text-center text-sm text-gray-600 dark:text-gray-400">
                <p>¬© 2024 Calculadora MEI Premium. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>
    
    <!-- Modais adicionais -->
    <div id="modalAjuda" class="modal-overlay">
        <div class="modal-content max-w-3xl">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-gray-800 dark:text-white">üìö Central de Ajuda</h3>
                    <button onclick="fecharModal('modalAjuda')" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <!-- Conte√∫do do modal de ajuda -->
                <div class="space-y-6">
                    <!-- Se√ß√£o 1 -->
                    <div>
                        <h4 class="font-bold text-lg mb-3 text-blue-600 dark:text-blue-400">Como usar esta calculadora?</h4>
                        <p class="text-gray-700 dark:text-gray-300 mb-3">
                            Siga estas etapas para obter o m√°ximo da ferramenta:
                        </p>
                        <ol class="space-y-2 text-gray-700 dark:text-gray-300">
                            <li class="flex items-start gap-2">
                                <span class="font-bold">1.</span>
                                <span><strong>Preencha os Dados B√°sicos:</strong> Comece pela aba "Dados B√°sicos" e informe todos os detalhes do seu neg√≥cio.</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="font-bold">2.</span>
                                <span><strong>Analise seus Custos:</strong> Na aba "An√°lise de Custos", mapeie todos os gastos fixos e vari√°veis.</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="font-bold">3.</span>
                                <span><strong>Defina sua Estrat√©gia de Pre√ßo:</strong> Use a aba "Estrat√©gias de Precifica√ß√£o" para escolher o melhor m√©todo.</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="font-bold">4.</span>
                                <span><strong>Analise o Mercado:</strong> Compare seu pre√ßo com a concorr√™ncia e entenda seu posicionamento.</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="font-bold">5.</span>
                                <span><strong>Revise os Resultados:</strong> Veja os resultados financeiros e proje√ß√µes futuras.</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span class="font-bold">6.</span>
                                <span><strong>Siga o Plano de A√ß√£o:</strong> Implemente as recomenda√ß√µes personalizadas da √∫ltima aba.</span>
                            </li>
                        </ol>
                    </div>
                    
                    <!-- Se√ß√£o 2 -->
                    <div>
                        <h4 class="font-bold text-lg mb-3 text-green-600 dark:text-green-400">O que √© ponto de equil√≠brio?</h4>
                        <p class="text-gray-700 dark:text-gray-300">
                            O <strong>ponto de equil√≠brio</strong> √© a quantidade de unidades que voc√™ precisa vender para cobrir todos os custos (fixos e vari√°veis). Abaixo desse ponto, voc√™ tem preju√≠zo. Acima, come√ßa a ter lucro.
                        </p>
                        <p class="text-gray-700 dark:text-gray-300 mt-2">
                            <strong>F√≥rmula:</strong> Ponto de Equil√≠brio = Custos Fixos √∑ (Pre√ßo de Venda - Custo Vari√°vel Unit√°rio)
                        </p>
                    </div>
                    
                    <!-- Se√ß√£o 3 -->
                    <div>
                        <h4 class="font-bold text-lg mb-3 text-purple-600 dark:text-purple-400">Quais os m√©todos de precifica√ß√£o?</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                                <strong class="text-purple-600 dark:text-purple-400">Markup</strong>
                                <p class="text-sm mt-1">Adiciona uma porcentagem fixa sobre o custo total.</p>
                            </div>
                            <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                                <strong class="text-purple-600 dark:text-purple-400">Margem de Lucro</strong>
                                <p class="text-sm mt-1">Define o lucro como porcentagem do pre√ßo de venda.</p>
                            </div>
                            <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                                <strong class="text-purple-600 dark:text-purple-400">Pre√ßo de Mercado</strong>
                                <p class="text-sm mt-1">Baseado nos pre√ßos praticados pela concorr√™ncia.</p>
                            </div>
                            <div class="p-3 bg-gray-50 dark:bg-gray-800 rounded-lg">
                                <strong class="text-purple-600 dark:text-purple-400">Valor Percebido</strong>
                                <p class="text-sm mt-1">Baseado no valor que o cliente percebe do produto.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Se√ß√£o 4 -->
                    <div>
                        <h4 class="font-bold text-lg mb-3 text-red-600 dark:text-red-400">D√∫vidas Frequentes</h4>
                        <div class="space-y-3">
                            <div>
                                <p class="font-medium text-gray-800 dark:text-white">Posso salvar meus dados?</p>
                                <p class="text-sm text-gray-700 dark:text-gray-300">Sim! Use o bot√£o "Salvar" no cabe√ßalho ou exporte para PDF/Excel na √∫ltima aba.</p>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800 dark:text-white">Meus dados s√£o seguros?</p>
                                <p class="text-sm text-gray-700 dark:text-gray-300">Todos os c√°lculos s√£o feitos localmente no seu navegador. Nenhum dado √© enviado para servidores externos.</p>
                            </div>
                            <div>
                                <p class="font-medium text-gray-800 dark:text-white">Posso usar no celular?</p>
                                <p class="text-sm text-gray-700 dark:text-gray-300">Sim, a ferramenta √© totalmente responsiva e funciona em smartphones e tablets.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-8 flex justify-end">
                    <button onclick="fecharModal('modalAjuda')" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Sistema de State Management
        const appState = {
            currentTab: 'dashboard',
            currentPassoDados: 1,
            metodoPrecificacao: 'markup',
            dados: {
                empresa: {},
                produto: {},
                custos: {},
                precificacao: {},
                mercado: {},
                resultados: {}
            },
            progresso: 0
        };
        
        // Inicializa√ß√£o da aplica√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar data atual
            const dataAtual = new Date();
            document.getElementById('dataAtualizacao').textContent = formatarData(dataAtual);
            document.getElementById('dataProximaRevisao').textContent = formatarData(
                new Date(dataAtual.setMonth(dataAtual.getMonth() + 1))
            );
            
            // Inicializar tooltips
            inicializarTooltips();
            
            // Configurar event listeners
            configurarEventListeners();
            
            // Carregar dados salvos (se existirem)
            carregarDadosSalvos();
            
            // Calcular valores iniciais
            setTimeout(() => {
                calcularCustos();
                atualizarProgresso();
                atualizarGraficos();
            }, 500);
        });
        
        // Inicializar tooltips
        function inicializarTooltips() {
            const tooltips = document.querySelectorAll('.info-bubble');
            tooltips.forEach(tooltip => {
                tooltip.addEventListener('mouseenter', function(e) {
                    const tooltipText = this.getAttribute('data-tooltip');
                    const tooltipEl = document.createElement('div');
                    tooltipEl.className = 'tooltip-content';
                    tooltipEl.textContent = tooltipText;
                    tooltipEl.style.left = e.pageX + 'px';
                    tooltipEl.style.top = e.pageY + 'px';
                    document.body.appendChild(tooltipEl);
                    
                    this.tooltipElement = tooltipEl;
                });
                
                tooltip.addEventListener('mouseleave', function() {
                    if (this.tooltipElement) {
                        this.tooltipElement.remove();
                    }
                });
            });
        }
        
        // Configurar event listeners
        function configurarEventListeners() {
            // Inputs de custos
            const custosInputs = [
                'materiaPrima', 'embalagem', 'frete', 'comissoesPercent',
                'impostosVenda', 'taxasPlataforma', 'aluguel', 'salarios',
                'contas', 'marketing', 'das', 'manutencao', 'outrosFixos',
                'softwareGestao', 'softwareDesign', 'softwareMarketing', 'softwareOutros'
            ];
            
            custosInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', calcularCustos);
                }
            });
            
            // Inputs de precifica√ß√£o
            const precificacaoInputs = [
                'markupInput', 'markupSlider', 'precoVendaFinal',
                'descontoPromocional'
            ];
            
            precificacaoInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', atualizarPrecificacao);
                }
            });
            
            // Inputs de mercado
            const mercadoInputs = [
                'precoMinConcorrencia', 'precoMedioConcorrencia',
                'precoMaxConcorrencia', 'valorQualidade', 'valorAtendimento',
                'valorMarca', 'taxaDiretas', 'taxaMarketplaces', 'taxaRedesSociais'
            ];
            
            mercadoInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', atualizarAnaliseMercado);
                }
            });
            
            // Inputs de sensibilidade
            const sensibilidadeInputs = [
                'sensibilidadePreco', 'sensibilidadeCusto', 'sensibilidadeQuantidade'
            ];
            
            sensibilidadeInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', atualizarSensibilidade);
                }
            });
        }
        
        // Navega√ß√£o por tabs
        function openTab(tabName) {
            appState.currentTab = tabName;
            
            // Esconder todas as tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remover estilo ativo de todos os bot√µes
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('gradient-primary', 'text-white');
                btn.classList.add('bg-gray-100', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300');
            });
            
            // Mostrar a tab selecionada
            document.getElementById(tabName).classList.add('active');
            
            // Estilizar o bot√£o ativo
            const tabBtn = document.getElementById(`tab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
            if (tabBtn) {
                tabBtn.classList.add('gradient-primary', 'text-white');
                tabBtn.classList.remove('bg-gray-100', 'text-gray-700', 'dark:bg-gray-700', 'dark:text-gray-300');
            }
            
            // Atualizar progresso na barra superior
            atualizarProgressoBar();
            
            // Atualizar gr√°ficos se necess√°rio
            if (['graficos', 'projecoes', 'resultados'].includes(tabName)) {
                setTimeout(() => {
                    if (tabName === 'graficos') atualizarGraficos();
                    if (tabName === 'projecoes') atualizarProjecoes();
                    if (tabName === 'resultados') calcularResultados();
                }, 100);
            }
            
            // Rolar para o topo suavemente
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
        
        // Toggle dark mode
        function toggleDarkMode() {
            const isDark = document.body.classList.toggle('dark-mode');
            const icon = document.getElementById('darkModeIcon');
            
            if (isDark) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
            
            // Atualizar gr√°ficos para o novo tema
            setTimeout(() => {
                if (appState.currentTab === 'graficos') atualizarGraficos();
                if (appState.currentTab === 'projecoes') atualizarProjecoes();
            }, 100);
        }
        
        // Sistema de navega√ß√£o por passos (Dados B√°sicos)
        function mostrarPassoDados(passo) {
            appState.currentPassoDados = passo;
            
            // Atualizar bot√µes
            for (let i = 1; i <= 4; i++) {
                const btn = document.getElementById(`passoDados${i}`);
                const conteudo = document.getElementById(`conteudoPassoDados${i}`);
                
                if (i === passo) {
                    btn.classList.add('bg-blue-100', 'dark:bg-blue-900', 'text-blue-700', 'dark:text-blue-300');
                    btn.classList.remove('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    conteudo.classList.remove('hidden');
                } else {
                    btn.classList.remove('bg-blue-100', 'dark:bg-blue-900', 'text-blue-700', 'dark:text-blue-300');
                    btn.classList.add('bg-gray-100', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300');
                    conteudo.classList.add('hidden');
                }
            }
            
            // Atualizar bot√£o de avan√ßar
            const btnAvancar = document.getElementById('btnAvancarDados');
            if (passo === 4) {
                btnAvancar.innerHTML = 'Finalizar <i class="fas fa-check ml-2"></i>';
            } else {
                btnAvancar.innerHTML = 'Continuar <i class="fas fa-arrow-right ml-2"></i>';
            }
        }
        
        function avancarPassoDados() {
            if (appState.currentPassoDados < 4) {
                mostrarPassoDados(appState.currentPassoDados + 1);
            } else {
                // Validar dados obrigat√≥rios
                const camposObrigatorios = [
                    { id: 'empresaNome', nome: 'Nome da Empresa' },
                    { id: 'setorEmpresa', nome: 'Setor de Atua√ß√£o' },
                    { id: 'nomeProduto', nome: 'Nome do Produto/Servi√ßo' },
                    { id: 'publicoAlvo', nome: 'P√∫blico-Alvo' },
                    { id: 'qtdVendaMensal', nome: 'Quantidade Mensal' }
                ];
                
                const camposFaltando = [];
                camposObrigatorios.forEach(campo => {
                    const valor = document.getElementById(campo.id).value;
                    if (!valor || valor.trim() === '') {
                        camposFaltando.push(campo.nome);
                    }
                });
                
                if (camposFaltando.length > 0) {
                    alert(`Por favor, preencha os seguintes campos obrigat√≥rios:\n\n${camposFaltando.join('\n')}`);
                    return;
                }
                
                // Ir para a pr√≥xima tab
                openTab('custos');
            }
        }
        
        function voltarPassoDados() {
            if (appState.currentPassoDados > 1) {
                mostrarPassoDados(appState.currentPassoDados - 1);
            } else {
                openTab('dashboard');
            }
        }
        
        // Atualizar progresso geral
        function atualizarProgresso() {
            let progresso = 0;
            const campos = [
                // Dados B√°sicos (40%)
                { id: 'empresaNome', peso: 10 },
                { id: 'setorEmpresa', peso: 10 },
                { id: 'nomeProduto', peso: 10 },
                { id: 'publicoAlvo', peso: 5 },
                { id: 'qtdVendaMensal', peso: 5 },
                
                // Custos (40%)
                { id: 'materiaPrima', peso: 8 },
                { id: 'aluguel', peso: 8 },
                { id: 'salarios', peso: 8 },
                { id: 'precoVendaFinal', peso: 8 },
                { id: 'precoMedioConcorrencia', peso: 8 },
                
                // Outros (20%)
                { id: 'markupInput', peso: 10 },
                { id: 'taxaCrescimentoProjecao', peso: 10 }
            ];
            
            campos.forEach(campo => {
                const element = document.getElementById(campo.id);
                if (element && element.value && element.value.toString().trim() !== '') {
                    progresso += campo.peso;
                }
            });
            
            // Limitar a 100%
            progresso = Math.min(progresso, 100);
            appState.progresso = progresso;
            
            // Atualizar elementos visuais
            document.getElementById('progressoDados').textContent = progresso + '%';
            document.getElementById('progressoBar').style.width = progresso + '%';
            document.getElementById('progressoDadosBar').style.width = progresso + '%';
            
            // Atualizar barra de progresso superior
            atualizarProgressoBar();
            
            return progresso;
        }
        
        function atualizarProgressoBar() {
            const tabOrder = ['dados', 'custos', 'precificacao', 'mercado', 'resultados', 'graficos', 'projecoes', 'recomendacoes'];
            const currentIndex = tabOrder.indexOf(appState.currentTab);
            const progress = ((currentIndex + 1) / tabOrder.length) * 100;
            
            document.getElementById('progressBar').style.width = progress + '%';
            
            // Atualizar step indicators
            tabOrder.forEach((tab, index) => {
                const indicator = document.querySelector(`[onclick="openTab('${tab}')"]`).previousElementSibling;
                if (indicator && indicator.classList.contains('step-indicator')) {
                    indicator.classList.remove('active', 'completed');
                    if (index < currentIndex) {
                        indicator.classList.add('completed');
                        indicator.innerHTML = '<i class="fas fa-check"></i>';
                    } else if (index === currentIndex) {
                        indicator.classList.add('active');
                        indicator.textContent = index + 1;
                    } else {
                        indicator.textContent = index + 1;
                    }
                }
            });
        }
        
        // Sistema de templates por setor
        function aplicarTemplateSetor(setor) {
            const templates = {
                alimentacao: {
                    materiaPrima: 8.50,
                    embalagem: 1.20,
                    frete: 12.00,
                    comissoesPercent: 5,
                    impostosVenda: 7,
                    taxasPlataforma: 15,
                    aluguel: 1200.00,
                    salarios: 1800.00,
                    contas: 350.00,
                    marketing: 400.00,
                    das: 70.90,
                    manutencao: 200.00,
                    descricaoProduto: "Produtos aliment√≠cios artesanais preparados com ingredientes selecionados e receitas exclusivas. Ideal para quem busca qualidade e sabor diferenciado.",
                    categoriaProduto: "produto_fisico",
                    unidadeMedida: "unidade",
                    sazonalidade: "alta_natal",
                    markupInput: 120
                },
                moda: {
                    materiaPrima: 25.00,
                    embalagem: 3.50,
                    frete: 15.00,
                    comissoesPercent: 10,
                    impostosVenda: 12,
                    taxasPlataforma: 20,
                    aluguel: 800.00,
                    salarios: 1500.00,
                    contas: 250.00,
                    marketing: 500.00,
                    das: 70.90,
                    manutencao: 100.00,
                    descricaoProduto: "Pe√ßas de vestu√°rio exclusivas com design contempor√¢neo, confeccionadas com tecidos de alta qualidade e acabamento impec√°vel.",
                    categoriaProduto: "produto_fisico",
                    unidadeMedida: "unidade",
                    sazonalidade: "alta_natal",
                    markupInput: 150
                },
                servicos: {
                    materiaPrima: 5.00,
                    embalagem: 0.50,
                    frete: 0.00,
                    comissoesPercent: 15,
                    impostosVenda: 5,
                    taxasPlataforma: 10,
                    aluguel: 600.00,
                    salarios: 2500.00,
                    contas: 200.00,
                    marketing: 300.00,
                    das: 70.90,
                    manutencao: 150.00,
                    softwareGestao: 99.90,
                    descricaoProduto: "Servi√ßo especializado com metodologia pr√≥pria, garantia de qualidade e atendimento personalizado. Solu√ß√µes eficientes para necessidades espec√≠ficas.",
                    categoriaProduto: "servico",
                    unidadeMedida: "hora",
                    sazonalidade: "constante",
                    markupInput: 100
                },
                tecnologia: {
                    materiaPrima: 45.00,
                    embalagem: 5.00,
                    frete: 20.00,
                    comissoesPercent: 20,
                    impostosVenda: 15,
                    taxasPlataforma: 25,
                    aluguel: 700.00,
                    salarios: 3000.00,
                    contas: 300.00,
                    marketing: 600.00,
                    das: 70.90,
                    manutencao: 300.00,
                    softwareGestao: 149.90,
                    softwareDesign: 49.90,
                    softwareMarketing: 29.90,
                    descricaoProduto: "Solu√ß√£o tecnol√≥gica inovadora com desenvolvimento personalizado, suporte t√©cnico especializado e atualiza√ß√µes constantes.",
                    categoriaProduto: "digital",
                    unidadeMedida: "pacote",
                    sazonalidade: "constante",
                    markupInput: 200
                },
                artesanato: {
                    materiaPrima: 18.00,
                    embalagem: 2.00,
                    frete: 10.00,
                    comissoesPercent: 10,
                    impostosVenda: 7,
                    taxasPlataforma: 18,
                    aluguel: 500.00,
                    salarios: 1200.00,
                    contas: 150.00,
                    marketing: 250.00,
                    das: 70.90,
                    manutencao: 50.00,
                    descricaoProduto: "Pe√ßas artesanais √∫nicas, produzidas manualmente com t√©cnicas tradicionais e materiais naturais. Cada pe√ßa √© uma obra de arte exclusiva.",
                    categoriaProduto: "produto_fisico",
                    unidadeMedida: "unidade",
                    sazonalidade: "alta_natal",
                    markupInput: 180
                }
            };
            
            const template = templates[setor];
            if (!template) return;
            
            // Aplicar valores
            for (const [key, value] of Object.entries(template)) {
                const element = document.getElementById(key);
                if (element) {
                    if (element.type === 'textarea') {
                        element.value = value;
                    } else if (element.type === 'select-one') {
                        element.value = value;
                    } else {
                        element.value = value;
                    }
                    
                    // Disparar evento de input para atualizar c√°lculos
                    element.dispatchEvent(new Event('input'));
                }
            }
            
            // Atualizar setor na empresa
            document.getElementById('setorEmpresa').value = setor;
            
            // Mostrar mensagem de sucesso
            mostrarMensagem(`Template do setor ${setor} aplicado com sucesso!`, 'success');
            
            // Atualizar c√°lculos
            calcularCustos();
            atualizarPrecificacao();
        }
        
        // Sugerir custos baseados no setor
        function sugerirCustosPorSetor() {
            const setor = document.getElementById('setorEmpresa').value;
            if (!setor) {
                mostrarMensagem('Selecione um setor primeiro na aba Dados B√°sicos', 'warning');
                return;
            }
            
            aplicarTemplateSetor(setor);
        }
        
        // C√°lculos de custos
        function calcularCustos() {
            // Coletar valores
            const materiaPrima = parseFloat(document.getElementById('materiaPrima').value) || 0;
            const embalagem = parseFloat(document.getElementById('embalagem').value) || 0;
            const frete = parseFloat(document.getElementById('frete').value) || 0;
            const comissoesPercent = parseFloat(document.getElementById('comissoesPercent').value) || 0;
            const impostosVenda = parseFloat(document.getElementById('impostosVenda').value) || 0;
            const taxasPlataforma = parseFloat(document.getElementById('taxasPlataforma').value) || 0;
            
            const aluguel = parseFloat(document.getElementById('aluguel').value) || 0;
            const salarios = parseFloat(document.getElementById('salarios').value) || 0;
            const contas = parseFloat(document.getElementById('contas').value) || 0;
            const marketing = parseFloat(document.getElementById('marketing').value) || 0;
            const das = parseFloat(document.getElementById('das').value) || 0;
            const manutencao = parseFloat(document.getElementById('manutencao').value) || 0;
            const outrosFixos = parseFloat(document.getElementById('outrosFixos').value) || 0;
            
            const softwareGestao = parseFloat(document.getElementById('softwareGestao').value) || 0;
            const softwareDesign = parseFloat(document.getElementById('softwareDesign').value) || 0;
            const softwareMarketing = parseFloat(document.getElementById('softwareMarketing').value) || 0;
            const softwareOutros = parseFloat(document.getElementById('softwareOutros').value) || 0;
            
            const qtdVendaMensal = parseFloat(document.getElementById('qtdVendaMensal').value) || 100;
            
            // C√°lculos
            const custoVariavelUnitario = materiaPrima + embalagem + frete;
            const custoFixoMensal = aluguel + salarios + contas + marketing + das + manutencao + outrosFixos;
            const custoSoftwareMensal = softwareGestao + softwareDesign + softwareMarketing + softwareOutros;
            const custoFixoTotal = custoFixoMensal + custoSoftwareMensal;
            
            const custoFixoPorUnidade = custoFixoTotal / qtdVendaMensal;
            const custoTotalUnitario = custoVariavelUnitario + custoFixoPorUnidade;
            
            const comissoesUnitario = (comissoesPercent / 100) * (document.getElementById('precoVendaFinal').value || 65);
            const impostosUnitario = (impostosVenda / 100) * (document.getElementById('precoVendaFinal').value || 65);
            const taxasUnitario = (taxasPlataforma / 100) * (document.getElementById('precoVendaFinal').value || 65);
            
            const custoTotalComTaxas = custoTotalUnitario + comissoesUnitario + impostosUnitario + taxasUnitario;
            
            // Atualizar resumo
            document.getElementById('resumoCustoUnitario').textContent = formatarMoeda(custoVariavelUnitario);
            document.getElementById('resumoCustoFixo').textContent = formatarMoeda(custoFixoTotal);
            document.getElementById('resumoCustoTotal').textContent = formatarMoeda(custoFixoTotal + (custoVariavelUnitario * qtdVendaMensal));
            
            // Calcular markup sugerido (baseado em margem de 30%)
            const markupSugerido = Math.round(((custoTotalComTaxas * 1.3) / custoTotalComTaxas - 1) * 100);
            document.getElementById('resumoMarkupSugerido').textContent = markupSugerido + '%';
            
            // Atualizar an√°lise de custo-benef√≠cio
            const custoBeneficio = calcularCustoBeneficio(custoFixoTotal, custoVariavelUnitario, qtdVendaMensal);
            document.getElementById('custoBeneficioBar').style.width = custoBeneficio.percentual + '%';
            document.getElementById('custoBeneficioTexto').textContent = custoBeneficio.texto;
            document.getElementById('oportunidadeReducao').textContent = custoBeneficio.oportunidade + '%';
            document.getElementById('custosDesnecessarios').textContent = formatarMoeda(custoBeneficio.desnecessarios);
            document.getElementById('impactoReducaoCustos').textContent = formatarMoeda(custoBeneficio.impactoReducao);
            
            // Salvar no state
            appState.dados.custos = {
                custoVariavelUnitario,
                custoFixoTotal,
                custoTotalUnitario,
                custoTotalComTaxas,
                qtdVendaMensal
            };
            
            // Disparar atualiza√ß√£o de precifica√ß√£o
            setTimeout(atualizarPrecificacao, 50);
            
            return appState.dados.custos;
        }
        
        function calcularCustoBeneficio(custoFixo, custoVarUnit, quantidade) {
            const custoTotal = custoFixo + (custoVarUnit * quantidade);
            const mediaSetor = quantidade * 50; // Exemplo simplificado
            
            let percentual = 75;
            let texto = "Bom";
            let oportunidade = 15;
            let desnecessarios = custoFixo * 0.1;
            let impactoReducao = custoFixo * 0.1;
            
            if (custoTotal > mediaSetor * 1.5) {
                percentual = 25;
                texto = "Cr√≠tico";
                oportunidade = 40;
                desnecessarios = custoFixo * 0.3;
                impactoReducao = custoFixo * 0.3;
            } else if (custoTotal > mediaSetor * 1.2) {
                percentual = 50;
                texto = "Regular";
                oportunidade = 25;
                desnecessarios = custoFixo * 0.2;
                impactoReducao = custoFixo * 0.2;
            } else if (custoTotal < mediaSetor * 0.8) {
                percentual = 90;
                texto = "Excelente";
                oportunidade = 5;
                desnecessarios = custoFixo * 0.05;
                impactoReducao = custoFixo * 0.05;
            }
            
            return {
                percentual,
                texto,
                oportunidade,
                desnecessarios,
                impactoReducao
            };
        }
// Sistema de precifica√ß√£o
        function selecionarMetodo(metodo) {
            appState.metodoPrecificacao = metodo;
            document.getElementById('metodoSelecionado').textContent = 
                metodo === 'markup' ? 'Markup (Recomendado para iniciantes)' :
                metodo === 'margem' ? 'Margem de Lucro' :
                metodo === 'mercado' ? 'Pre√ßo de Mercado' :
                metodo === 'valor' ? 'Valor Percebido' :
                metodo === 'psicologico' ? 'Pre√ßo Psicol√≥gico' :
                'Recomenda√ß√£o IA';
            
            // Mostrar configura√ß√£o do m√©todo selecionado
            document.querySelectorAll('.metodo-config').forEach(el => {
                el.style.display = 'none';
            });
            
            const configEl = document.getElementById(`configMetodo${metodo.charAt(0).toUpperCase() + metodo.slice(1)}`);
            if (configEl) {
                configEl.style.display = 'block';
            }
            
            // Atualizar precifica√ß√£o
            atualizarPrecificacao();
        }
        
        function atualizarMarkup(valor) {
            document.getElementById('markupSlider').value = valor;
            document.getElementById('markupInput').value = valor;
            
            const custos = appState.dados.custos;
            if (!custos || !custos.custoTotalUnitario) return;
            
            const precoBase = custos.custoTotalUnitario;
            
            // Pre√ßos sugeridos
            document.getElementById('precoMarkupMin').textContent = formatarMoeda(precoBase * 1.6);
            document.getElementById('precoMarkupMedio').textContent = formatarMoeda(precoBase * 2.0);
            document.getElementById('precoMarkupMax').textContent = formatarMoeda(precoBase * 2.5);
            document.getElementById('precoMarkupAtual').textContent = formatarMoeda(precoBase * (1 + valor/100));
            
            // Pre√ßo final sugerido
            const precoSugerido = precoBase * (1 + valor/100);
            document.getElementById('precoFinalSugerido').textContent = formatarMoeda(precoSugerido);
            
            // Atualizar pre√ßo de venda se estiver pr√≥ximo do sugerido
            const precoAtual = parseFloat(document.getElementById('precoVendaFinal').value) || 0;
            if (Math.abs(precoAtual - precoSugerido) < precoSugerido * 0.1) {
                document.getElementById('precoVendaFinal').value = precoSugerido.toFixed(2);
                atualizarPrecoFinal(precoSugerido);
            }
            
            // Atualizar composi√ß√£o
            atualizarComposicaoPreco();
        }
        
        function atualizarPrecificacao() {
            const custos = calcularCustos();
            if (!custos) return;
            
            // Atualizar composi√ß√£o do pre√ßo
            atualizarComposicaoPreco();
            
            // Atualizar pre√ßos psicol√≥gicos
            const precoSugerido = parseFloat(document.getElementById('precoFinalSugerido').textContent.replace('R$ ', '').replace('.', '').replace(',', '.')) || 0;
            
            if (precoSugerido > 0) {
                document.getElementById('precoPsico99').textContent = formatarMoeda(Math.floor(precoSugerido) + 0.99);
                document.getElementById('precoPsico95').textContent = formatarMoeda(Math.floor(precoSugerido) + 0.95);
                document.getElementById('precoPsico90').textContent = formatarMoeda(Math.floor(precoSugerido) + 0.90);
                document.getElementById('precoPsicoArred').textContent = formatarMoeda(Math.round(precoSugerido));
            }
            
            // Atualizar impacto do pre√ßo atual
            const precoAtual = parseFloat(document.getElementById('precoVendaFinal').value) || precoSugerido;
            atualizarPrecoFinal(precoAtual);
        }
        
        function atualizarComposicaoPreco() {
            const custos = appState.dados.custos;
            if (!custos) return;
            
            const precoVenda = parseFloat(document.getElementById('precoVendaFinal').value) || custos.custoTotalUnitario * 2;
            const qtdVenda = custos.qtdVendaMensal || 100;
            
            // Atualizar valores
            document.getElementById('compCustoVarUnit').textContent = formatarMoeda(custos.custoVariavelUnitario);
            document.getElementById('compCustoFixoUnit').textContent = formatarMoeda(custos.custoFixoTotal / qtdVenda);
            document.getElementById('compCustoTotalUnit').textContent = formatarMoeda(custos.custoTotalUnitario);
            
            const markup = ((precoVenda / custos.custoTotalUnitario) - 1) * 100;
            document.getElementById('compMarkupAplicado').textContent = markup.toFixed(1) + '%';
            document.getElementById('compPrecoFinal').textContent = formatarMoeda(precoVenda);
            
            const lucroUnitario = precoVenda - custos.custoTotalUnitario;
            document.getElementById('lucroPorUnidade').textContent = formatarMoeda(lucroUnitario);
            document.getElementById('margemLucroUnidade').textContent = ((lucroUnitario / precoVenda) * 100).toFixed(1) + '%';
            
            // Atualizar gr√°fico de composi√ß√£o
            atualizarGraficoComposicaoPreco();
        }
        
        function aplicarPrecoPsicologico(tipo) {
            const precoAtual = parseFloat(document.getElementById('precoVendaFinal').value) || 0;
            let novoPreco = precoAtual;
            
            switch(tipo) {
                case '99':
                    novoPreco = Math.floor(precoAtual) + 0.99;
                    break;
                case '95':
                    novoPreco = Math.floor(precoAtual) + 0.95;
                    break;
                case '90':
                    novoPreco = Math.floor(precoAtual) + 0.90;
                    break;
                case 'arredondado':
                    novoPreco = Math.round(precoAtual);
                    break;
            }
            
            document.getElementById('precoVendaFinal').value = novoPreco.toFixed(2);
            atualizarPrecoFinal(novoPreco);
            
            mostrarMensagem(`Pre√ßo psicol√≥gico aplicado: ${formatarMoeda(novoPreco)}`, 'success');
        }
        
        function atualizarPrecoFinal(valor) {
            const preco = parseFloat(valor) || 0;
            const custos = appState.dados.custos;
            
            if (!custos || preco === 0) return;
            
            const desconto = parseFloat(document.getElementById('descontoPromocional').value) || 0;
            const precoComDesconto = preco * (1 - desconto/100);
            const qtdVenda = custos.qtdVendaMensal || 100;
            
            // C√°lculos
            const lucroUnitario = precoComDesconto - custos.custoTotalUnitario;
            const lucroMensal = lucroUnitario * qtdVenda;
            const margemLucro = (lucroUnitario / precoComDesconto) * 100;
            const pontoEquilibrio = Math.ceil(custos.custoFixoTotal / lucroUnitario);
            
            // Atualizar elementos
            document.getElementById('impactoMargem').textContent = margemLucro.toFixed(1) + '%';
            document.getElementById('impactoLucroUnit').textContent = formatarMoeda(lucroUnitario);
            document.getElementById('impactoLucroMensal').textContent = formatarMoeda(lucroMensal);
            document.getElementById('impactoPontoEquilibrio').textContent = pontoEquilibrio + ' unidades';
            
            // Recomenda√ß√£o
            let recomendacao = '';
            let cor = '';
            
            if (margemLucro < 10) {
                recomendacao = 'Pre√ßo muito baixo - Risco de preju√≠zo';
                cor = 'text-red-600 dark:text-red-400';
            } else if (margemLucro < 20) {
                recomendacao = 'Pre√ßo competitivo - Margem razo√°vel';
                cor = 'text-yellow-600 dark:text-yellow-400';
            } else if (margemLucro < 40) {
                recomendacao = 'Pre√ßo ideal - Boa rentabilidade';
                cor = 'text-green-600 dark:text-green-400';
            } else {
                recomendacao = 'Pre√ßo premium - Alta lucratividade';
                cor = 'text-blue-600 dark:text-blue-400';
            }
            
            document.getElementById('recomendacaoPreco').textContent = recomendacao;
            document.getElementById('recomendacaoPreco').className = `font-bold ${cor}`;
            
            // Salvar no state
            appState.dados.precificacao = {
                precoVenda: preco,
                desconto,
                precoComDesconto,
                lucroUnitario,
                lucroMensal,
                margemLucro,
                pontoEquilibrio
            };
        }
        
        // An√°lise de mercado
        function analisarConcorrencia() {
            const precoMin = parseFloat(document.getElementById('precoMinConcorrencia').value) || 0;
            const precoMedio = parseFloat(document.getElementById('precoMedioConcorrencia').value) || 0;
            const precoMax = parseFloat(document.getElementById('precoMaxConcorrencia').value) || 0;
            const precoMeu = parseFloat(document.getElementById('precoVendaFinal').value) || 0;
            
            if (precoMin === 0 || precoMedio === 0 || precoMax === 0 || precoMeu === 0) {
                mostrarMensagem('Preencha todos os pre√ßos da concorr√™ncia e seu pre√ßo', 'warning');
                return;
            }
            
            // Calcular posi√ß√£o
            const faixa = precoMax - precoMin;
            const posicao = ((precoMeu - precoMin) / faixa) * 100;
            
            // Atualizar marcador
            document.getElementById('marcadorPosicao').style.left = Math.min(Math.max(posicao, 0), 100) + '%';
            
            // Determinar posi√ß√£o textual
            let posicaoTexto = '';
            let cor = '';
            
            if (precoMeu < precoMedio * 0.9) {
                posicaoTexto = 'Abaixo da m√©dia';
                cor = 'text-red-600 dark:text-red-400';
            } else if (precoMeu > precoMedio * 1.1) {
                posicaoTexto = 'Acima da m√©dia';
                cor = 'text-blue-600 dark:text-blue-400';
            } else {
                posicaoTexto = 'No pre√ßo m√©dio';
                cor = 'text-green-600 dark:text-green-400';
            }
            
            document.getElementById('posicaoMercado').textContent = posicaoTexto;
            document.getElementById('posicaoMercado').className = `font-bold ${cor}`;
            
            // Calcular diferen√ßa
            const diferenca = ((precoMeu - precoMedio) / precoMedio) * 100;
            document.getElementById('diferencaMedia').textContent = 
                (diferenca >= 0 ? '+' : '') + diferenca.toFixed(1) + '%';
            document.getElementById('diferencaMedia').className = 
                `font-bold ${diferenca >= 0 ? 'text-blue-600 dark:text-blue-400' : 'text-red-600 dark:text-red-400'}`;
            
            // Vantagem competitiva
            const vantagem = precoMax - precoMeu;
            let vantagemTexto = '';
            let vantagemCor = '';
            
            if (vantagem > precoMedio * 0.3) {
                vantagemTexto = 'Alta';
                vantagemCor = 'text-green-600 dark:text-green-400';
            } else if (vantagem > precoMedio * 0.15) {
                vantagemTexto = 'M√©dia';
                vantagemCor = 'text-yellow-600 dark:text-yellow-400';
            } else {
                vantagemTexto = 'Baixa';
                vantagemCor = 'text-red-600 dark:text-red-400';
            }
            
            document.getElementById('vantagemCompetitiva').textContent = vantagemTexto;
            document.getElementById('vantagemCompetitiva').className = `font-bold ${vantagemCor}`;
            
            // Espa√ßo para aumento
            const espaco = ((precoMax - precoMeu) / precoMeu) * 100;
            document.getElementById('espacoAumento').textContent = espaco.toFixed(1) + '%';
            
            // An√°lise
            let analise = '';
            if (posicao < 33) {
                analise = 'bem posicionado como op√ß√£o econ√¥mica';
            } else if (posicao < 66) {
                analise = 'bem posicionado no mercado m√©dio';
            } else {
                analise = 'bem posicionado como op√ß√£o premium';
            }
            
            document.getElementById('analisePosicao').textContent = analise;
            
            // Atualizar gr√°fico
            atualizarGraficoConcorrencia(precoMin, precoMedio, precoMax, precoMeu);
            
            // Salvar no state
            appState.dados.mercado = {
                precoMin,
                precoMedio,
                precoMax,
                precoMeu,
                posicao,
                diferenca,
                vantagem: vantagemTexto,
                espacoAumento: espaco
            };
        }
        
        function atualizarAnaliseMercado() {
            // Atualizar valor percebido
            const qualidade = parseInt(document.getElementById('valorQualidade').value) || 8;
            const atendimento = parseInt(document.getElementById('valorAtendimento').value) || 7;
            const marca = parseInt(document.getElementById('valorMarca').value) || 6;
            
            const valorPercebido = (qualidade * 0.5 + atendimento * 0.3 + marca * 0.2);
            document.getElementById('valorPercebidoScore').textContent = valorPercebido.toFixed(1);
            
            // Atualizar c√≠rculo de progresso
            const circle = document.querySelector('.progress-ring__circle');
            const radius = 90;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (valorPercebido / 10) * circumference;
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = offset;
            
            // N√≠vel de valor percebido
            let nivel = '';
            let nivelCor = '';
            
            if (valorPercebido >= 8) {
                nivel = 'Valor Muito Alto';
                nivelCor = 'text-green-700 dark:text-green-300';
            } else if (valorPercebido >= 6) {
                nivel = 'Valor Alto';
                nivelCor = 'text-blue-700 dark:text-blue-300';
            } else if (valorPercebido >= 4) {
                nivel = 'Valor M√©dio';
                nivelCor = 'text-yellow-700 dark:text-yellow-300';
            } else {
                nivel = 'Valor Baixo';
                nivelCor = 'text-red-700 dark:text-red-300';
            }
            
            document.getElementById('nivelValorPercebido').textContent = nivel;
            document.getElementById('nivelValorPercebido').className = `text-lg font-bold ${nivelCor}`;
            
            // Compara√ß√£o e premium permitido
            const comparacao = valorPercebido >= 7 ? 'alto' : valorPercebido >= 5 ? 'm√©dio' : 'baixo';
            const premium = valorPercebido >= 8 ? '20-30%' : valorPercebido >= 6 ? '15-20%' : valorPercebido >= 4 ? '5-10%' : '0%';
            
            document.getElementById('comparacaoValorPercebido').textContent = comparacao;
            document.getElementById('premiumPermitido').textContent = premium;
            
            // Atualizar an√°lise de concorr√™ncia
            analisarConcorrencia();
        }
        
        // C√°lculos de resultados
        function calcularResultados() {
            const precificacao = appState.dados.precificacao;
            const custos = appState.dados.custos;
            
            if (!precificacao || !custos) {
                mostrarMensagem('Complete as abas anteriores primeiro', 'warning');
                return;
            }
            
            const {
                lucroMensal,
                margemLucro,
                pontoEquilibrio
            } = precificacao;
            
            const {
                qtdVendaMensal,
                custoFixoTotal,
                custoVariavelUnitario
            } = custos;
            
            const faturamentoMensal = (precificacao.precoComDesconto || 0) * qtdVendaMensal;
            const custoTotalMensal = custoFixoTotal + (custoVariavelUnitario * qtdVendaMensal);
            
            // KPIs
            document.getElementById('kpiFaturamento').textContent = formatarMoeda(faturamentoMensal);
            document.getElementById('kpiLucro').textContent = formatarMoeda(lucroMensal);
            document.getElementById('kpiMargem').textContent = margemLucro.toFixed(1) + '%';
            document.getElementById('kpiPontoEquilibrio').textContent = pontoEquilibrio;
            
            // Demonstra√ß√£o de resultados
            document.getElementById('dresReceitaBruta').textContent = formatarMoeda(faturamentoMensal);
            document.getElementById('dresCustoMercadorias').textContent = formatarMoeda(custoVariavelUnitario * qtdVendaMensal);
            document.getElementById('dresCustosVariaveis').textContent = formatarMoeda(0); // J√° incluso no CMV
            document.getElementById('dresCustosFixos').textContent = formatarMoeda(custoFixoTotal);
            document.getElementById('dresImpostos').textContent = formatarMoeda(faturamentoMensal * 0.07); // Estimativa
            document.getElementById('dresLucroLiquido').textContent = formatarMoeda(lucroMensal);
            document.getElementById('dresMargemLucro').textContent = margemLucro.toFixed(1) + '%';
            document.getElementById('dresLucroUnitario').textContent = formatarMoeda(lucroMensal / qtdVendaMensal);
            
            // Rentabilidade
            const investimentoInicial = custoFixoTotal * 3;
            const roi = investimentoInicial > 0 ? (lucroMensal * 12 / investimentoInicial) * 100 : 0;
            const payback = investimentoInicial > 0 ? Math.ceil(investimentoInicial / lucroMensal) : 0;
            
            document.getElementById('rentabilidadeROI').textContent = roi.toFixed(1) + '%';
            document.getElementById('rentabilidadePayback').textContent = payback + ' meses';
            document.getElementById('rentabilidadeLucroAnual').textContent = formatarMoeda(lucroMensal * 12);
            document.getElementById('rentabilidadeTicketMedio').textContent = formatarMoeda(precificacao.precoComDesconto || 0);
            
            // An√°lise de ponto de equil√≠brio
            document.getElementById('analisePontoEquilibrioUn').textContent = pontoEquilibrio;
            document.getElementById('analisePontoEquilibrioPercent').textContent = 
                ((pontoEquilibrio / qtdVendaMensal) * 100).toFixed(1) + '%';
            
            // Atualizar dashboard
            document.getElementById('dashFaturamento').textContent = formatarMoeda(faturamentoMensal);
            document.getElementById('dashLucro').textContent = formatarMoeda(lucroMensal);
            document.getElementById('dashMargem').textContent = margemLucro.toFixed(1) + '%';
            document.getElementById('dashPontoEquilibrio').textContent = pontoEquilibrio;
            
            // Salvar no state
            appState.dados.resultados = {
                faturamentoMensal,
                lucroMensal,
                margemLucro,
                pontoEquilibrio,
                custoTotalMensal,
                roi,
                payback,
                lucroAnual: lucroMensal * 12
            };
            
            // Atualizar gr√°ficos
            atualizarGraficosResultados();
            
            return appState.dados.resultados;
        }
        
        function atualizarSensibilidade() {
            const precoVar = parseInt(document.getElementById('sensibilidadePreco').value) || 0;
            const custoVar = parseInt(document.getElementById('sensibilidadeCusto').value) || 0;
            const qtdVar = parseInt(document.getElementById('sensibilidadeQuantidade').value) || 0;
            
            document.getElementById('sensibilidadePrecoValor').textContent = (precoVar >= 0 ? '+' : '') + precoVar + '%';
            document.getElementById('sensibilidadeCustoValor').textContent = (custoVar >= 0 ? '+' : '') + custoVar + '%';
            document.getElementById('sensibilidadeQuantidadeValor').textContent = (qtdVar >= 0 ? '+' : '') + qtdVar + '%';
            
            const resultados = appState.dados.resultados;
            if (!resultados) return;
            
            // C√°lculo simplificado do impacto
            const impacto = resultados.lucroMensal * 
                          (1 + precoVar/100) * 
                          (1 - custoVar/100) * 
                          (1 + qtdVar/100) - 
                          resultados.lucroMensal;
            
            const percentual = (impacto / resultados.lucroMensal) * 100;
            
            document.getElementById('impactoSensibilidadeLucro').textContent = formatarMoeda(resultados.lucroMensal + impacto);
            document.getElementById('impactoSensibilidadePercent').textContent = 
                (percentual >= 0 ? '+' : '') + percentual.toFixed(1) + '% de varia√ß√£o';
            
            document.getElementById('impactoSensibilidadeLucro').className = 
                `text-2xl font-bold text-center ${impacto >= 0 ? 'text-green-600' : 'text-red-600'}`;
        }
        
        // Sistema de gr√°ficos
        let graficos = {};
        
        function atualizarGraficos() {
            // Gr√°fico de composi√ß√£o do pre√ßo
            atualizarGraficoComposicaoPreco();
            
            // Gr√°fico de distribui√ß√£o de custos
            atualizarGraficoDistribuicaoCustos();
            
            // Gr√°fico de rentabilidade
            atualizarGraficoRentabilidade();
            
            // Gr√°fico de ponto de equil√≠brio
            atualizarGraficoPontoEquilibrio();
            
            // Gr√°fico de concorr√™ncia
            const mercado = appState.dados.mercado;
            if (mercado) {
                atualizarGraficoConcorrencia(mercado.precoMin, mercado.precoMedio, mercado.precoMax, mercado.precoMeu);
            }
            
            // Gr√°fico de evolu√ß√£o de resultados
            atualizarGraficoEvolucaoResultados();
            
            // Gr√°ficos do dashboard
            atualizarGraficoDashboard();
        }
        
        function atualizarGraficoComposicaoPreco() {
            const ctx = document.getElementById('graficoComposicaoPreco').getContext('2d');
            const custos = appState.dados.custos;
            const precificacao = appState.dados.precificacao;
            
            if (!custos || !precificacao) return;
            
            if (graficos.composicaoPreco) {
                graficos.composicaoPreco.destroy();
            }
            
            const preco = precificacao.precoComDesconto || custos.custoTotalUnitario * 2;
            const dados = [
                {
                    label: 'Mat√©ria-Prima',
                    value: custos.custoVariavelUnitario * 0.6,
                    color: '#3b82f6'
                },
                {
                    label: 'Embalagem/Frete',
                    value: custos.custoVariavelUnitario * 0.4,
                    color: '#60a5fa'
                },
                {
                    label: 'Custos Fixos',
                    value: custos.custoFixoTotal / custos.qtdVendaMensal,
                    color: '#ef4444'
                },
                {
                    label: 'Impostos/Taxas',
                    value: preco * 0.12,
                    color: '#f59e0b'
                },
                {
                    label: 'Lucro',
                    value: preco - custos.custoTotalUnitario - (preco * 0.12),
                    color: '#10b981'
                }
            ];
            
            // Filtrar valores positivos
            const dadosFiltrados = dados.filter(d => d.value > 0);
            
            graficos.composicaoPreco = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: dadosFiltrados.map(d => d.label),
                    datasets: [{
                        data: dadosFiltrados.map(d => d.value),
                        backgroundColor: dadosFiltrados.map(d => d.color),
                        borderWidth: 2,
                        borderColor: document.body.classList.contains('dark-mode') ? '#1f2937' : '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                padding: 20,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${formatarMoeda(value)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Atualizar legenda
            const lucroPercent = ((preco - custos.custoTotalUnitario - (preco * 0.12)) / preco) * 100;
            const custosPercent = 100 - lucroPercent;
            
            document.getElementById('legendaMargem').textContent = lucroPercent.toFixed(1) + '%';
            document.getElementById('legendaCustos').textContent = custosPercent.toFixed(1) + '%';
        }
        
        function atualizarGraficoDistribuicaoCustos() {
            const ctx = document.getElementById('graficoDistribuicaoCustos').getContext('2d');
            const custos = appState.dados.custos;
            
            if (!custos) return;
            
            if (graficos.distribuicaoCustos) {
                graficos.distribuicaoCustos.destroy();
            }
            
            const dados = [
                { label: 'Mat√©ria-Prima', valor: parseFloat(document.getElementById('materiaPrima').value) || 0 },
                { label: 'Embalagem', valor: parseFloat(document.getElementById('embalagem').value) || 0 },
                { label: 'Frete', valor: parseFloat(document.getElementById('frete').value) || 0 },
                { label: 'Aluguel', valor: parseFloat(document.getElementById('aluguel').value) || 0 },
                { label: 'Sal√°rios', valor: parseFloat(document.getElementById('salarios').value) || 0 },
                { label: 'Contas', valor: parseFloat(document.getElementById('contas').value) || 0 },
                { label: 'Marketing', valor: parseFloat(document.getElementById('marketing').value) || 0 },
                { label: 'Software', valor: (parseFloat(document.getElementById('softwareGestao').value) || 0) + 
                                           (parseFloat(document.getElementById('softwareDesign').value) || 0) + 
                                           (parseFloat(document.getElementById('softwareMarketing').value) || 0) }
            ];
            
            // Ordenar por valor (maior para menor)
            dados.sort((a, b) => b.valor - a.valor);
            
            // Encontrar maior custo
            const maiorCusto = dados.reduce((prev, current) => (prev.valor > current.valor) ? prev : current);
            document.getElementById('maiorCusto').textContent = maiorCusto.label.toLowerCase();
            
            graficos.distribuicaoCustos = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dados.map(d => d.label),
                    datasets: [{
                        label: 'Valor em R$',
                        data: dados.map(d => d.valor),
                        backgroundColor: [
                            '#3b82f6', '#60a5fa', '#93c5fd',
                            '#ef4444', '#f87171', '#fca5a5',
                            '#f59e0b', '#fbbf24'
                        ],
                        borderWidth: 1,
                        borderColor: document.body.classList.contains('dark-mode') ? '#1f2937' : '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                maxRotation: 45
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'R$ ' + context.raw.toLocaleString('pt-BR', {minimumFractionDigits: 2});
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarGraficoRentabilidade() {
            const ctx = document.getElementById('graficoRentabilidade').getContext('2d');
            const resultados = appState.dados.resultados;
            
            if (!resultados) return;
            
            if (graficos.rentabilidade) {
                graficos.rentabilidade.destroy();
            }
            
            graficos.rentabilidade = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Receita', 'Custos', 'Lucro'],
                    datasets: [{
                        data: [resultados.faturamentoMensal, resultados.custoTotalMensal, resultados.lucroMensal],
                        backgroundColor: ['#10b981', '#ef4444', '#3b82f6'],
                        borderWidth: 2,
                        borderColor: document.body.classList.contains('dark-mode') ? '#1f2937' : '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                callback: function(value) {
                                    return 'R$ ' + (value/1000).toLocaleString('pt-BR') + 'k';
                                }
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Atualizar valores
            document.getElementById('rentabilidadeReceita').textContent = formatarMoeda(resultados.faturamentoMensal);
            document.getElementById('rentabilidadeCusto').textContent = formatarMoeda(resultados.custoTotalMensal);
            document.getElementById('rentabilidadeLucro').textContent = formatarMoeda(resultados.lucroMensal);
        }
        
        function atualizarGraficoPontoEquilibrio() {
            const ctx = document.getElementById('graficoPontoEquilibrioDetalhado').getContext('2d');
            const custos = appState.dados.custos;
            const precificacao = appState.dados.precificacao;
            
            if (!custos || !precificacao) return;
            
            if (graficos.pontoEquilibrio) {
                graficos.pontoEquilibrio.destroy();
            }
            
            const qtdVendas = custos.qtdVendaMensal;
            const pontoEquilibrio = precificacao.pontoEquilibrio;
            const custoFixo = custos.custoFixoTotal;
            const custoVariavelUnit = custos.custoVariavelUnitario;
            const precoVenda = precificacao.precoComDesconto;
            
            // Gerar dados
            const unidades = [];
            const receitas = [];
            const custosTotais = [];
            const custosFixosLine = [];
            
            const maxUnidades = Math.max(qtdVendas * 1.5, pontoEquilibrio * 1.5);
            const step = Math.max(1, Math.floor(maxUnidades / 20));
            
            for (let i = 0; i <= maxUnidades; i += step) {
                unidades.push(i);
                receitas.push(i * precoVenda);
                custosTotais.push(custoFixo + (i * custoVariavelUnit));
                custosFixosLine.push(custoFixo);
            }
            
            graficos.pontoEquilibrio = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: unidades,
                    datasets: [
                        {
                            label: 'Receita Total',
                            data: receitas,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Custo Total',
                            data: custosTotais,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Custo Fixo',
                            data: custosFixosLine,
                            borderColor: '#f59e0b',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                callback: function(value) {
                                    return 'R$ ' + (value/1000).toFixed(0) + 'k';
                                }
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                padding: 20
                            }
                        },
                        annotation: {
                            annotations: {
                                linhaEquilibrio: {
                                    type: 'line',
                                    xMin: pontoEquilibrio,
                                    xMax: pontoEquilibrio,
                                    borderColor: '#8b5cf6',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: {
                                        content: `PE: ${pontoEquilibrio} un`,
                                        enabled: true,
                                        position: 'end',
                                        backgroundColor: '#8b5cf6',
                                        color: 'white',
                                        font: {
                                            size: 12
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            });
            
            document.getElementById('pontoEquilibrioInfo').textContent = pontoEquilibrio + ' unidades';
        }
        
        function atualizarGraficoConcorrencia(precoMin, precoMedio, precoMax, precoMeu) {
            const ctx = document.getElementById('graficoComparativoConcorrencia').getContext('2d');
            
            if (graficos.concorrencia) {
                graficos.concorrencia.destroy();
            }
            
            graficos.concorrencia = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['M√≠nimo', 'M√©dio', 'M√°ximo', 'Seu Pre√ßo'],
                    datasets: [{
                        label: 'Pre√ßo (R$)',
                        data: [precoMin, precoMedio, precoMax, precoMeu],
                        backgroundColor: ['#ef4444', '#f59e0b', '#10b981', '#3b82f6'],
                        borderWidth: 1,
                        borderColor: document.body.classList.contains('dark-mode') ? '#1f2937' : '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Atualizar posi√ß√£o
            let posicao = '';
            if (precoMeu < precoMedio * 0.9) {
                posicao = 'Econ√¥mica';
            } else if (precoMeu > precoMedio * 1.1) {
                posicao = 'Premium';
            } else {
                posicao = 'Intermedi√°ria';
            }
            
            document.getElementById('posicaoConcorrenciaInfo').textContent = posicao;
        }
        
        function atualizarGraficoEvolucaoResultados() {
            const ctx = document.getElementById('graficoEvolucaoResultados').getContext('2d');
            const resultados = appState.dados.resultados;
            const taxaCrescimento = parseFloat(document.getElementById('taxaCrescimento').value) || 10;
            
            if (!resultados) return;
            
            if (graficos.evolucaoResultados) {
                graficos.evolucaoResultados.destroy();
            }
            
            // Gerar proje√ß√£o para 6 meses
            const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'];
            const faturamentos = [];
            const lucros = [];
            
            for (let i = 0; i < 6; i++) {
                const crescimento = Math.pow(1 + taxaCrescimento/100, i);
                faturamentos.push(resultados.faturamentoMensal * crescimento);
                lucros.push(resultados.lucroMensal * crescimento);
            }
            
            graficos.evolucaoResultados = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: meses,
                    datasets: [
                        {
                            label: 'Faturamento',
                            data: faturamentos,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        },
                        {
                            label: 'Lucro',
                            data: lucros,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                callback: function(value) {
                                    return 'R$ ' + (value/1000).toFixed(0) + 'k';
                                }
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                padding: 20
                            }
                        }
                    }
                }
            });
            
            // Atualizar m√©tricas
            document.getElementById('crescimentoMensal').textContent = taxaCrescimento + '%';
            document.getElementById('previsao6Meses').textContent = formatarMoeda(faturamentos[5]);
        }
        
        function atualizarGraficosResultados() {
            // Gr√°fico de distribui√ß√£o de resultados
            const ctx1 = document.getElementById('graficoDistribuicaoResultados').getContext('2d');
            const resultados = appState.dados.resultados;
            
            if (!resultados) return;
            
            if (graficos.distribuicaoResultados) {
                graficos.distribuicaoResultados.destroy();
            }
            
            graficos.distribuicaoResultados = new Chart(ctx1, {
                type: 'pie',
                data: {
                    labels: ['Lucro', 'Custos Vari√°veis', 'Custos Fixos', 'Impostos'],
                    datasets: [{
                        data: [
                            resultados.lucroMensal,
                            resultados.custoTotalMensal * 0.6, // Estimativa
                            resultados.custoTotalMensal * 0.3, // Estimativa
                            resultados.faturamentoMensal * 0.1 // Estimativa
                        ],
                        backgroundColor: ['#10b981', '#3b82f6', '#ef4444', '#f59e0b'],
                        borderWidth: 2,
                        borderColor: document.body.classList.contains('dark-mode') ? '#1f2937' : '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${formatarMoeda(value)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            // Gr√°fico de evolu√ß√£o do lucro (simplificado)
            const ctx2 = document.getElementById('graficoEvolucaoLucro').getContext('2d');
            
            if (graficos.evolucaoLucro) {
                graficos.evolucaoLucro.destroy();
            }
            
            const meses = ['M√™s 1', 'M√™s 2', 'M√™s 3', 'M√™s 4', 'M√™s 5', 'M√™s 6'];
            const taxa = parseFloat(document.getElementById('taxaCrescimento').value) || 10;
            const lucrosProjetados = [];
            
            for (let i = 0; i < 6; i++) {
                lucrosProjetados.push(resultados.lucroMensal * Math.pow(1 + taxa/100, i));
            }
            
            graficos.evolucaoLucro = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: meses,
                    datasets: [{
                        label: 'Lucro Projetado',
                        data: lucrosProjetados,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                }
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        function atualizarGraficoDashboard() {
            const ctx = document.getElementById('dashGraficoResumo').getContext('2d');
            const resultados = appState.dados.resultados;
            
            if (!resultados) return;
            
            if (graficos.dashboard) {
                graficos.dashboard.destroy();
            }
            
            const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'];
            const taxa = parseFloat(document.getElementById('taxaCrescimento').value) || 10;
            const faturamentos = [];
            const lucros = [];
            
            for (let i = 0; i < 6; i++) {
                const crescimento = Math.pow(1 + taxa/100, i);
                faturamentos.push(resultados.faturamentoMensal * crescimento);
                lucros.push(resultados.lucroMensal * crescimento);
            }
            
            graficos.dashboard = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: meses,
                    datasets: [
                        {
                            label: 'Faturamento',
                            data: faturamentos,
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: '#3b82f6',
                            borderWidth: 1
                        },
                        {
                            label: 'Lucro',
                            data: lucros,
                            backgroundColor: 'rgba(16, 185, 129, 0.7)',
                            borderColor: '#10b981',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                callback: function(value) {
                                    return 'R$ ' + (value/1000).toFixed(0) + 'k';
                                }
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                padding: 20
                            }
                        }
                    }
                }
            });
        }
        
        // Sistema de proje√ß√µes
        function atualizarProjecoes() {
            const resultados = appState.dados.resultados;
            if (!resultados) return;
            
            const horizonte = parseInt(document.getElementById('horizonteProjecao').value) || 12;
            const taxa = parseFloat(document.getElementById('taxaCrescimentoProjecao').value) || 5;
            const cenario = document.getElementById('cenarioBase').value;
            
            // Ajustar taxa conforme cen√°rio
            let taxaAjustada = taxa;
            if (cenario === 'otimista') taxaAjustada *= 1.5;
            if (cenario === 'pessimista') taxaAjustada *= 0.5;
            
            // Gerar dados
            const meses = Array.from({length: horizonte}, (_, i) => `M√™s ${i+1}`);
            const faturamentos = [];
            const lucros = [];
            
            for (let i = 0; i < horizonte; i++) {
                const crescimento = Math.pow(1 + taxaAjustada/100, i);
                faturamentos.push(resultados.faturamentoMensal * crescimento);
                lucros.push(resultados.lucroMensal * crescimento);
            }
            
            // Atualizar valores nos cards
            const meio = Math.floor(horizonte/2) - 1;
            const fim = horizonte - 1;
            
            document.getElementById('projecaoInicio').textContent = formatarMoeda(faturamentos[0]);
            document.getElementById('projecaoMeio').textContent = formatarMoeda(faturamentos[meio]);
            document.getElementById('projecaoFim').textContent = formatarMoeda(faturamentos[fim]);
            
            document.getElementById('lucroProjecaoInicio').textContent = formatarMoeda(lucros[0]);
            document.getElementById('lucroProjecaoMeio').textContent = formatarMoeda(lucros[meio]);
            document.getElementById('lucroProjecaoFim').textContent = formatarMoeda(lucros[fim]);
            
            // Atualizar cen√°rios
            document.getElementById('cenarioPessimistaValor').textContent = formatarMoeda(resultados.faturamentoMensal * Math.pow(1 + (taxa * 0.5)/100, fim));
            document.getElementById('cenarioRealistaValor').textContent = formatarMoeda(faturamentos[fim]);
            document.getElementById('cenarioOtimistaValor').textContent = formatarMoeda(resultados.faturamentoMensal * Math.pow(1 + (taxa * 1.5)/100, fim));
            
            // Atualizar gr√°ficos de proje√ß√£o
            atualizarGraficosProjecao(meses, faturamentos, lucros, horizonte, cenario, taxa);
            
            // Atualizar an√°lise de viabilidade
            atualizarAnaliseViabilidade(resultados, faturamentos[fim], lucros[fim], horizonte);
            
            // Atualizar metas trimestrais
            atualizarMetasTrimestrais(faturamentos);
        }
        
        function atualizarGraficosProjecao(meses, faturamentos, lucros, horizonte, cenario, taxa) {
            // Gr√°fico de proje√ß√£o de faturamento
            const ctx1 = document.getElementById('graficoProjecaoFaturamento').getContext('2d');
            
            if (graficos.projecaoFaturamento) {
                graficos.projecaoFaturamento.destroy();
            }
            
            graficos.projecaoFaturamento = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: meses,
                    datasets: [{
                        label: 'Faturamento',
                        data: faturamentos,
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                callback: function(value) {
                                    return 'R$ ' + (value/1000).toFixed(0) + 'k';
                                }
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Gr√°fico de proje√ß√£o de lucro
            const ctx2 = document.getElementById('graficoProjecaoLucro').getContext('2d');
            
            if (graficos.projecaoLucro) {
                graficos.projecaoLucro.destroy();
            }
            
            graficos.projecaoLucro = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: meses,
                    datasets: [{
                        label: 'Lucro',
                        data: lucros,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                callback: function(value) {
                                    return 'R$ ' + (value/1000).toFixed(0) + 'k';
                                }
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Gr√°fico comparativo de cen√°rios
            const ctx3 = document.getElementById('graficoComparativoCenarios').getContext('2d');
            
            if (graficos.comparativoCenarios) {
                graficos.comparativoCenarios.destroy();
            }
            
            // Gerar dados para tr√™s cen√°rios
            const cenariosData = {
                otimista: [],
                realista: [],
                pessimista: []
            };
            
            for (let i = 0; i < horizonte; i++) {
                cenariosData.otimista.push(faturamentos[0] * Math.pow(1 + (taxa * 1.5)/100, i));
                cenariosData.realista.push(faturamentos[0] * Math.pow(1 + taxa/100, i));
                cenariosData.pessimista.push(faturamentos[0] * Math.pow(1 + (taxa * 0.5)/100, i));
            }
            
            graficos.comparativoCenarios = new Chart(ctx3, {
                type: 'line',
                data: {
                    labels: meses,
                    datasets: [
                        {
                            label: 'Otimista',
                            data: cenariosData.otimista,
                            borderColor: '#10b981',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.4
                        },
                        {
                            label: 'Realista',
                            data: cenariosData.realista,
                            borderColor: '#3b82f6',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.4
                        },
                        {
                            label: 'Pessimista',
                            data: cenariosData.pessimista,
                            borderColor: '#ef4444',
                            borderWidth: 3,
                            fill: false,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                callback: function(value) {
                                    return 'R$ ' + (value/1000).toFixed(0) + 'k';
                                }
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                padding: 20
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarAnaliseViabilidade(resultados, faturamentoFinal, lucroFinal, horizonte) {
            const investimentoInicial = resultados.custoTotalMensal * 3;
            const lucroTotal = lucroFinal * horizonte;
            const roi = ((lucroTotal - investimentoInicial) / investimentoInicial) * 100;
            const payback = Math.ceil(investimentoInicial / resultados.lucroMensal);
            
            // VPL simplificado (taxa de desconto de 10% ao ano)
            const taxaDesconto = 0.10;
            let vpl = -investimentoInicial;
            for (let i = 1; i <= horizonte; i++) {
                vpl += resultados.lucroMensal * Math.pow(1 + taxaDesconto/12, -i);
            }
            
            // TIR simplificada
            const tir = (lucroTotal / investimentoInicial) * (12/horizonte) * 100;
            
            // Atualizar indicadores
            document.getElementById('viabilidadeROI').textContent = roi.toFixed(1) + '%';
            document.getElementById('viabilidadePayback').textContent = payback + ' meses';
            document.getElementById('viabilidadeVPL').textContent = formatarMoeda(vpl);
            document.getElementById('viabilidadeTIR').textContent = tir.toFixed(1) + '%';
            
            // Pontua√ß√£o de viabilidade (0-10)
            let pontuacao = 7.5; // Base
            if (roi > 50) pontuacao += 1.5;
            if (payback < 12) pontuacao += 1.5;
            if (vpl > 0) pontuacao += 1.0;
            if (tir > 20) pontuacao += 1.0;
            
            pontuacao = Math.min(pontuacao, 10);
            
            // Atualizar c√≠rculo de progresso
            const circle = document.querySelectorAll('.progress-ring__circle')[1];
            if (circle) {
                const radius = 90;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (pontuacao / 10) * circumference;
                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                circle.style.strokeDashoffset = offset;
            }
            
            document.getElementById('pontuacaoViabilidade').textContent = pontuacao.toFixed(1);
            
            // Classifica√ß√£o
            let classificacao = '';
            let detalhe = '';
            
            if (pontuacao >= 8) {
                classificacao = 'Alta Viabilidade';
                detalhe = 'Neg√≥cio muito promissor';
            } else if (pontuacao >= 6) {
                classificacao = 'Boa Viabilidade';
                detalhe = 'Neg√≥cio vi√°vel com bom potencial';
            } else if (pontuacao >= 4) {
                classificacao = 'Viabilidade Moderada';
                detalhe = 'Requer aten√ß√£o a alguns aspectos';
            } else {
                classificacao = 'Baixa Viabilidade';
                detalhe = 'Recomenda-se revisar o modelo';
            }
            
            document.getElementById('classificacaoViabilidade').textContent = classificacao;
            document.getElementById('detalheViabilidade').textContent = detalhe;
        }
        
        function atualizarMetasTrimestrais(faturamentos) {
            const trimestre1 = faturamentos[2] || faturamentos[faturamentos.length-1];
            const trimestre2 = faturamentos[5] || trimestre1 * 1.3;
            const trimestre3 = faturamentos[8] || trimestre2 * 1.3;
            const trimestre4 = faturamentos[11] || trimestre3 * 1.3;
            
            document.getElementById('metaTrimestre1').textContent = formatarMoeda(trimestre1) + '/m√™s';
            document.getElementById('metaTrimestre2').textContent = formatarMoeda(trimestre2) + '/m√™s';
            document.getElementById('metaTrimestre3').textContent = formatarMoeda(trimestre3) + '/m√™s';
            document.getElementById('metaTrimestre4').textContent = formatarMoeda(trimestre4) + '/m√™s';
        }
        
        // Sistema de recomenda√ß√µes e plano de a√ß√£o
        function atualizarRecomendacoes() {
            const resultados = appState.dados.resultados;
            const precificacao = appState.dados.precificacao;
            const custos = appState.dados.custos;
            const mercado = appState.dados.mercado;
            
            if (!resultados || !precificacao || !custos || !mercado) return;
            
            // Classifica√ß√£o do neg√≥cio
            const margem = resultados.margemLucro;
            let classificacao = '';
            let classificacaoCor = '';
            
            if (margem < 10) {
                classificacao = 'Em Risco';
                classificacaoCor = 'text-red-600 dark:text-red-400';
            } else if (margem < 20) {
                classificacao = 'Estabilizando';
                classificacaoCor = 'text-yellow-600 dark:text-yellow-400';
            } else if (margem < 30) {
                classificacao = 'Em Crescimento';
                classificacaoCor = 'text-green-600 dark:text-green-400';
            } else {
                classificacao = 'Consolidado';
                classificacaoCor = 'text-blue-600 dark:text-blue-400';
            }
            
            document.getElementById('classificacaoNegocio').textContent = classificacao;
            document.getElementById('classificacaoNegocio').className = `font-bold ${classificacaoCor}`;
            
            // Potencial de crescimento
            const crescimento = parseFloat(document.getElementById('taxaCrescimento').value) || 10;
            let potencial = '';
            let potencialCor = '';
            
            if (crescimento > 20) {
                potencial = 'Muito Alto';
                potencialCor = 'text-green-600 dark:text-green-400';
            } else if (crescimento > 10) {
                potencial = 'Alto';
                potencialCor = 'text-green-600 dark:text-green-400';
            } else if (crescimento > 5) {
                potencial = 'Moderado';
                potencialCor = 'text-yellow-600 dark:text-yellow-400';
            } else {
                potencial = 'Baixo';
                potencialCor = 'text-red-600 dark:text-red-400';
            }
            
            document.getElementById('potencialCrescimento').textContent = potencial;
            document.getElementById('potencialCrescimento').className = `font-bold ${potencialCor}`;
            
            // Risco do neg√≥cio
            const pontoEquilibrioPercent = (precificacao.pontoEquilibrio / custos.qtdVendaMensal) * 100;
            let risco = '';
            let riscoCor = '';
            
            if (pontoEquilibrioPercent > 80) {
                risco = 'Alto';
                riscoCor = 'text-red-600 dark:text-red-400';
            } else if (pontoEquilibrioPercent > 60) {
                risco = 'M√©dio-Alto';
                riscoCor = 'text-orange-600 dark:text-orange-400';
            } else if (pontoEquilibrioPercent > 40) {
                risco = 'M√©dio';
                riscoCor = 'text-yellow-600 dark:text-yellow-400';
            } else {
                risco = 'Baixo';
                riscoCor = 'text-green-600 dark:text-green-400';
            }
            
            document.getElementById('riscoNegocio').textContent = risco;
            document.getElementById('riscoNegocio').className = `font-bold ${riscoCor}`;
            
            // Investimento necess√°rio
            const investimento = custos.custoFixoTotal * 3;
            document.getElementById('investimentoNecessario').textContent = formatarMoeda(investimento);
            
            // Pontua√ß√£o geral
            let pontuacao = 65; // Base
            
            // Ajustar baseado em v√°rios fatores
            if (margem > 25) pontuacao += 15;
            if (margem < 15) pontuacao -= 10;
            
            if (crescimento > 15) pontuacao += 10;
            if (crescimento < 5) pontuacao -= 10;
            
            if (pontoEquilibrioPercent < 50) pontuacao += 10;
            if (pontoEquilibrioPercent > 70) pontuacao -= 10;
            
            if (mercado.posicao && mercado.posicao > 40 && mercado.posicao < 60) pontuacao += 5;
            
            pontuacao = Math.max(0, Math.min(100, pontuacao));
            
            // Atualizar c√≠rculo de progresso
            const circle = document.querySelectorAll('.progress-ring__circle')[2];
            if (circle) {
                const radius = 75;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (pontuacao / 100) * circumference;
                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                circle.style.strokeDashoffset = offset;
            }
            
            document.getElementById('pontuacaoGeral').textContent = Math.round(pontuacao);
            
            // Status do neg√≥cio
            let status = '';
            let statusCor = '';
            
            if (pontuacao >= 80) {
                status = 'Excelente';
                statusCor = 'text-green-700 dark:text-green-300';
            } else if (pontuacao >= 60) {
                status = 'Bom';
                statusCor = 'text-blue-700 dark:text-blue-300';
            } else if (pontuacao >= 40) {
                status = 'Regular';
                statusCor = 'text-yellow-700 dark:text-yellow-300';
            } else {
                status = 'Precisa de Melhorias';
                statusCor = 'text-red-700 dark:text-red-300';
            }
            
            document.getElementById('statusNegocio').textContent = status;
            document.getElementById('statusNegocio').className = `text-lg font-bold ${statusCor}`;
            
            // A√ß√µes priorit√°rias
            document.getElementById('acaoUrgente1').textContent = `‚Ä¢ Definir pre√ßo final: ${formatarMoeda(precificacao.precoComDesconto)}`;
            document.getElementById('acaoUrgente2').textContent = `‚Ä¢ Calcular ponto de equil√≠brio: ${precificacao.pontoEquilibrio} unidades`;
            document.getElementById('acaoUrgente3').textContent = `‚Ä¢ Revisar maior custo: ${document.getElementById('maiorCusto').textContent}`;
            
            document.getElementById('acaoImportante1').textContent = `‚Ä¢ Analisar concorr√™ncia: Posi√ß√£o ${mercado.posicao ? mercado.posicao.toFixed(1) + '%' : 'n√£o definida'}`;
            document.getElementById('acaoImportante2').textContent = '‚Ä¢ Diversificar canais de venda';
            document.getElementById('acaoImportante3').textContent = `‚Ä¢ Criar plano de marketing: ${formatarMoeda(parseFloat(document.getElementById('marketing').value) || 0)}/m√™s`;
            
            document.getElementById('acaoPlanejamento1').textContent = `‚Ä¢ Meta trimestral: ${formatarMoeda(resultados.faturamentoMensal * 1.3)}/m√™s`;
            document.getElementById('acaoPlanejamento2').textContent = `‚Ä¢ Fluxo de caixa: ${formatarMoeda(resultados.lucroMensal)}/m√™s`;
            document.getElementById('acaoPlanejamento3').textContent = `‚Ä¢ Investimentos: ${formatarMoeda(investimento)}`;
            
            // Check-list
            document.getElementById('checkPrecoFinal').textContent = precificacao.precoComDesconto.toFixed(2);
            document.getElementById('checkReducaoCustos').textContent = '10%';
            
            // Metas SMART
            document.getElementById('metaSmartFaturamento').textContent = formatarMoeda(resultados.faturamentoMensal * 1.3);
            document.getElementById('metaSmartFaturamentoPercent').textContent = '30';
            
            document.getElementById('metaSmartMargem').textContent = (margem + 5).toFixed(1) + '%';
            document.getElementById('metaSmartMargemPontos').textContent = '5';
            
            document.getElementById('metaSmartClientes').textContent = Math.ceil(custos.qtdVendaMensal * 1.2);
            document.getElementById('metaSmartEficiencia').textContent = '15%';
        }
        
        // Sistema de modais
        function abrirModalGrafico(tipo) {
            const modal = document.getElementById('modalGrafico');
            const titulo = document.getElementById('modalGraficoTitulo');
            const canvas = document.getElementById('modalGraficoCanvas');
            
            let tituloTexto = '';
            let graficoData = null;
            
            switch(tipo) {
                case 'composicao':
                    tituloTexto = 'Composi√ß√£o Detalhada do Pre√ßo';
                    graficoData = graficos.composicaoPreco?.data;
                    break;
                case 'custos':
                    tituloTexto = 'Distribui√ß√£o de Custos Mensais';
                    graficoData = graficos.distribuicaoCustos?.data;
                    break;
                case 'rentabilidade':
                    tituloTexto = 'An√°lise de Rentabilidade';
                    graficoData = graficos.rentabilidade?.data;
                    break;
                case 'ponto-equilibrio':
                    tituloTexto = 'An√°lise de Ponto de Equil√≠brio';
                    graficoData = graficos.pontoEquilibrio?.data;
                    break;
                case 'concorrencia':
                    tituloTexto = 'Comparativo com Concorr√™ncia';
                    graficoData = graficos.concorrencia?.data;
                    break;
                case 'projecao-faturamento':
                    tituloTexto = 'Proje√ß√£o de Faturamento';
                    graficoData = graficos.projecaoFaturamento?.data;
                    break;
                case 'projecao-lucro':
                    tituloTexto = 'Proje√ß√£o de Lucro';
                    graficoData = graficos.projecaoLucro?.data;
                    break;
                case 'comparativo-cenarios':
                    tituloTexto = 'Comparativo de Cen√°rios';
                    graficoData = graficos.comparativoCenarios?.data;
                    break;
            }
            
            if (!graficoData) {
                mostrarMensagem('Gr√°fico n√£o dispon√≠vel', 'warning');
                return;
            }
            
            titulo.textContent = tituloTexto;
            
            // Destruir gr√°fico anterior se existir
            if (modal.grafico) {
                modal.grafico.destroy();
            }
            
            // Criar novo gr√°fico no modal
            const ctx = canvas.getContext('2d');
            modal.grafico = new Chart(ctx, {
                type: graficos[tipo]?.config?.type || 'bar',
                data: graficoData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151',
                                padding: 20
                            }
                        }
                    }
                }
            });
            
            modal.style.display = 'flex';
        }
        
        function fecharModalGrafico() {
            document.getElementById('modalGrafico').style.display = 'none';
        }
        
        function abrirModalAjuda() {
            document.getElementById('modalAjuda').style.display = 'flex';
        }
        
        function fecharModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function abrirModalSobre() {
            // Implementa√ß√£o similar ao modal de ajuda
            mostrarMensagem('Funcionalidade em desenvolvimento', 'info');
        }
        
        function abrirModalDicas() {
            // Implementa√ß√£o similar ao modal de ajuda
            mostrarMensagem('Funcionalidade em desenvolvimento', 'info');
        }
        
        // Sistema de checkboxes
        function marcarTodosCheckboxes() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
            
            document.getElementById('progressoChecklist').textContent = '5';
            mostrarMensagem('Todas as tarefas marcadas como conclu√≠das!', 'success');
        }
        
        // Sistema de exporta√ß√£o
        function exportToExcel() {
            const dados = appState.dados;
            
            // Criar dados para a planilha
            const wb = XLSX.utils.book_new();
            
            // Dados b√°sicos
            const dadosBasicos = [
                ['RELAT√ìRIO COMPLETO - CALCULADORA MEI PREMIUM'],
                ['Data:', new Date().toLocaleDateString('pt-BR')],
                ['Hora:', new Date().toLocaleTimeString('pt-BR')],
                [''],
                ['üìù DADOS B√ÅSICOS'],
                ['Nome da Empresa:', document.getElementById('empresaNome').value],
                ['CNPJ/CPF:', document.getElementById('empresaCnpj').value],
                ['Setor:', document.getElementById('setorEmpresa').value],
                ['Produto/Servi√ßo:', document.getElementById('nomeProduto').value],
                ['P√∫blico-Alvo:', document.getElementById('publicoAlvo').value],
                            document.getElementById('legendaCustos').textContent = custosPercent.toFixed(1) + '%';
        }
    }
            // Atualizar legenda
            const lucroPercent = ((preco - custos.custoTotalUnitario - (preco * 0.12)) / preco) * 100;
            const custosPercent = 100 - lucroPercent;
            
            document.getElementById('legendaMargem').textContent = lucroPercent.toFixed(1) + '%';
            document.getElementById('legendaCustos').textContent = custosPercent.toFixed(1) + '%';
        }
        
        function atualizarGraficoDistribuicaoCustos() {
            const ctx = document.getElementById('graficoDistribuicaoCustos').getContext('2d');
            const custos = appState.dados.custos;
            
            if (!custos) return;
            
            if (graficos.distribuicaoCustos) {
                graficos.distribuicaoCustos.destroy();
            }
            
            // Coletar dados de custos fixos
            const aluguel = parseFloat(document.getElementById('aluguel').value) || 0;
            const salarios = parseFloat(document.getElementById('salarios').value) || 0;
            const contas = parseFloat(document.getElementById('contas').value) || 0;
            const marketing = parseFloat(document.getElementById('marketing').value) || 0;
            const das = parseFloat(document.getElementById('das').value) || 0;
            const manutencao = parseFloat(document.getElementById('manutencao').value) || 0;
            const outrosFixos = parseFloat(document.getElementById('outrosFixos').value) || 0;
            const softwareGestao = parseFloat(document.getElementById('softwareGestao').value) || 0;
            const softwareDesign = parseFloat(document.getElementById('softwareDesign').value) || 0;
            const softwareMarketing = parseFloat(document.getElementById('softwareMarketing').value) || 0;
            const softwareOutros = parseFloat(document.getElementById('softwareOutros').value) || 0;
            
            const dados = [
                { label: 'Aluguel', valor: aluguel, cor: '#3b82f6' },
                { label: 'Sal√°rios', valor: salarios, cor: '#10b981' },
                { label: 'Contas', valor: contas, cor: '#f59e0b' },
                { label: 'Marketing', valor: marketing, cor: '#8b5cf6' },
                { label: 'DAS MEI', valor: das, cor: '#ef4444' },
                { label: 'Manuten√ß√£o', valor: manutencao, cor: '#6366f1' },
                { label: 'Software', valor: softwareGestao + softwareDesign + softwareMarketing + softwareOutros, cor: '#ec4899' },
                { label: 'Outros', valor: outrosFixos, cor: '#14b8a6' }
            ];
            
            // Filtrar apenas custos com valor > 0
            const dadosFiltrados = dados.filter(d => d.valor > 0);
            
            // Encontrar maior custo
            const maiorCusto = dadosFiltrados.reduce((max, item) => item.valor > max.valor ? item : max, { valor: 0, label: '' });
            document.getElementById('maiorCusto').textContent = maiorCusto.label ? `${maiorCusto.label} (${formatarMoeda(maiorCusto.valor)})` : 'N/A';
            
            graficos.distribuicaoCustos = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dadosFiltrados.map(d => d.label),
                    datasets: [{
                        label: 'Custos Mensais (R$)',
                        data: dadosFiltrados.map(d => d.valor),
                        backgroundColor: dadosFiltrados.map(d => d.cor),
                        borderColor: dadosFiltrados.map(d => d.cor + '90'),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatarMoeda(context.raw)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                },
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarGraficoRentabilidade() {
            const ctx = document.getElementById('graficoRentabilidade').getContext('2d');
            const resultados = appState.dados.resultados;
            
            if (!resultados) return;
            
            if (graficos.rentabilidade) {
                graficos.rentabilidade.destroy();
            }
            
            const faturamento = resultados.faturamentoMensal || 0;
            const custoTotal = resultados.custoTotalMensal || 0;
            const lucro = resultados.lucroMensal || 0;
            
            // Atualizar valores no gr√°fico
            document.getElementById('rentabilidadeReceita').textContent = formatarMoeda(faturamento);
            document.getElementById('rentabilidadeCusto').textContent = formatarMoeda(custoTotal);
            document.getElementById('rentabilidadeLucro').textContent = formatarMoeda(lucro);
            
            graficos.rentabilidade = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
                    datasets: [
                        {
                            label: 'Faturamento',
                            data: Array(12).fill(0).map((_, i) => faturamento * (1 + (i * 0.05))),
                            borderColor: '#10b981',
                            backgroundColor: '#10b98120',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Custos',
                            data: Array(12).fill(0).map((_, i) => custoTotal * (1 + (i * 0.02))),
                            borderColor: '#ef4444',
                            backgroundColor: '#ef444420',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Lucro',
                            data: Array(12).fill(0).map((_, i) => lucro * (1 + (i * 0.08))),
                            borderColor: '#3b82f6',
                            backgroundColor: '#3b82f620',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                },
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarGraficoPontoEquilibrio() {
            const ctx = document.getElementById('graficoPontoEquilibrioDetalhado').getContext('2d');
            const custos = appState.dados.custos;
            const precificacao = appState.dados.precificacao;
            
            if (!custos || !precificacao) return;
            
            if (graficos.pontoEquilibrio) {
                graficos.pontoEquilibrio.destroy();
            }
            
            const custoFixo = custos.custoFixoTotal || 0;
            const custoVarUnit = custos.custoVariavelUnitario || 0;
            const precoVenda = precificacao.precoComDesconto || 0;
            const pontoEquilibrio = precificacao.pontoEquilibrio || 0;
            
            // Atualizar informa√ß√£o
            document.getElementById('pontoEquilibrioInfo').textContent = `${pontoEquilibrio} unidades`;
            
            // Gerar dados para o gr√°fico
            const unidades = Array.from({length: 20}, (_, i) => pontoEquilibrio + (i - 10) * 5).filter(v => v > 0);
            const receita = unidades.map(q => q * precoVenda);
            const custoTotal = unidades.map(q => custoFixo + (custoVarUnit * q));
            
            graficos.pontoEquilibrio = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'Receita Total',
                            data: unidades.map((q, i) => ({x: q, y: receita[i]})),
                            backgroundColor: '#10b981',
                            borderColor: '#10b981',
                            showLine: true,
                            tension: 0.4
                        },
                        {
                            label: 'Custo Total',
                            data: unidades.map((q, i) => ({x: q, y: custoTotal[i]})),
                            backgroundColor: '#ef4444',
                            borderColor: '#ef4444',
                            showLine: true,
                            tension: 0.4
                        },
                        {
                            label: 'Ponto de Equil√≠brio',
                            data: [{x: pontoEquilibrio, y: pontoEquilibrio * precoVenda}],
                            backgroundColor: '#f59e0b',
                            borderColor: '#f59e0b',
                            pointRadius: 8,
                            pointStyle: 'crossRot'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.dataset.label === 'Ponto de Equil√≠brio') {
                                        return `Ponto de Equil√≠brio: ${context.parsed.x} unidades, ${formatarMoeda(context.parsed.y)}`;
                                    }
                                    return `${context.dataset.label}: ${context.parsed.x} unidades, ${formatarMoeda(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Valor (R$)',
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                },
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Quantidade Vendida',
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarGraficoConcorrencia(precoMin, precoMedio, precoMax, precoMeu) {
            const ctx = document.getElementById('graficoConcorrencia').getContext('2d');
            
            if (graficos.concorrencia) {
                graficos.concorrencia.destroy();
            }
            
            graficos.concorrencia = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Mais Barato', 'Pre√ßo M√©dio', 'Mais Caro', 'Seu Pre√ßo'],
                    datasets: [{
                        label: 'Pre√ßo (R$)',
                        data: [precoMin || 45, precoMedio || 62, precoMax || 85, precoMeu || 65],
                        backgroundColor: [
                            '#10b981',
                            '#3b82f6',
                            '#ef4444',
                            '#8b5cf6'
                        ],
                        borderColor: [
                            '#10b98190',
                            '#3b82f690',
                            '#ef444490',
                            '#8b5cf690'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${formatarMoeda(context.raw)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                },
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarGraficoEvolucaoResultados() {
            const ctx = document.getElementById('graficoEvolucaoResultados').getContext('2d');
            const resultados = appState.dados.resultados;
            
            if (!resultados) return;
            
            if (graficos.evolucaoResultados) {
                graficos.evolucaoResultados.destroy();
            }
            
            const faturamentoAtual = resultados.faturamentoMensal || 0;
            const crescimento = parseFloat(document.getElementById('taxaCrescimentoProjecao').value) || 5;
            
            // Calcular previs√£o para 6 meses
            const previsao6Meses = faturamentoAtual * Math.pow(1 + crescimento/100, 6);
            document.getElementById('previsao6Meses').textContent = formatarMoeda(previsao6Meses);
            document.getElementById('crescimentoMensal').textContent = crescimento.toFixed(1) + '%';
            
            // Gerar dados hist√≥ricos (√∫ltimos 6 meses) e proje√ß√£o (pr√≥ximos 6 meses)
            const meses = ['5 meses atr√°s', '4 meses atr√°s', '3 meses atr√°s', '2 meses atr√°s', 'M√™s passado', 'Este m√™s', 'Pr√≥ximo m√™s', '+2 meses', '+3 meses', '+4 meses', '+5 meses', '+6 meses'];
            const dados = meses.map((_, i) => {
                if (i < 6) {
                    // Hist√≥rico (crescente at√© o valor atual)
                    return faturamentoAtual * (0.7 + (i * 0.06));
                } else {
                    // Proje√ß√£o
                    return faturamentoAtual * Math.pow(1 + crescimento/100, i - 5);
                }
            });
            
            graficos.evolucaoResultados = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: meses,
                    datasets: [{
                        label: 'Faturamento (R$)',
                        data: dados,
                        borderColor: '#8b5cf6',
                        backgroundColor: '#8b5cf620',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: function(context) {
                            return context.dataIndex === 5 ? '#f59e0b' : '#8b5cf6';
                        },
                        pointRadius: function(context) {
                            return context.dataIndex === 5 ? 6 : 3;
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            }
                        },
                        annotation: {
                            annotations: {
                                linhaAtual: {
                                    type: 'line',
                                    xMin: 5.5,
                                    xMax: 5.5,
                                    borderColor: '#f59e0b',
                                    borderWidth: 2,
                                    borderDash: [5, 5],
                                    label: {
                                        display: true,
                                        content: 'Hoje',
                                        position: 'start',
                                        backgroundColor: '#f59e0b',
                                        color: 'white'
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                },
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarGraficosResultados() {
            // Gr√°fico de distribui√ß√£o de resultados
            const ctx1 = document.getElementById('graficoDistribuicaoResultados').getContext('2d');
            const resultados = appState.dados.resultados;
            
            if (graficos.distribuicaoResultados) {
                graficos.distribuicaoResultados.destroy();
            }
            
            if (resultados) {
                const faturamento = resultados.faturamentoMensal || 0;
                const custos = resultados.custoTotalMensal || 0;
                const lucro = resultados.lucroMensal || 0;
                
                graficos.distribuicaoResultados = new Chart(ctx1, {
                    type: 'doughnut',
                    data: {
                        labels: ['Custos', 'Lucro'],
                        datasets: [{
                            data: [custos, lucro],
                            backgroundColor: ['#ef4444', '#10b981'],
                            borderWidth: 2,
                            borderColor: document.body.classList.contains('dark-mode') ? '#1f2937' : '#ffffff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.raw || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = Math.round((value / total) * 100);
                                        return `${label}: ${formatarMoeda(value)} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // Gr√°fico de evolu√ß√£o do lucro
            const ctx2 = document.getElementById('graficoEvolucaoLucro').getContext('2d');
            
            if (graficos.evolucaoLucro) {
                graficos.evolucaoLucro.destroy();
            }
            
            if (resultados) {
                const lucroAtual = resultados.lucroMensal || 0;
                const crescimento = parseFloat(document.getElementById('taxaCrescimentoProjecao').value) || 5;
                
                const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                const dados = meses.map((_, i) => {
                    return lucroAtual * Math.pow(1 + crescimento/100, i);
                });
                
                graficos.evolucaoLucro = new Chart(ctx2, {
                    type: 'line',
                    data: {
                        labels: meses,
                        datasets: [{
                            label: 'Lucro Mensal (R$)',
                            data: dados,
                            borderColor: '#10b981',
                            backgroundColor: '#10b98120',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                                }
                            }
                        },
                        scales: {
                            y: {
                                ticks: {
                                    callback: function(value) {
                                        return 'R$ ' + value.toLocaleString('pt-BR');
                                    },
                                    color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                                },
                                grid: {
                                    color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                                }
                            },
                            x: {
                                ticks: {
                                    color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                                },
                                grid: {
                                    color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                                }
                            }
                        }
                    }
                });
            }
        }
        
        function atualizarGraficoDashboard() {
            const ctx = document.getElementById('dashGraficoResumo').getContext('2d');
            const resultados = appState.dados.resultados;
            
            if (!resultados) return;
            
            if (graficos.dashboard) {
                graficos.dashboard.destroy();
            }
            
            const meses = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'];
            const faturamentoData = meses.map((_, i) => resultados.faturamentoMensal * (0.8 + (i * 0.08)));
            const lucroData = meses.map((_, i) => resultados.lucroMensal * (0.8 + (i * 0.08)));
            
            graficos.dashboard = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: meses,
                    datasets: [
                        {
                            label: 'Faturamento',
                            data: faturamentoData,
                            backgroundColor: '#3b82f6',
                            borderColor: '#3b82f6',
                            borderWidth: 1
                        },
                        {
                            label: 'Lucro',
                            data: lucroData,
                            backgroundColor: '#10b981',
                            borderColor: '#10b981',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                },
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
        
        // Sistema de proje√ß√µes
        function atualizarProjecoes() {
            const resultados = appState.dados.resultados;
            if (!resultados) return;
            
            const horizonte = parseInt(document.getElementById('horizonteProjecao').value) || 12;
            const cenario = document.getElementById('cenarioBase').value;
            const taxaCrescimento = parseFloat(document.getElementById('taxaCrescimentoProjecao').value) || 5;
            
            // Fatores adicionais
            const fatorInvestimento = document.getElementById('fatorInvestimento').checked;
            const fatorContratacao = document.getElementById('fatorContratacao').checked;
            const fatorExpansao = document.getElementById('fatorExpansao').checked;
            const fatorCrises = document.getElementById('fatorCrises').checked;
            
            // Ajustar taxa conforme cen√°rio
            let taxaAjustada = taxaCrescimento;
            switch(cenario) {
                case 'otimista': taxaAjustada *= 1.5; break;
                case 'pessimista': taxaAjustada *= 0.5; break;
            }
            
            // Ajustar por fatores
            if (fatorInvestimento) taxaAjustada *= 0.8; // Investimento reduz crescimento inicial
            if (fatorContratacao) taxaAjustada *= 1.2; // Contrata√ß√£o aumenta capacidade
            if (fatorExpansao) taxaAjustada *= 1.3; // Expans√£o acelera crescimento
            if (fatorCrises) taxaAjustada *= 0.7; // Crises reduzem crescimento
            
            // Gerar proje√ß√µes
            const meses = Array.from({length: horizonte}, (_, i) => i + 1);
            const projecaoFaturamento = meses.map(mes => 
                resultados.faturamentoMensal * Math.pow(1 + taxaAjustada/100, mes - 1)
            );
            
            // Considerar que o lucro cresce um pouco mais r√°pido que o faturamento (ganhos de escala)
            const projecaoLucro = meses.map(mes => 
                resultados.lucroMensal * Math.pow(1 + (taxaAjustada * 1.1)/100, mes - 1)
            );
            
            // Atualizar gr√°ficos de proje√ß√£o
            atualizarGraficoProjecaoFaturamento(meses, projecaoFaturamento);
            atualizarGraficoProjecaoLucro(meses, projecaoLucro);
            
            // Atualizar comparativo de cen√°rios
            atualizarComparativoCenarios(resultados.faturamentoMensal, horizonte, taxaCrescimento);
            
            // Atualizar an√°lise de viabilidade
            atualizarAnaliseViabilidade(resultados, projecaoLucro[projecaoLucro.length - 1], horizonte);
            
            // Atualizar plano de crescimento
            atualizarPlanoCrescimento(resultados.faturamentoMensal, taxaAjustada);
            
            // Atualizar valores nos cards
            document.getElementById('projecaoInicio').textContent = formatarMoeda(projecaoFaturamento[0]);
            document.getElementById('projecaoMeio').textContent = formatarMoeda(projecaoFaturamento[Math.floor(horizonte/2)]);
            document.getElementById('projecaoFim').textContent = formatarMoeda(projecaoFaturamento[horizonte-1]);
            
            document.getElementById('lucroProjecaoInicio').textContent = formatarMoeda(projecaoLucro[0]);
            document.getElementById('lucroProjecaoMeio').textContent = formatarMoeda(projecaoLucro[Math.floor(horizonte/2)]);
            document.getElementById('lucroProjecaoFim').textContent = formatarMoeda(projecaoLucro[horizonte-1]);
            
            // Atualizar metas SMART
            atualizarMetasSMART(resultados.faturamentoMensal, resultados.margemLucro, taxaAjustada);
        }
        
        function atualizarGraficoProjecaoFaturamento(meses, dados) {
            const ctx = document.getElementById('graficoProjecaoFaturamento').getContext('2d');
            
            if (graficos.projecaoFaturamento) {
                graficos.projecaoFaturamento.destroy();
            }
            
            const labels = meses.map(m => `M√™s ${m}`);
            
            graficos.projecaoFaturamento = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Faturamento Projetado (R$)',
                        data: dados,
                        borderColor: '#3b82f6',
                        backgroundColor: '#3b82f620',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                },
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarGraficoProjecaoLucro(meses, dados) {
            const ctx = document.getElementById('graficoProjecaoLucro').getContext('2d');
            
            if (graficos.projecaoLucro) {
                graficos.projecaoLucro.destroy();
            }
            
            const labels = meses.map(m => `M√™s ${m}`);
            
            graficos.projecaoLucro = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Lucro Projetado (R$)',
                        data: dados,
                        borderColor: '#10b981',
                        backgroundColor: '#10b98120',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                },
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarComparativoCenarios(faturamentoAtual, horizonte, taxaBase) {
            const ctx = document.getElementById('graficoComparativoCenarios').getContext('2d');
            
            if (graficos.comparativoCenarios) {
                graficos.comparativoCenarios.destroy();
            }
            
            const meses = Array.from({length: horizonte}, (_, i) => i + 1);
            
            // Gerar dados para os tr√™s cen√°rios
            const pessimista = meses.map(m => faturamentoAtual * Math.pow(1 + (taxaBase * 0.5)/100, m - 1));
            const realista = meses.map(m => faturamentoAtual * Math.pow(1 + taxaBase/100, m - 1));
            const otimista = meses.map(m => faturamentoAtual * Math.pow(1 + (taxaBase * 1.5)/100, m - 1));
            
            // Atualizar valores finais
            document.getElementById('cenarioPessimistaValor').textContent = formatarMoeda(pessimista[horizonte-1]);
            document.getElementById('cenarioRealistaValor').textContent = formatarMoeda(realista[horizonte-1]);
            document.getElementById('cenarioOtimistaValor').textContent = formatarMoeda(otimista[horizonte-1]);
            
            const labels = meses.map(m => `M√™s ${m}`);
            
            graficos.comparativoCenarios = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Cen√°rio Pessimista',
                            data: pessimista,
                            borderColor: '#ef4444',
                            backgroundColor: '#ef444420',
                            tension: 0.4,
                            borderDash: [5, 5]
                        },
                        {
                            label: 'Cen√°rio Realista',
                            data: realista,
                            borderColor: '#3b82f6',
                            backgroundColor: '#3b82f620',
                            tension: 0.4,
                            borderWidth: 3
                        },
                        {
                            label: 'Cen√°rio Otimista',
                            data: otimista,
                            borderColor: '#10b981',
                            backgroundColor: '#10b98120',
                            tension: 0.4,
                            borderDash: [5, 5]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value.toLocaleString('pt-BR');
                                },
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-mode') ? '#e5e7eb' : '#374151'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-mode') ? '#374151' : '#e5e7eb'
                            }
                        }
                    }
                }
            });
        }
        
        function atualizarAnaliseViabilidade(resultados, lucroFinal, horizonte) {
            const investimentoInicial = resultados.custoTotalMensal * 3;
            const lucroTotal = resultados.lucroMensal * horizonte;
            
            // Calcular indicadores
            const roi = investimentoInicial > 0 ? (lucroTotal / investimentoInicial) * 100 : 0;
            const payback = investimentoInicial > 0 ? Math.ceil(investimentoInicial / resultados.lucroMensal) : 0;
            const vpl = lucroTotal - investimentoInicial;
            const tir = (roi / horizonte) * 12; // Taxa anual aproximada
            
            // Atualizar elementos
            document.getElementById('viabilidadeROI').textContent = roi.toFixed(1) + '%';
            document.getElementById('viabilidadePayback').textContent = payback + ' meses';
            document.getElementById('viabilidadeVPL').textContent = formatarMoeda(vpl);
            document.getElementById('viabilidadeTIR').textContent = tir.toFixed(1) + '%';
            
            // Calcular pontua√ß√£o de viabilidade (0-10)
            let pontuacao = 0;
            
            // ROI (m√°ximo 3 pontos)
            pontuacao += Math.min(roi / 20, 3);
            
            // Payback (m√°ximo 3 pontos)
            if (payback <= 12) pontuacao += 3;
            else if (payback <= 24) pontuacao += 2;
            else if (payback <= 36) pontuacao += 1;
            
            // VPL positivo (2 pontos)
            if (vpl > 0) pontuacao += 2;
            
            // Margem de lucro (m√°ximo 2 pontos)
            if (resultados.margemLucro >= 30) pontuacao += 2;
            else if (resultados.margemLucro >= 20) pontuacao += 1.5;
            else if (resultados.margemLucro >= 10) pontuacao += 1;
            else if (resultados.margemLucro >= 5) pontuacao += 0.5;
            
            pontuacao = Math.min(pontuacao, 10);
            
            // Atualizar c√≠rculo de progresso
            document.getElementById('pontuacaoViabilidade').textContent = pontuacao.toFixed(1);
            const circle = document.querySelector('#viabilidade .progress-ring__circle');
            if (circle) {
                const radius = 90;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (pontuacao / 10) * circumference;
                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                circle.style.strokeDashoffset = offset;
            }
            
            // Classifica√ß√£o
            let classificacao = '';
            let detalhe = '';
            let cor = '';
            
            if (pontuacao >= 8) {
                classificacao = 'Alta Viabilidade';
                detalhe = 'Neg√≥cio muito promissor!';
                cor = 'text-green-700 dark:text-green-300';
            } else if (pontuacao >= 6) {
                classificacao = 'Boa Viabilidade';
                detalhe = 'Neg√≥cio com bom potencial';
                cor = 'text-blue-700 dark:text-blue-300';
            } else if (pontuacao >= 4) {
                classificacao = 'Viabilidade Moderada';
                detalhe = 'Recomenda-se alguns ajustes';
                cor = 'text-yellow-700 dark:text-yellow-300';
            } else {
                classificacao = 'Baixa Viabilidade';
                detalhe = 'Recomenda-se revisar o modelo';
                cor = 'text-red-700 dark:text-red-300';
            }
            
            document.getElementById('classificacaoViabilidade').textContent = classificacao;
            document.getElementById('classificacaoViabilidade').className = `text-lg font-bold ${cor}`;
            document.getElementById('detalheViabilidade').textContent = detalhe;
        }
        
        function atualizarPlanoCrescimento(faturamentoAtual, taxaCrescimento) {
            // Calcular metas trimestrais
            const metaTrimestre1 = faturamentoAtual;
            const metaTrimestre2 = faturamentoAtual * Math.pow(1 + taxaCrescimento/100, 3);
            const metaTrimestre3 = faturamentoAtual * Math.pow(1 + taxaCrescimento/100, 6);
            const metaTrimestre4 = faturamentoAtual * Math.pow(1 + taxaCrescimento/100, 9);
            
            // Atualizar elementos
            document.getElementById('metaTrimestre1').textContent = formatarMoeda(metaTrimestre1) + '/m√™s';
            document.getElementById('metaTrimestre2').textContent = formatarMoeda(metaTrimestre2) + '/m√™s';
            document.getElementById('metaTrimestre3').textContent = formatarMoeda(metaTrimestre3) + '/m√™s';
            document.getElementById('metaTrimestre4').textContent = formatarMoeda(metaTrimestre4) + '/m√™s';
        }
        
        function atualizarMetasSMART(faturamentoAtual, margemAtual, taxaCrescimento) {
            // Meta de faturamento (90 dias)
            const metaFaturamento = faturamentoAtual * Math.pow(1 + taxaCrescimento/100, 3);
            const aumentoFaturamento = ((metaFaturamento - faturamentoAtual) / faturamentoAtual) * 100;
            
            document.getElementById('metaSmartFaturamento').textContent = formatarMoeda(metaFaturamento) + '/m√™s';
            document.getElementById('metaSmartFaturamentoPercent').textContent = aumentoFaturamento.toFixed(1) + '%';
            
            // Meta de margem (aumentar 2 pontos percentuais em 90 dias)
            const metaMargem = Math.min(margemAtual + 2, 40);
            document.getElementById('metaSmartMargem').textContent = metaMargem.toFixed(1) + '%';
            document.getElementById('metaSmartMargemPontos').textContent = '2';
            
            // Meta de clientes (baseado no setor)
            const setor = document.getElementById('setorEmpresa').value;
            let metaClientes = 10; // padr√£o
            
            if (setor === 'alimentacao') metaClientes = 50;
            else if (setor === 'moda') metaClientes = 20;
            else if (setor === 'servicos') metaClientes = 8;
            else if (setor === 'tecnologia') metaClientes = 5;
            else if (setor === 'artesanato') metaClientes = 15;
            
            document.getElementById('metaSmartClientes').textContent = metaClientes;
            
            // Meta de efici√™ncia (reduzir custos em 5%)
            document.getElementById('metaSmartEficiencia').textContent = '5%';
            
            // Atualizar check-list
            const precificacao = appState.dados.precificacao;
            if (precificacao) {
                document.getElementById('checkPrecoFinal').textContent = formatarMoeda(precificacao.precoComDesconto || 0);
            }
            
            // Sugest√£o de redu√ß√£o de custos baseada na an√°lise
            const custos = appState.dados.custos;
            if (custos) {
                const reducaoSugerida = Math.min(15, custos.custoFixoTotal * 0.15);
                document.getElementById('checkReducaoCustos').textContent = '10-15%';
            }
        }
        
        // Utilit√°rios
        function formatarMoeda(valor) {
            return 'R$ ' + parseFloat(valor || 0).toLocaleString('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }
        
        function formatarData(data) {
            return data.toLocaleDateString('pt-BR');
        }
        
        function mostrarMensagem(texto, tipo = 'info') {
            // Criar elemento de mensagem
            const mensagem = document.createElement('div');
            mensagem.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-xl shadow-lg ${
                tipo === 'success' ? 'bg-green-500 text-white' :
                tipo === 'error' ? 'bg-red-500 text-white' :
                tipo === 'warning' ? 'bg-yellow-500 text-gray-800' :
                'bg-blue-500 text-white'
            }`;
            mensagem.innerHTML = `
                <div class="flex items-center gap-3">
                    <i class="fas fa-${
                        tipo === 'success' ? 'check-circle' :
                        tipo === 'error' ? 'exclamation-circle' :
                        tipo === 'warning' ? 'exclamation-triangle' :
                        'info-circle'
                    }"></i>
                    <span>${texto}</span>
                </div>
            `;
            
            document.body.appendChild(mensagem);
            
            // Remover ap√≥s 5 segundos
            setTimeout(() => {
                mensagem.remove();
            }, 5000);
        }
        
        function carregarDadosSalvos() {
            try {
                const dadosSalvos = localStorage.getItem('calculadoraMEI_dados');
                if (dadosSalvos) {
                    const dados = JSON.parse(dadosSalvos);
                    
                    // Carregar dados b√°sicos
                    Object.keys(dados).forEach(key => {
                        const element = document.getElementById(key);
                        if (element && dados[key] !== undefined && dados[key] !== null) {
                            if (element.type === 'checkbox') {
                                element.checked = dados[key];
                            } else {
                                element.value = dados[key];
                            }
                        }
                    });
                    
                    // Disparar eventos para recalcular
                    setTimeout(() => {
                        calcularCustos();
                        atualizarPrecificacao();
                        calcularResultados();
                        mostrarMensagem('Dados carregados com sucesso!', 'success');
                    }, 100);
                }
            } catch (e) {
                console.error('Erro ao carregar dados salvos:', e);
            }
        }
        
        function saveProgress() {
            try {
                // Coletar todos os dados do formul√°rio
                const dados = {};
                
                // Dados b√°sicos
                const inputs = document.querySelectorAll('input, select, textarea');
                inputs.forEach(input => {
                    if (input.id) {
                        if (input.type === 'checkbox' || input.type === 'radio') {
                            dados[input.id] = input.checked;
                        } else {
                            dados[input.id] = input.value;
                        }
                    }
                });
                
                // Salvar no localStorage
                localStorage.setItem('calculadoraMEI_dados', JSON.stringify(dados));
                
                mostrarMensagem('Progresso salvo com sucesso!', 'success');
            } catch (e) {
                console.error('Erro ao salvar progresso:', e);
                mostrarMensagem('Erro ao salvar progresso', 'error');
            }
        }
        
        function calcularTudo() {
            // Calcular custos
            calcularCustos();
            
            // Atualizar precifica√ß√£o
            atualizarPrecificacao();
            
            // Calcular resultados
            calcularResultados();
            
            // Atualizar an√°lise de mercado
            analisarConcorrencia();
            atualizarAnaliseMercado();
            
            // Atualizar proje√ß√µes
            atualizarProjecoes();
            
            // Atualizar gr√°ficos
            atualizarGraficos();
            
            mostrarMensagem('Todos os c√°lculos foram atualizados!', 'success');
        }
        
        // Fun√ß√µes de exporta√ß√£o
        function exportToExcel() {
            try {
                const dados = [];
                
                // Cabe√ßalhos
                dados.push(['Calculadora MEI Premium - Relat√≥rio Financeiro']);
                dados.push(['Gerado em:', new Date().toLocaleDateString('pt-BR')]);
                dados.push([]);
                
                // Dados do neg√≥cio
                dados.push(['DADOS DO NEG√ìCIO']);
                dados.push(['Empresa:', document.getElementById('empresaNome').value]);
                dados.push(['Setor:', document.getElementById('setorEmpresa').value]);
                dados.push(['Produto:', document.getElementById('nomeProduto').value]);
                dados.push(['Quantidade mensal esperada:', document.getElementById('qtdVendaMensal').value]);
                dados.push([]);
                
                // Custos
                dados.push(['CUSTOS']);
                const custos = appState.dados.custos;
                if (custos) {
                    dados.push(['Custo vari√°vel unit√°rio:', formatarMoeda(custos.custoVariavelUnitario)]);
                    dados.push(['Custos fixos mensais:', formatarMoeda(custos.custoFixoTotal)]);
                    dados.push(['Custo total unit√°rio:', formatarMoeda(custos.custoTotalUnitario)]);
                }
                dados.push([]);
                
                // Precifica√ß√£o
                dados.push(['PRECIFICA√á√ÉO']);
                const precificacao = appState.dados.precificacao;
                if (precificacao) {
                    dados.push(['Pre√ßo de venda:', formatarMoeda(precificacao.precoVenda)]);
                    dados.push(['Desconto:', precificacao.desconto + '%']);
                    dados.push(['Pre√ßo final:', formatarMoeda(precificacao.precoComDesconto)]);
                    dados.push(['Lucro unit√°rio:', formatarMoeda(precificacao.lucroUnitario)]);
                    dados.push(['Margem de lucro:', precificacao.margemLucro.toFixed(1) + '%']);
                    dados.push(['Ponto de equil√≠brio:', precificacao.pontoEquilibrio + ' unidades']);
                }
                dados.push([]);
                
                // Resultados
                dados.push(['RESULTADOS FINANCEIROS']);
                const resultados = appState.dados.resultados;
                if (resultados) {
                    dados.push(['Faturamento mensal:', formatarMoeda(resultados.faturamentoMensal)]);
                    dados.push(['Lucro mensal:', formatarMoeda(resultados.lucroMensal)]);
                    dados.push(['Margem de lucro:', resultados.margemLucro.toFixed(1) + '%']);
                    dados.push(['ROI:', resultados.roi.toFixed(1) + '%']);
                    dados.push(['Payback:', resultados.payback + ' meses']);
                    dados.push(['Lucro anual projetado:', formatarMoeda(resultados.lucroAnual)]);
                }
                
                // Criar planilha
                const ws = XLSX.utils.aoa_to_sheet(dados);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Relat√≥rio MEI');
                
                // Gerar nome do arquivo
                const nomeEmpresa = document.getElementById('empresaNome').value || 'MEI';
                const nomeArquivo = `Relatorio_${nomeEmpresa.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.xlsx`;
                
                // Exportar
                XLSX.writeFile(wb, nomeArquivo);
                
                mostrarMensagem('Relat√≥rio exportado para Excel com sucesso!', 'success');
            } catch (e) {
                console.error('Erro ao exportar para Excel:', e);
                mostrarMensagem('Erro ao exportar para Excel', 'error');
            }
        }
        
        function generatePDF() {
            try {
                // Elemento para capturar
                const element = document.getElementById('recomendacoes');
                
                // Configura√ß√µes
                const opt = {
                    margin: [10, 10, 10, 10],
                    filename: `Relatorio_MEI_${new Date().toISOString().split('T')[0]}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { 
                        scale: 2,
                        useCORS: true,
                        logging: false
                    },
                    jsPDF: { 
                        unit: 'mm', 
                        format: 'a4', 
                        orientation: 'portrait' 
                    }
                };
                
                // Gerar PDF
                html2pdf().set(opt).from(element).save();
                
                mostrarMensagem('PDF gerado com sucesso!', 'success');
            } catch (e) {
                console.error('Erro ao gerar PDF:', e);
                mostrarMensagem('Erro ao gerar PDF', 'error');
            }
        }
        
        // Fun√ß√µes de modal
        function abrirModalGrafico(tipo) {
            const modal = document.getElementById('modalGrafico');
            const canvas = document.getElementById('modalGraficoCanvas');
            const titulo = document.getElementById('modalGraficoTitulo');
            
            // Configurar t√≠tulo
            const titulos = {
                'composicao': 'Composi√ß√£o Detalhada do Pre√ßo',
                'custos': 'Distribui√ß√£o de Custos',
                'rentabilidade': 'An√°lise de Rentabilidade',
                'ponto-equilibrio': 'Ponto de Equil√≠brio',
                'concorrencia': 'Comparativo com Concorr√™ncia',
                'evolucao': 'Evolu√ß√£o de Resultados',
                'projecao-faturamento': 'Proje√ß√£o de Faturamento',
                'projecao-lucro': 'Proje√ß√£o de Lucro',
                'comparativo-cenarios': 'Comparativo de Cen√°rios'
            };
            
            titulo.textContent = titulos[tipo] || 'Gr√°fico Detalhado';
            
            // Mostrar modal
            modal.style.display = 'flex';
            
            // Criar gr√°fico no modal
            setTimeout(() => {
                const ctx = canvas.getContext('2d');
                
                // Destruir gr√°fico anterior se existir
                if (graficos.modal) {
                    graficos.modal.destroy();
                }
                
                // Criar c√≥pia do gr√°fico existente
                const originalChart = graficos[tipo === 'composicao' ? 'composicaoPreco' : 
                                               tipo === 'custos' ? 'distribuicaoCustos' :
                                               tipo === 'rentabilidade' ? 'rentabilidade' :
                                               tipo === 'ponto-equilibrio' ? 'pontoEquilibrio' :
                                               tipo === 'concorrencia' ? 'concorrencia' :
                                               tipo === 'evolucao' ? 'evolucaoResultados' :
                                               tipo === 'projecao-faturamento' ? 'projecaoFaturamento' :
                                               tipo === 'projecao-lucro' ? 'projecaoLucro' :
                                               tipo === 'comparativo-cenarios' ? 'comparativoCenarios' : null];
                
                if (originalChart) {
                    // Criar novo gr√°fico com os mesmos dados
                    graficos.modal = new Chart(ctx, {
                        type: originalChart.config.type,
                        data: JSON.parse(JSON.stringify(originalChart.config.data)),
                        options: {
                            ...originalChart.config.options,
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                ...originalChart.config.options.plugins,
                                legend: {
                                    ...originalChart.config.options.plugins?.legend,
                                    position: 'bottom',
                                    labels: {
                                        ...originalChart.config.options.plugins?.legend?.labels,
                                        font: {
                                            size: 14
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
            }, 100);
        }
        
        function fecharModalGrafico() {
            document.getElementById('modalGrafico').style.display = 'none';
            
            // Destruir gr√°fico do modal
            if (graficos.modal) {
                graficos.modal.destroy();
                graficos.modal = null;
            }
        }
        
        function abrirModalAjuda() {
            document.getElementById('modalAjuda').style.display = 'flex';
        }
        
        function fecharModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        function abrirModalSobre() {
            // Criar modal sobre
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.id = 'modalSobre';
            modal.innerHTML = `
                <div class="modal-content max-w-3xl">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-gray-800 dark:text-white">üì± Sobre a Calculadora MEI Premium</h3>
                            <button onclick="fecharModal('modalSobre')" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                <i class="fas fa-times text-2xl"></i>
                            </button>
                        </div>
                        
                        <div class="space-y-6">
                            <div>
                                <h4 class="font-bold text-lg mb-3 text-blue-600 dark:text-blue-400">üéØ Objetivo</h4>
                                <p class="text-gray-700 dark:text-gray-300">
                                    Esta ferramenta foi desenvolvida para ajudar microempreendedores individuais (MEI) a precificar 
                                    seus produtos e servi√ßos de forma correta, garantindo a sustentabilidade e crescimento do neg√≥cio.
                                </p>
                            </div>
                            
                            <div>
                                <h4 class="font-bold text-lg mb-3 text-green-600 dark:text-green-400">‚ú® Funcionalidades Principais</h4>
                                <ul class="space-y-2 text-gray-700 dark:text-gray-300">
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-check text-green-500 mt-1"></i>
                                        <span><strong>An√°lise completa de custos:</strong> Mapeamento de todos os gastos fixos e vari√°veis</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-check text-green-500 mt-1"></i>
                                        <span><strong>5 m√©todos de precifica√ß√£o:</strong> Markup, margem de lucro, pre√ßo de mercado, valor percebido e pre√ßo psicol√≥gico</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-check text-green-500 mt-1"></i>
                                        <span><strong>An√°lise de concorr√™ncia:</strong> Compara√ß√£o com os pre√ßos do mercado</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-check text-green-500 mt-1"></i>
                                        <span><strong>Proje√ß√µes futuras:</strong> Simula√ß√£o de diferentes cen√°rios para os pr√≥ximos 6-24 meses</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-check text-green-500 mt-1"></i>
                                        <span><strong>Plano de a√ß√£o personalizado:</strong> Recomenda√ß√µes espec√≠ficas baseadas na an√°lise do seu neg√≥cio</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-bold text-lg mb-3 text-purple-600 dark:text-purple-400">üõ°Ô∏è Seguran√ßa dos Dados</h4>
                                <p class="text-gray-700 dark:text-gray-300">
                                    <strong>Todos os c√°lculos s√£o feitos localmente no seu navegador.</strong> 
                                    Nenhum dado √© enviado para servidores externos. Voc√™ pode salvar seu progresso 
                                    localmente ou exportar para PDF/Excel.
                                </p>
                            </div>
                            
                            <div>
                                <h4 class="font-bold text-lg mb-3 text-orange-600 dark:text-orange-400">üìû Suporte</h4>
                                <p class="text-gray-700 dark:text-gray-300">
                                    Esta √© uma ferramenta gratuita desenvolvida para a comunidade de microempreendedores.
                                    Para sugest√µes ou reportar problemas, entre em contato atrav√©s do GitHub do projeto.
                                </p>
                            </div>
                        </div>
                        
                        <div class="mt-8 flex justify-end">
                            <button onclick="fecharModal('modalSobre')" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium">
                                Fechar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }
        
        function abrirModalDicas() {
            // Criar modal de dicas
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.id = 'modalDicas';
            modal.innerHTML = `
                <div class="modal-content max-w-3xl">
                    <div class="p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-gray-800 dark:text-white">üí° Dicas Essenciais para MEI</h3>
                            <button onclick="fecharModal('modalDicas')" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                                <i class="fas fa-times text-2xl"></i>
                            </button>
                        </div>
                        
                        <div class="space-y-6">
                            <div>
                                <h4 class="font-bold text-lg mb-3 text-blue-600 dark:text-blue-400">üí∞ Gest√£o Financeira</h4>
                                <ul class="space-y-2 text-gray-700 dark:text-gray-300">
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-piggy-bank text-blue-500 mt-1"></i>
                                        <span><strong>Separe as finan√ßas pessoais das empresariais:</strong> Tenha uma conta banc√°ria exclusiva para o neg√≥cio</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-calendar-alt text-blue-500 mt-1"></i>
                                        <span><strong>Pague o DAS em dia:</strong> O imposto do MEI deve ser pago todo m√™s, mesmo sem faturamento</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-chart-line text-blue-500 mt-1"></i>
                                        <span><strong>Monitore seu fluxo de caixa:</strong> Anote todas as entradas e sa√≠das diariamente</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-bold text-lg mb-3 text-green-600 dark:text-green-400">üéØ Precifica√ß√£o Correta</h4>
                                <ul class="space-y-2 text-gray-700 dark:text-gray-300">
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-calculator text-green-500 mt-1"></i>
                                        <span><strong>Nunca ignore os custos fixos:</strong> Eles devem estar inclu√≠dos no pre√ßo de cada produto</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-search-dollar text-green-500 mt-1"></i>
                                        <span><strong>Pesquise a concorr√™ncia:</strong> Entenda o mercado antes de definir seus pre√ßos</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-medal text-green-500 mt-1"></i>
                                        <span><strong>Valorize seu trabalho:</strong> N√£o se subestime apenas para ser mais barato</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-bold text-lg mb-3 text-purple-600 dark:text-purple-400">üìù Formaliza√ß√£o</h4>
                                <ul class="space-y-2 text-gray-700 dark:text-gray-300">
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-file-invoice-dollar text-purple-500 mt-1"></i>
                                        <span><strong>Emita nota fiscal sempre:</strong> √â obrigat√≥rio e comprova a legalidade do seu neg√≥cio</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-user-tie text-purple-500 mt-1"></i>
                                        <span><strong>Contrate um contador:</strong> Mesmo como MEI, um profissional ajuda a evitar problemas</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-balance-scale text-purple-500 mt-1"></i>
                                        <span><strong>Respeite o limite do MEI:</strong> Faturamento m√°ximo de R$ 81.000/ano (2024)</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 class="font-bold text-lg mb-3 text-orange-600 dark:text-orange-400">üöÄ Crescimento</h4>
                                <ul class="space-y-2 text-gray-700 dark:text-gray-300">
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-bullseye text-orange-500 mt-1"></i>
                                        <span><strong>Defina metas realistas:</strong> Comece pequeno e cres√ßa gradualmente</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-users text-orange-500 mt-1"></i>
                                        <span><strong>Invista em relacionamento:</strong> Clientes satisfeitos s√£o a melhor propaganda</span>
                                    </li>
                                    <li class="flex items-start gap-2">
                                        <i class="fas fa-sync-alt text-orange-500 mt-1"></i>
                                        <span><strong>Reavalie regularmente:</strong> Use esta calculadora todo m√™s para ajustar estrat√©gias</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="mt-8 flex justify-end">
                            <button onclick="fecharModal('modalDicas')" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium">
                                Fechar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }
        
        // Outras fun√ß√µes √∫teis
        function reiniciarCalculadora() {
            if (confirm('Tem certeza que deseja reiniciar a calculadora? Todos os dados n√£o salvos ser√£o perdidos.')) {
                localStorage.removeItem('calculadoraMEI_dados');
                location.reload();
            }
        }
        
        function agendarRevisao() {
            const data = new Date();
            data.setMonth(data.getMonth() + 1);
            
            alert(`Revis√£o agendada para: ${formatarData(data)}\n\nAdicione este compromisso √† sua agenda para acompanhar a evolu√ß√£o do seu neg√≥cio.`);
            
            // Atualizar data na interface
            document.getElementById('dataProximaRevisao').textContent = formatarData(data);
        }
        
        function marcarTodosCheckboxes() {
            const checkboxes = document.querySelectorAll('#recomendacoes input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = true);
            
            // Atualizar progresso
            const progresso = checkboxes.length;
            document.getElementById('progressoChecklist').textContent = progresso;
            
            mostrarMensagem('Todas as tarefas marcadas como conclu√≠das!', 'success');
        }
        
        // Exportar fun√ß√µes para o escopo global
        window.openTab = openTab;
        window.toggleDarkMode = toggleDarkMode;
        window.mostrarPassoDados = mostrarPassoDados;
        window.avancarPassoDados = avancarPassoDados;
        window.voltarPassoDados = voltarPassoDados;
        window.salvarRascunho = saveProgress;
        window.calcularCustos = calcularCustos;
        window.sugerirCustosPorSetor = sugerirCustosPorSetor;
        window.aplicarTemplateSetor = aplicarTemplateSetor;
        window.selecionarMetodo = selecionarMetodo;
        window.atualizarMarkup = atualizarMarkup;
        window.aplicarPrecoPsicologico = aplicarPrecoPsicologico;
        window.atualizarPrecoFinal = atualizarPrecoFinal;
        window.analisarConcorrencia = analisarConcorrencia;
        window.atualizarSensibilidade = atualizarSensibilidade;
        window.atualizarGraficos = atualizarGraficos;
        window.exportarGraficos = exportarGraficos;
        window.atualizarProjecoes = atualizarProjecoes;
        window.abrirModalGrafico = abrirModalGrafico;
        window.fecharModalGrafico = fecharModalGrafico;
        window.abrirModalAjuda = abrirModalAjuda;
        window.fecharModal = fecharModal;
        window.abrirModalSobre = abrirModalSobre;
        window.abrirModalDicas = abrirModalDicas;
        window.saveProgress = saveProgress;
        window.calcularTudo = calcularTudo;
        window.exportToExcel = exportToExcel;
        window.generatePDF = generatePDF;
        window.reiniciarCalculadora = reiniciarCalculadora;
        window.agendarRevisao = agendarRevisao;
        window.marcarTodosCheckboxes = marcarTodosCheckboxes;
        
        // Inicializar a aplica√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // J√° inicializado no in√≠cio, mas garantir que esteja completo
            setTimeout(() => {
                calcularCustos();
                atualizarPrecificacao();
                atualizarProgresso();
            }, 1000);
        });
    </script>
</body>
</html>
        
